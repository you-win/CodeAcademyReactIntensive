function recaptchaOnloadCallback(){$("#captcha_submit,.g-recaptcha,.g-recaptcha-response").empty(),$(".g-recaptcha").each(function(e,t){var a=null;"captcha_submit"==$(t).attr("id")&&(a=recaptchaVerify),$(t).attr("data-rendered-captcha")?grecaptcha.reset():(recaptcha_Client_Id=grecaptcha.render(t,{sitekey:"6LfmLhwUAAAAAFw3MTGQwO7Fcsfcu7AsnGYzm5js",callback:a,"expired-callback":recaptchaExpired,theme:"dark"}),$(t).attr("data-rendered-captcha",!0),$(t).attr("data-size")&&grecaptcha.execute(recaptcha_Client_Id))})}function captcha_execute(){grecaptcha.execute()}function recaptchaVerify(e){$("#captcha_submit").attr("data-token",e).click()}function recaptchaExpired(){grecaptcha.reset()}if(function(){var e,t,a,n,i,o,r,s,l,c,d,p,u,m,f,v,g,_,y,b,k,w,C,x,T,W,L,D,R,M,I,S,A,B,P,N,q,F,E,O,H,G,Q,Y,U,j,J,V,z,X,K,Z,ee,te,ae,ne,ie,oe,re,se,le,ce,de,pe,ue,me,he,fe,$e,ve,ge,_e,ye,be,ke,we,Ce,xe,Te,We,Le,De,Re,Me,Ie,Se,Ae,Be,Pe,Ne,qe,Fe,Ee,Oe,He="undefined"!=typeof sessionStorage,Ge=50,Qe=0,Ye=!1,Ue=["white","#88878F","#966F33","#C81423","#EEE600","#00B000","#00AADD","#BD5CBD","","","#70DBDB"],je=["Ring","Amulet","Crown"],Je=["Weapon","Armor"],Ve={0:"Weapon",1:"Weapon",2:"Weapon",50:"Armor",51:"Armor",52:"Armor",53:"Armor",54:"Armor",55:"Armor",150:"Weapon",151:"Weapon",152:"Weapon",153:"Weapon",155:"Armor",156:"Armor",157:"Armor",158:"Armor",159:"Armor"},ze={0:"Sword",1:"Staff",2:"Bow (Two-Handed)",50:"Helmet",51:"Breastplate",52:"Gloves",53:"Boots",54:"Shield",55:"Quiver",150:"Musket",151:"Rake",152:"Leaf Blower",153:"Fingerling",155:"Cornucopia",156:"Meshed Potatoes",157:"Oven Mitts",158:"Bread Loafers",159:"Serving Platter"},Xe={0:"sword",1:"staff",2:"bow",50:"helmet",51:"breastplate",52:"gloves",53:"boots",54:"shield",55:"quiver",150:"bow",151:"sword",152:"staff",153:"sword",155:"helmet",156:"breastplate",157:"gloves",158:"boots",159:"shield"},Ke={0:"weapon",1:"weapon",2:"weapon",50:"helmet",51:"breastplate",52:"gloves",53:"boots",54:"shield",55:"shield",150:"weapon",151:"weapon",152:"weapon",153:"weapon",155:"helmet",156:"breastplate",157:"gloves",158:"boots",159:"shield"},Ze=["Poor","Basic","Standard","Refined","Epic","Legendary","Artifact","Relic"],et=["counter_attack","healing","weapon_skill","evasion","base_counter_attack","base_healing","base_weapon_skill","base_evasion"],tt={0:"SYSTEM",1:"GLOBAL",2:"Main",3:"CLAN",4:"TRADE",5:"AREA",7:"HELP",8:"Limbo",9:"Event",77:"STAFF"},at={0:"red",1:"#0AD",2:"white",3:"#C22DAE",4:"#00A302",5:"#D5A459",7:"#b88aac",8:"darkseagreen",9:"deeppink",77:"#CF5893"},nt={2:'<span style="color: #FF3;">**DOUBLE**</span>',3:'<span style="color: #0AD;">**TRIPLE**</span>',4:'<span style="color: #D8D;">**QUADRUPLE**</span>',5:'<span style="color: #6cff00;">**QUINTUPLE**</span>',6:'<span style="color: #FC2360;">**SEXTUPLE**</span>',7:'<span class="rainbow">**SEPTUPLE**</span>'},it={strength:"Strength increases the amount of damage you deal in combat.  Different weapon types have different strength modifiers.",health:"Health increases your total hitpoints.",coordination:"Coordination influences your ability to hit targets.",agility:"Agility influences your ability to dodge incoming attacks.",counter_attack:"This is your chance to counter an attack with one of your own.  However, counter attacks are weaker than normal attacks.",healing:"This is your chance to heal each round of combat.  If you have more than 100% in this skill, excess percentage allows a second heal, etc.",weapon_skill:"This skill affects your ability to hit targets and increases the minimum damage you deal (by reducing the randomness).",magical_weapons:"This skill affects your ability to hit targets, increases your chance to cast a spell each round and increases the minimum damage you deal (by reducing the randomness).",evasion:"This skill affects your ability to dodge incoming attacks.",base_damage:"This affects the amount of base damage you deal.  The bonus may fluctuate depending on what you're using as a weapon (because different weapon types have different damage modifiers).",base_armor:"This affects the amount of damage you resist.",second_attack:"This is your chance of attacking an additional time.  If you have more than 100% in this skill, excess percentage allows a third attack, etc.",crit_chance:"This is your chance of critically striking your opponent, dealing increased damage.  If you have more than 100% in this skill, excess percentage allows a second crit, etc.",crit_damage:"This is the amount of additional damage your critical hits deal.",toughness:"Toughness increases your defensive capabilities.",counter_damage_percent:"This is the amount of damage your counter attacks deal relative to normal attacks.",healing_percent:"This skill increases the amount of hitpoints you restore when healing.",fishing_boost:"This skill increases the amount of resources you gain while fishing.  It also increases the amount of fishing experience you gain by a random value between 0% and the amount of this boost.  Does not apply to harvestron jobs.",woodcutting_boost:"This skill increases the amount of resources you gain while woodcutting.  It also increases the amount of woodcutting experience you gain by a random value between 0% and the amount of this boost.  Does not apply to harvestron jobs.",mining_boost:"This skill increases the amount of resources you gain while mining.  It also increases the amount of mining experience you gain by a random value between 0% and the amount of this boost.  Does not apply to harvestron jobs.",stonecutting_boost:"This skill increases the amount of resources you gain while stonecutting.  It also increases the amount of stonecutting experience you gain by a random value between 0% and the amount of this boost.  Does not apply to harvestron jobs.",crafting_boost:"This is your chance of crafting an additional time per crafting action.  If you have more than 100% in this skill, excess percentage allows a third craft, etc.",carving_boost:"This is your chance of crafting an additional time per carving action.  If you have more than 100% in this skill, excess percentage allows a third carve, etc.",Double:"Multiplies your gold, resource and experience gains by 2.",Triple:"Multiplies your gold, resource and experience gains by 3.",Quadruple:"Multiplies your gold, resource and experience gains by 4.",Quintuple:"Multiplies your gold, resource and experience gains by 5.",Sextuple:"Multiplies your gold, resource and experience gains by 6.",Rage:"Reduces your action timer by 1 second.",Fury:"Reduces your action timer by 1.5 seconds.",Frenzy:"Reduces your action timer by 2 seconds.",Berserk:"Reduces your action timer by 3 seconds.",Drunk:"Reduces your strength, health, coordination and agility by 1.",xp_character:"Increases the amount of experience you get for kills in battle.",gold:"Increases the amount of gold you get for kills in battle.",quest:"Reduces the requirements for completing a quest (100% makes them twice as fast, 200% makes them three times as fast, etc).",global_drop:"Increases your chance of finding random currency drops when completing an action.  This does not affect ingredient, quest, or most event drops.",stat_drop:"Increases your chance of gaining a stat when completing an action.",dungeon_drop:"Increases your chance of finding random drops when searching a dungeon room.",training_cost:"Decreases the cost of training skills at the Training Center.",auto_count:"Increases the amount of actions your character will automatically perform before becoming fatigued (which increases your action timer).",double_personal:"Adds multiplier time for your character.  The multiplier starts with Double (200% multiplier) and increases at certain time thresholds.<br/><br/> However, when the multiplier is increased, the duration is decreased, which allows you to get the full benefit of Double, but in less time.<br/><br/> Note that this means if you purchase 10 minutes while your modifier is above Double, you won't quite receive 10 extra minutes, but the overall benefit will be the same.",double_clan:"Adds multiplier time for everyone in your clan.  The multiplier starts with Double (200% multiplier) and increases at certain time thresholds.<br/><br/> However, when the multiplier is increased, the duration is decreased, which allows you to get the full benefit of Double, but in less time.<br/><br/> Note that this means if you purchase 10 minutes while your modifier is above Double, you won't quite receive 10 extra minutes, but the overall benefit will be the same.",double_global:"Adds multiplier time for everyone!  The multiplier starts with Double (200% multiplier) and increases at certain time thresholds.<br/><br/> However, when the multiplier is increased, the duration is decreased, which allows you to get the full benefit of Double, but in less time.<br/><br/> Note that this means if you purchase 10 minutes while your modifier is above Double, you won't quite receive 10 extra minutes, but the overall benefit will be the same.",stat_personal:"Provides an additional chance of earning a stat each action (allows the possibility of earning multiple stats in a single action).",drop_personal:"Provides an additional chance of receiving a random loot drop each action (allows the possibility of earning multiple drops in a single action).  This does not affect ingredient, quest, or most event drops.","Stat Boost":"Provides an additional chance of earning a stat each action (allows the possibility of earning multiple stats in a single action).","Drop Boost":"Provides an additional chance of receiving a random loot drop each action (allows the possibility of earning multiple drops in a single action).  This does not affect ingredient, quest, or most event drops.","Stamina Boost":'Temporarily increases your "Maximum Stamina" by 50.  Also allows you to build up a "Fatigue Buffer" while completing non-fatigued actions.  When at 0 stamina, your fatigue buffer will decrease instead of your stamina, allowing you to gain extra full-speed actions before becoming fatigued.',Sparkler:"Increases your Critical Hit Chance by 20%.","Stomach Ache":"Decreases your Strength, Health, Coordination, and Agility by 10%.","Sugar Rush":"Increases your Multistrike Chance by 100%.","Halloween Hype":"Increases your Strength, Health, Coordination, and Agility by 10%.",Wishbone:"Increases your Critical Hit Chance by 100%."},ot=["Although the only light in the Dungeon is that brought in by wandering explorers - either dead or alive - twisted vines and roots of what must have once been marvelous greenery protrude from the cavern walls.","Littered with tiny pebbles, the cavern floor shifts constantly with the shuffle of creatures moving about.  The cracked, stone cavern walls are cold and bloodstained, with sharp shards of stone protruding out, posing yet another threat to adventurers traversing the many obstacles of the Dungeon.","Even within the depths of the Dungeon, a thin layer of dark, dirty water floods the ground, dampening the sounds of footsteps while also creating its own acoustics as bits of rock fall from the walls."],rt=[],st=0,lt={currentRound:0},ct=5,dt={},pt={},ut=null,mt=0,ht=[],ft=82,$t="up",vt=[];function gt(e,t,n,i,o){(!o||o<=0)&&Da(),C.show(),$("#areaCaptchaWrapper,#modal2Content").empty(),o>0&&($("#modal2Content").html('<div id="captcha_explanation" class="center">From time to time, you\'ll be faced with a CAPTCHA.  These help prevent unsavory activity within our realms.  We know they are annoying, but you will be rewarded for completing them.</div><div class="center"><div id="captcha_submit" class="g-recaptcha" data-sitekey="6LfmLhwUAAAAAFw3MTGQwO7Fcsfcu7AsnGYzm5js" data-callback="recaptchaVerify" data-size="invisible"></div><div style="margin: 0 auto;display:none;"><input id="captcha_submit_v2" type="submit" value="Submit"></input></div></div>'),recaptchaOnloadCallback()),$("#captcha_submit").attr("data-type",t).attr("data-value",n).attr("data-version",2),$("#captcha_submit").on("click",function(e){e.preventDefault(),function(){var e=$("#captcha_submit"),t=e.attr("data-type"),n=e.attr("data-value"),i=e.attr("data-version");if(jsonObj={},jsonObj.r=$("#recaptcha_response_field").val(),jsonObj.v=i,jsonObj.g=$("#captcha_submit").attr("data-token"),!jsonObj.g)return;jsonObj.type="page",jsonObj.page="captcha_submit",jsonObj.t=t,jsonObj.z=n,a.send(JSON.stringify(jsonObj))}()})}function _t(e){va({title:"Inventory"});$("#equipmentModWrapper");$("#inventoryWrapper").show(),$("#equipmentMods").empty(),It(),$('.inventoryLoad[data-itemtype="weapon"]').addClass("active"),yt("equipment",{}),da("weapon")}function yt(e,t){t.type="page",t.page=e,x.show(),a.send(JSON.stringify(t))}function bt(e,t){var a,n=$("#"+t);"weapon"==t?e?(n.parent().find(".unequipLink").css("visibility","visible"),n.parent().find(".moreItemOptions2").css("visibility","visible"),a=Xe[e.s],e.gs?(n.parent().find(".gemslot_holder").css("visibility","visible"),n.parent().find(".gemslot_count").text(e.gs-e.gsr),n.parent().find(".gemslot_max").text(e.gs)):n.parent().find(".gemslot_holder").css("visibility","hidden")):(n.parent().find(".unequipLink").css("visibility","hidden"),n.parent().find(".moreItemOptions2").css("visibility","hidden"),n.parent().find(".gemslot_holder").css("visibility","hidden"),a="sword_none"):e?(n.parent().find(".unequipLink").css("visibility","visible"),n.parent().find(".moreItemOptions2").css("visibility","visible"),a=Xe[e.s],e.gs?(n.parent().find(".gemslot_holder").css("visibility","visible"),n.parent().find(".gemslot_count").text(e.gs-e.gsr),n.parent().find(".gemslot_max").text(e.gs)):n.parent().find(".gemslot_holder").css("visibility","hidden")):(n.parent().find(".unequipLink").css("visibility","hidden"),n.parent().find(".moreItemOptions2").css("visibility","hidden"),n.parent().find(".gemslot_holder").css("visibility","hidden"),a=t+"_none");wt(Ue[e.q]);n.css("color",Ue[e.q]).attr("data-json",e?JSON.stringify(e):"{}").html('<img src="equipment/'+a+'.png" />')}function kt(e,t){var a,n=$("#"+t);e?n.parent().find(".unequipAccessoryLink").css("visibility","visible"):n.parent().find(".unequipAccessoryLink").css("visibility","hidden"),a=t+(e?"":"_none");wt(Ue[e.q]);n.css("color",e.c).attr("data-json",e?JSON.stringify(e):"{}").html('<img src="equipment/'+a+'.png" />')}function wt(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function Ct(e){return'<span class="itemWithTooltip" style="color: '+Ue[e.q]+'" data-json="'+si(JSON.stringify(e))+'">'+e.n+"</span>"}function xt(e){return'<span class="gemWithTooltip '+e.c+'" data-json="'+si(JSON.stringify(e))+'">'+e.n+"</span>"}function Tt(e){return'<span class="accessoryWithTooltip" style="color: '+e.c+'" data-json="'+si(JSON.stringify(e))+'">'+e.n+"</span>"}function Wt(e){return'<span class="toolWithTooltip" data-json="'+si(JSON.stringify(e))+'">'+e.n+"</span>"}function Lt(e){$("#equipmentMods").append("<li>"+e+"</li>"),$("#equipmentModWrapper").animate({scrollTop:$("#equipmentModWrapper").prop("scrollHeight")},0)}function Dt(e,t){yt("item_receive_from_clan",{item:e,borrow:!0,sendTo:t})}function Rt(e,t){yt(0==t?"equip":"unequip",{item:e,reload:$("#inventoryTypes .active").first().attr("data-itemtype")})}function Mt(e,t){yt((0==t?"equip":"unequip")+"_accessory",{accessory:e})}function It(){$(".inventoryLoad,#loadTools").removeClass("active")}function St(e,t){e=parseFloat(e);var a=0,n=JSON.parse($("#weapon").attr("data-json")),i=parseFloat(n.l)+e,o=Math.floor(i/10),r=30*Math.pow(o+i%10/10,2)+100*(o+i%10/10)+35;return 1==n.s?r*=.5:2==n.s&&(r*=1.5),t||(t=n.q),a=[1,1.2,1.4,1.6,1.8,2,2.25,2.5][t],n.o==$("#username").text()&&(a+=.15),r*a}function At(e,t){$.each(e,function(a){var n=e[a];if(null===n.n)return!0;var i=$("#"+n.n),o=i.parent().parent().parent().find(".train_count");if("base_damage"==n.n){$("#base_damage_upgrades").text(n.rv),$("#base_damage_increase").text(ui(n.v)),i.attr("data-base",n.v),n.bo&&i.attr("data-bonuses",n.bo),i.parent().attr("rv",n.rv);var r=Nt(n.rv,$(".gold").first().attr("title").replace(/,/g,""));i.parent().parent().parent().find(".train_slider").attr("max",r)}else if("base_armor"==n.n){$("#base_armor_upgrades").text(n.v),$("#base_armor_increase").text(ui(Gt(0,n.v,1,1,5))),i.attr("data-base",Gt(0,n.rv,1,1,5)),n.bo&&i.attr("data-bonuses",n.bo),i.parent().attr("rv",n.rv);r=Nt(n.rv,$(".gold").first().attr("title").replace(/,/g,""));i.parent().parent().parent().find(".train_slider").attr("max",r)}else{i.find("#"+n.n+"_upgrades").text(n.rv),i.find("#"+n.n+"_increase").text(ui(n.b+n.i*n.v,2)+"%"),i.attr("data-base",ui(n.b+n.i*n.rv,2)+"%"),n.bo&&i.attr("data-bonuses",n.bo),i.parent().attr("increase",n.i),i.parent().attr("max",n.m),i.parent().attr("rv",n.rv);var s=Bt(n.rv,$(".platinum").first().attr("title").replace(/,/g,""));r=Math.min(s,n.m-n.rv);i.parent().parent().parent().find(".train_slider").attr("max",r)}t&&o.val(""),o.keyup()})}function Bt(e,t){return t/=1-$("#training_cost_total").text().replace(/,/g,"")/100,Math.floor(Jt(e,t,2,4,1,null))}function Pt(e,t){var a=parseFloat(e)+parseFloat(t),n=Math.floor(500*e*(2*Math.pow(e,2)-3*e+7)),i=Math.floor(500*a*(2*Math.pow(a,2)-3*a+7))-n;return isNaN(i)?0:i}function Nt(e,t){for(var a=Date.now(),n=parseFloat(t)/(1-$("#training_cost_total").text().replace(/,/g,"")/100)+Pt(0,e),i=Math.floor(n/3e3),o=Math.floor(i/2),r=0;o!=i;)if((r=Pt(0,o))>n?(i=o,o=Math.floor(i/2)):r==n?i=o:o+1==i?i=o:o=Math.floor((o+i)/2),Date.now()-2e3>a)return bn($("#train_notification"),"Calculating the maximum amount of times you can train one of your skills took too long and we'd rather stop attempting to calculate than cause your browser to freeze.  So if you think it's a bug, it's not!  You simply have too much gold or have trained too many times!"),0;return o-e}function qt(){$("#premiumShopLinksWrapper button").removeClass("active"),$("#premium_shop_notification").empty(),$("#premiumPurchaseWrapper,#permanentBoostWrapper,#temporaryBoostWrapper,#miscellaneousBoostWrapper").hide()}function Ft(){$("#premiumShopLinkSWrapper button.active").click(),va({title:"Crystal Shop"}),$("#premiumShopWrapper").show(),$("#premiumShopGiftFor").keyup()}function Et(){yt("boosts",{})}function Ot(e,t){$.each(e,function(a){var n=e[a];if(null===n.n)return!0;var i=$("#"+n.n+"_boost"),o=i.parent().parent().parent().find(".boost_count");if(i.text(ui(n.v)),(t||parseInt(n.v)>=parseInt(n.m))&&("auto_count"==n.n?$("#autos_to_buy").val(0):o.val(0)),"auto_count"==n.n)$("#auto_slider").attr("max",Ut(n.v,$(".mypremium").first().text().replace(/,/g,""))),$("#"+n.n+"_total").text(ui(n.tv)).parent().attr("title",n.bor.replace(/,/g,"\n")).attr("data-base",n.v),$("#autos_to_buy").keyup();else if("reset_cost"==n.n)$("#boost_reset_cost").text(ui(n.v));else{var r,s;r=i.attr("data-cost")?jt(i.attr("data-cost"),$(".mypremium").first().text().replace(/,/g,"")):Jt(n.v,$(".mypremium").first().text().replace(/,/g,""),n.bc,n.ci,n.inc),n.m<1e6?(s=Math.min(r,n.m-n.v),$("#"+n.n+"_total").text(ui(n.tv)).parent().attr("title",n.bor.replace(/,/g,"\n")).attr("data-base",n.v)):s=r,o.keyup(),i.parent().parent().parent().find(".boost_slider").attr("max",s)}})}function Ht(e,t){return e*t}function Gt(e,t,a,n,i){e=parseFloat(e),t=parseFloat(t),a=parseFloat(a),n=parseFloat(n),i=parseFloat(i);var o,r,s=(o=e)*(a-n)+n*(o*(r=Math.floor((o-1)/i)+1)-i*r*(r-1)/2);return(o=e+t)*(a-n)+n*(o*(r=Math.floor((o-1)/i)+1)-i*r*(r-1)/2)-s}function Qt(e){return Gt(0,Math.min(495,e),1,1,5)+100*Math.max(0,e-495)}function Yt(e,t){var a=parseFloat(e)-Ge,n=Qt(a+parseFloat(t))-Qt(a);return isNaN(n)?0:n}function Ut(e,t){t=parseFloat(t)+parseFloat(Qt(e-Ge));var a,n=Jt(e-Ge,t,1,1,5,1);return parseInt(e)+n>495+Ge?(t-=Qt(495+Ge),a=Math.floor(t/100),a+=495+Ge,a-=e,a+=Ge):a=n,a}function jt(e,t){return Math.floor(t/e)}function Jt(e,t,a,n,i,o){e=parseInt(e),t=parseInt(t),a=parseInt(a),n=parseInt(n),i=parseInt(i);t+=o?0:Gt(0,e,a,n,i);var r=a,s=Math.floor((Math.sqrt(Math.pow((n-2*a)*i,2)+8*i*n*t)+(n-2*a)*i)/(2*i*n)),l=(t-(2*r+(s-1)*n)*s*i/2)/(r+s*n);return Math.floor(s*i+l)-e}function Vt(e){yt("profile",{username:e})}function zt(e){Da(),yt("town_battlegrounds",{})}function Xt(e){return e<5?"#F00":e<10?"#FF1B00":e<20?"#FF3600":e<30?"#FF6C00":e<40?"#FF9000":e<50?"#FFA200":e<60?"gold":e<70?"#FFFC00":e<80?"#A8FF00":e<90?"#69FF00":"#0FFF00"}function Kt(e,t,a,n,i,o,r,s){i=parseInt(i),o=parseInt(o);var l=$(".quest_number").first().text(),c=Math.min(10,Math.ceil(l/60)),d=Math.min(25,Math.ceil(l/20));if("BATTLE"==e)if(t)oe.show(),re.hide(),se.html('You don\'t currently have a battle quest.  Visit the <a class="questCenter">Quest Center</a> to get one.'),ce.css("-webkit-animation","").css("-moz-animation","").css("-animation","");else if(re.show(),oe.hide(),de.text(ui(o-i)),i>=o)pe.show(),ue.hide(),se.html(n),le.text(r),ce.css("-webkit-animation","pulsate-inner .8s infinite alternate").css("-moz-animation","pulsate-inner .8s infinite alternate").css("-animation","pulsate-inner .8s infinite alternate"),s?($("#battleQuestComplete > .questGuessWrapper").show(),$(".min_quest_crystals").text(c),$(".max_quest_crystals").text(d)):$("#battleQuestComplete > .questGuessWrapper").hide();else{var p=Xt(i/o*100);se.html(n+' (<span style="color: '+p+'">'+ui(i)+'</span> / <span  style="color: '+p+'">'+ui(o)+"</span>)."),le.text(oi(n)),me.text(a),pe.hide(),ue.show(),ce.css("-webkit-animation","").css("-moz-animation","").css("-animation","")}else if("EVENT"==e)if(t){$("#eventQuest").show(),$("#eq_reward").html(a);p=Xt(i/o*100);$("#eq_info").html(n+' (<span style="color: '+p+'">'+ui(i)+'</span> / <span  style="color: '+p+'">'+ui(o)+"</span>).")}else $("#eventQuest").hide();else if("HARVEST"==e)if(t)he.show(),fe.hide(),$e.html('You don\'t currently have a harvesting quest.  Visit the <a class="questCenter">Quest Center</a> to get one.'),ge.css("-webkit-animation","").css("-moz-animation","").css("-animation","");else{fe.show(),he.hide();var u=o-i;if(_e.text(ui(u)),ye.text(1==u?"time":"times"),i>=o)$e.html(n),ve.text(r),ke.show(),we.hide(),ge.css("-webkit-animation","pulsate-inner .8s infinite alternate").css("-moz-animation","pulsate-inner .8s infinite alternate").css("-animation","pulsate-inner .8s infinite alternate"),s?($("#tradeskillQuestComplete > .questGuessWrapper").show(),$(".min_quest_crystals").text(c),$(".max_quest_crystals").text(d)):$("#tradeskillQuestComplete > .questGuessWrapper").hide();else{p=Xt(i/o*100);$e.html(n+' (<span style="color: '+p+'">'+ui(i)+'</span> / <span  style="color: '+p+'">'+ui(o)+"</span>)."),ve.text(oi(n)),be.text(oi(a)),ke.hide(),we.show(),ge.css("-webkit-animation","").css("-moz-animation","").css("-animation","")}}else if("PROFESSION"==e)if(t)Ce.show(),xe.hide(),Te.html('You don\'t currently have a profession quest.  Visit the <a class="questCenter">Quest Center</a> to get one.'),Le.css("-webkit-animation","").css("-moz-animation","").css("-animation","");else{xe.show(),Ce.hide();u=o-i;if(De.text(ui(u)),Re.text(1==u?"time":"times"),i>=o)Te.html(n),We.text(r),Ie.show(),Se.hide(),Le.css("-webkit-animation","pulsate-inner .8s infinite alternate").css("-moz-animation","pulsate-inner .8s infinite alternate").css("-animation","pulsate-inner .8s infinite alternate"),s?($("#professionQuestComplete > .questGuessWrapper").show(),$(".min_quest_crystals").text(c),$(".max_quest_crystals").text(d)):$("#professionQuestComplete > .questGuessWrapper").hide();else{p=Xt(i/o*100);Te.html(n+' (<span style="color: '+p+'">'+ui(i)+'</span> / <span  style="color: '+p+'">'+ui(o)+"</span>)."),We.text(oi(n)),Me.text(oi(a)),Ie.hide(),Se.show(),Le.css("-webkit-animation","").css("-moz-animation","").css("-animation","")}}else if(t)Ce.show(),xe.hide(),Te.html('You don\'t currently have a profession quest.  Visit the <a class="questCenter">Quest Center</a> to get one.'),Le.css("-webkit-animation","").css("-moz-animation","").css("-animation","");else{xe.show(),Ce.hide();u=o-i;if(De.text(ui(u)),Re.text(1==u?"time":"times"),i>=o)Te.html(n),We.text(r),Ie.show(),Se.hide(),Le.css("-webkit-animation","pulsate-inner .8s infinite alternate").css("-moz-animation","pulsate-inner .8s infinite alternate").css("-animation","pulsate-inner .8s infinite alternate");else{p=Xt(i/o*100);Te.html(n+' (<span style="color: '+p+'">'+ui(i)+'</span> / <span  style="color: '+p+'">'+ui(o)+"</span>)."),We.text(oi(n)),Me.text(oi(a)),Ie.hide(),Se.show(),Le.css("-webkit-animation","").css("-moz-animation","").css("-animation","")}}}function Zt(){yt("quests",{})}function ea(e,t){if(e.p){var a,n=t?"#itemEquippedTooltip":"#itemTooltip",i=e.t,o=e.p,r=e.b,s=e.g,l=e.o,c=e.q,d=e.on,p=e.gs,u=e.gsr,m="Weapon"==Je[i]?"Damage":"Armor",h=Ue[c];if($(n).css("border-color",h),$(n+" .itemTitle,"+n+" .itemOriginalName").css("color",h),$(n+" .itemTitle").html(e.n),e.mr?($(n+" .itemMaterialsCompleted").text(ui(e.mc)),$(n+" .itemMaterialsRequired").text(ui(e.mr)),$(n+" .itemMaterialsWrapper").show()):$(n+" .itemMaterialsWrapper").hide(),null==d?($(n+" .originalTitleWrapper").hide(),$(n+" .itemType").css("margin-top","10px")):($(n+" .itemOriginalName").html(d),$(n+" .itemType").css("margin-top","0px"),$(n+" .originalTitleWrapper").show()),$(n+" .itemQuality").html("Quality: "+Ze[c]),$(n+" .itemType").html(Je[i]+": "+ze[e.s]),$(n+" .itemReqLvl").html("Required Level: "+e.l),$(n+" .itemPower").html("Total "+m+': <span class="itemPowerNumber">'+o+"</span>"),null!=l?$(n+" .itemOwnership").text("This item has a special affinity to the body of "+l+".  Its "+m.toLowerCase()+" is increased by 15% under their command."):$(n+" .itemOwnership").text(""),$(n+" .itemBonuses").empty(),r){r=r.split(",");for(e=0;e<r.length;e++)(a=r[e].split("="))[1]&&("percent"==a[0].split(" ")[0]&&(a[0]=a[0].replace("percent",""),a[1]=a[1]+"%"),$(n+" .itemBonuses").append("<li>+"+a[1]+" "+a[0]+"</li>"))}else $(n+" .itemBonuses").html("<li>None</li>");$(n+" .itemGems").empty(),p?($(n+" .itemGemsWrapper").show(),$(n+" .gemsSocketed").text(p-u),$(n+" .gemSlots").text(p),$(n+" .itemGems").show(),s?$.each(s,function(e,t){$(n+" .itemGems").append("<li>"+xt(t)+"</li>")}):$(n+" .itemGems").append("<li>None</li>")):$(n+" .itemGemsWrapper").hide()}}function ta(e){if(e.i){var t,a=$("#accessoryTooltip"),n=e.b;if(a.css("border-color",e.c),$("#accessoryTitle").css("color",e.c),$("#accessoryTitle").html(e.n),$("#accessoryDescription").html(e.d),$("#accessoryType").text("Accessory: "+je[e.s]),$("#accessoryRequirements").empty(),e.r){var i=e.r;$.each(i,function(e,t){if(-1!==e.indexOf("_")){var a=e.split("_").join(" ");$("#accessoryRequirements").append("<li>"+a.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})+": "+ui(t,0,1,1)+"</li>")}else $("#accessoryRequirements").append("<li>"+ii(e)+": "+ui(t,0,1,1)+"</li>")})}else $("#accessoryRequirements").html("<li>None</li>");if($("#accessoryBonuses").empty(),n){n=n.split(",");for(e=0;e<n.length;e++)(t=n[e].split("="))[1]&&("percent"==t[0].split(" ")[0]&&(t[0]=t[0].replace("percent",""),t[1]=t[1]+"%"),$("#accessoryBonuses").append("<li>"+(t[1]>=0||-1!=t[1].indexOf("%")&&"-"!=t[1].charAt(0)?"+":"")+t[1]+" "+t[0]+"</li>"))}else $("#accessoryBonuses").html("<li>None</li>")}}function aa(){u=setTimeout(function(){$("#accessoryTooltip").show()},400)}function na(e){if(e.n){document.getSelection().removeAllRanges();var t=W.html()+" "+('[ <span class="itemWithTooltip" contenteditable="false" style="color: '+Ue[e.q]+';" data-json="'+si(JSON.stringify(e))+'">'+e.n+"</span> ]");t=t.replace("<br>",""),W.html(t),ri(document.getElementById("chatMessage"))}}function ia(e){if(e.n){document.getSelection().removeAllRanges();var t=W.html()+" "+('[ <span class="gemWithTooltip '+e.c+'" contenteditable="false" data-json="'+si(JSON.stringify(e))+'">'+e.n+"</span> ]");t=t.replace("<br>",""),W.html(t),ri(document.getElementById("chatMessage"))}}function oa(){$("#inventoryWrapper,#modalWrapper,#modal2Wrapper,#chatMessageList,#latestLoot,#areaContent").on("mouseover",".itemWithTooltip",function(e){$("#itemTooltip,#itemEquippedTooltip").hide();var t=0,a=0;clearTimeout(o);var n=$("#itemTooltip"),i=$("#itemEquippedTooltip"),r=JSON.parse($(this).attr("data-json"));if(void 0!==r.s){var s=r.i,l=r.p;ea(r);var c=ze[r.s];"quiver"==(c="Weapon"==Je[r.t]?"weapon":c).toLowerCase()||"serving platter"==c.toLowerCase()?c="shield":"cornucopia"==c.toLowerCase()?c="helmet":"meshed potatoes"==c.toLowerCase()?c="breastplate":"oven mitts"==c.toLowerCase()?c="gloves":"bread loafers"==c.toLowerCase()&&(c="boots");var d=$("#"+c.toLowerCase());if(null!==d.html())if(void 0!==(r=JSON.parse(d.attr("data-json"))).s){ea(r,1);var p=r.p;r.i&&r.i==s&&(t=1)}else a=1;$(document).height();var u,m,h=window.innerWidth,f=0,v=0,g="top",_=t?i.height():Math.max(n.height(),i.height()),y=t?i.width():n.width()+i.width();(v=$(this).offset().top-$(this).height()-_)<0&&(v=$(this).offset().top+$(this).height()+10,g="bottom"),(f=$(this).offset().left-y/2)+(t?i.width():n.width()+i.width()+22)>h&&(f=$(this).offset().left-(t?i.width():n.width()+i.width()+22)),f<0&&(f=0),"bottom"==g?(n.css("left",f).css("top",v),i.css("left",f+(t?0:n.width()+22)).css("top",v)):(n.css("left",f).css("top",n.height()>i.height()?v:v+(i.height()-n.height())),i.css("left",f+(t?0:n.width()+22)).css("top",i.height()>n.height()?v:v+(n.height()-i.height()))),t<1?l>p?($("#itemTooltip .itemPowerNumber").addClass("higherPower"),$("#itemEquippedTooltip .itemPowerNumber").removeClass("higherPower")):($("#itemTooltip .itemPowerNumber").removeClass("higherPower"),$("#itemEquippedTooltip .itemPowerNumber").addClass("higherPower")):$("#itemEquippedTooltip .itemPowerNumber").removeClass("higherPower"),u=a,m=t,o=setTimeout(function(){u<1?$("#itemEquippedTooltip").show():$("#itemEquippedTooltip").hide(),m<1&&$("#itemTooltip").show()},400)}}),$("#inventoryWrapper,#modalWrapper,#modal2Wrapper,#chatMessageList,#latestLoot,#areaContent,#itemTooltip,#itemEquippedTooltip").on("mouseover",".gemWithTooltip",function(e){var t=$("#gemTooltip");clearTimeout(c);var a=JSON.parse($(this).attr("data-json"));if(void 0!==a.s){a.i;!function(e,t){if(e.i){var a,n=$("#gemTooltip"),i=e.b,o=e.o;if(n.css("border-color",t),$("#gemTitle").css("color",t),$("#gemTitle").html(e.n),e.res?$("#gemRestrictions").text("("+e.res+")").show():$("#gemRestrictions").hide(),e.mr?($("#gemMaterialsCompleted").text(ui(e.mc)),$("#gemMaterialsRequired").text(ui(e.mr)),$("#gemMaterialsWrapper").show()):$("#gemMaterialsWrapper").hide(),$("#gemReqLvl").html("Required Level: "+e.l),null!=o?$("#gemOwnership").text("This item shines more vividly in the possession of "+o+".  Its effect is increased by 50% under their command."):$("#gemOwnership").text(""),$("#gemBonuses").empty(),i)for(i=i.split(","),e=0;e<i.length;e++)(a=i[e].split("="))[1]&&("percent"==a[0].split(" ")[0]&&(a[0]=a[0].replace("percent",""),a[1]=a[1]+"%"),$("#gemBonuses").append("<li>+"+a[1]+" "+a[0]+"</li>"));else $("#gemBonuses").html("<li>None</li>")}}(a,$(this).css("color"));var n=window.innerWidth,i=$(document).height(),o=!1,r=0,s=0,l=!1;$(this).offset().left+$(this).width()>n/2?(r=$(this).offset().left-t.width()-22,l="left"):(r=$(this).offset().left+$(this).width()+22,l="right"),(r<0||r+t.width()>n)&&(o=!0),o?(r=$(this).offset().left,l="bottom",(s=$(this).offset().top+$(this).height())+t.height()>i&&((s=$(this).offset().top-t.height())<0?(l="bottom",s=$(this).offset().top+$(this).height()):l="top")):(s=Math.max(0,$(this).offset().top-t.height()/2))+t.height()>i&&(s=$(this).offset().top-t.height()-20,r=$(this).offset().left-$(this).width()/2,l="top"),t.css("left",r).css("top",s).removeClass("tooltip_top tooltip_bottom tooltip_left tooltip_right").addClass("tooltip_"+l),c=setTimeout(function(){$("#gemTooltip").show()},400)}}),$("#inventoryWrapper,#modalWrapper,#modal2Wrapper,#chatMessageList,#latestLoot,#areaContent,#itemTooltip,#itemEquippedTooltip").on("mouseover",".accessoryWithTooltip",function(e){var t=$("#accessoryTooltip");clearTimeout(u);var a=JSON.parse($(this).attr("data-json"));if(void 0!==a.s){a.i;ta(a,$(this).css("color"));var n=window.innerWidth,i=$(document).height(),o=!1,r=0,s=0,l=!1;$(this).offset().left+$(this).width()>n/2?(r=$(this).offset().left-t.width()-22,l="left"):(r=$(this).offset().left+$(this).width()+22,l="right"),(r<0||r+t.width()>n)&&(o=!0),o?(r=$(this).offset().left,l="bottom",(s=$(this).offset().top+$(this).height())+t.height()>i&&((s=$(this).offset().top-t.height())<0?(l="bottom",s=$(this).offset().top+$(this).height()):l="top")):(s=Math.max(0,$(this).offset().top-t.height()/2))+t.height()>i&&(s=$(this).offset().top-t.height()-20,r=$(this).offset().left-$(this).width()/2,l="top"),t.css("left",r).css("top",s).removeClass("tooltip_top tooltip_bottom tooltip_left tooltip_right").addClass("tooltip_"+l),aa()}}),$("#inventoryWrapper,#modalWrapper,#modal2Wrapper,#chatMessageList,#latestLoot,#areaContent,#itemTooltip,#itemEquippedTooltip").on("mouseout",".gemWithTooltip",function(e){clearTimeout(c),c=setTimeout(function(){$("#gemTooltip").hide()},400),o=setTimeout(function(){$("#itemTooltip").hide(),$("#itemEquippedTooltip").hide()},400)}),$("#inventoryWrapper,#modalWrapper,#modal2Wrapper,#chatMessageList,#latestLoot,#areaContent,#itemTooltip,#itemEquippedTooltip").on("mouseout",".accessoryWithTooltip",function(e){clearTimeout(u),u=setTimeout(function(){$("#accessoryTooltip").hide()},400)}),$("#inventoryWrapper,#modalWrapper,#modal2Wrapper,#chatMessageList,#latestLoot,#areaContent").on("mouseout",".itemWithTooltip",function(e){clearTimeout(o),o=setTimeout(function(){$("#itemTooltip").hide(),$("#itemEquippedTooltip").hide()},400)}),$("#itemTooltip,#itemEquippedTooltip").on("mouseout",function(e){clearTimeout(o),o=setTimeout(function(){$("#itemTooltip").hide(),$("#itemEquippedTooltip").hide()},400)}),$("#itemTooltip,#itemEquippedTooltip").on("mouseover",function(){clearTimeout(o)}),$("#gemTooltip").on("mouseover",function(){clearTimeout(o),clearTimeout(c)}),$("#gemTooltip").on("mouseout",function(){clearTimeout(c),c=setTimeout(function(){$("#gemTooltip").hide()},400)}),$("#accessoryTooltip").on("mouseover",function(){clearTimeout(u)}),$("#accessoryTooltip").on("mouseout",function(){clearTimeout(u),u=setTimeout(function(){$("#accessoryTooltip").hide()},400)}),$("#toolTooltip").on("mouseover",function(){clearTimeout(r),r=setTimeout(function(){$("#toolTooltip").show()},400)}),$("#inventoryWrapper,#modalWrapper,#modal2Wrapper,#chatMessageList,#latestLoot,#areaContent").on("mouseover",".toolWithTooltip",function(e){clearTimeout(r);var t,a=JSON.parse($(this).attr("data-json"));t=a,$("#toolTooltip .toolTitle").html(t.n),$("#toolTooltip .toolReqLvl").html("Required "+t.s+" Level: "+t.l),$("#toolTooltip .toolMod").html("Grants "+(100*(t.m-1)).toFixed(2)+"% additional "+t.s+" experience."),parseFloat(t.b)>0?$("#toolTooltip .toolBonus").html("Grants "+t.b+" additional res/action.").show():$("#toolTooltip .toolBonus").html("").hide();var n=$("#toolTooltip"),i=window.innerWidth,o=$(document).height(),s=!1,l=0,c=0,d=!1;$(this).offset().left+$(this).width()>i/2?(l=$(this).offset().left-n.width()-22,d="left"):(l=$(this).offset().left+$(this).width()+22,d="right"),(l<0||l+n.width()>i)&&(s=!0),s?(l=$(this).offset().left,d="bottom",(c=$(this).offset().top+$(this).height())+n.height()>o&&((c=$(this).offset().top-n.height())<0?(d="bottom",c=$(this).offset().top+$(this).height()):d="top")):(c=Math.max(0,$(this).offset().top-n.height()/2))+n.height()>o&&(c=$(this).offset().top-n.height()-20,l=$(this).offset().left-$(this).width()/2,d="top"),n.css("left",l).css("top",c).removeClass("tooltip_top tooltip_bottom tooltip_left tooltip_right").addClass("tooltip_"+d),r=setTimeout(function(){$("#toolTooltip").show()},400)}),$("#toolTooltip").on("mouseout",function(){clearTimeout(r),r=setTimeout(function(){$("#toolTooltip").hide()},400)}),$("#inventoryWrapper,#modalWrapper,#modal2Wrapper,#chatMessageList,#latestLoot,#areaContent").on("mouseout",".toolWithTooltip",function(e){clearTimeout(r),r=setTimeout(function(){$("#toolTooltip").hide()},400)}),$("#currentPromotions,#trainingWrapper,#attrTable,#skillTable,#effectTable,#permanentBoostWrapper,#temporaryBoostWrapper").on("mouseover",".statWithTooltip",function(e){var t=$(this).attr("data-statname"),a=$("#"+t),n=$("#"+t+"_total").parent();"weapon_skill"==t?$("#weaponskill").text().split("Magical")[1]?$("#statDescription").text(it.magical_weapons):$("#statDescription").text(it.weapon_skill):$("#statDescription").html(it[t]);var i,o=a.attr("data-base");if(o||(o=n.attr("data-base")),o?($("#statBase").show(),$("#baseStat").text(o)):$("#statBase").hide(),$("#statBonuses").empty(),!(i=a.attr("data-bonuses"))&&n.length&&(i=n.attr("title").replace(new RegExp("\n","g"),",")),i){if(i=i.split(","))for(var r=0;r<i.length;r++)$("#statBonuses").append("<div>"+i[r]+"</div>");$("#statBonuses").show()}else $("#statBonuses").hide();var l=$("#statTooltip"),c=window.innerWidth,d=$(document).height(),p=!1,u=0,m=0,h=!1;$(this).offset().left+$(this).width()>c/2?(u=$(this).offset().left-l.width()-32,h="left"):(u=$(this).offset().left+$(this).width()+22,h="right"),(u<0||u+l.width()>c)&&(p=!0),p?(u=$(this).offset().left,h="bottom",(m=$(this).offset().top+$(this).height())+l.height()>d&&((m=$(this).offset().top-l.height())<0?(h="bottom",m=$(this).offset().top+$(this).height()):h="top")):(m=Math.max(0,$(this).offset().top-l.height()/2))+l.height()>d&&(m=$(this).offset().top-l.height()-20,u=$(this).offset().left-$(this).width()/2,h="top"),l.css("left",u).css("top",m).removeClass("tooltip_top tooltip_bottom tooltip_left tooltip_right").addClass("tooltip_"+h),clearTimeout(s),s=setTimeout(function(){$("#statTooltip").show()},400)}),$("#currentPromotions,#trainingWrapper,#attrTable,#skillTable,#effectTable,#permanentBoostWrapper,#temporaryBoostWrapper").on("mouseout",".statWithTooltip",function(e){clearTimeout(s),s=setTimeout(function(){$("#statTooltip").hide()},400)}),$("#statTooltip").on("mouseover",function(){clearTimeout(s)}),$("#statTooltip").on("mouseout",function(){s=setTimeout(function(){$("#statTooltip").hide()},400)}),$("#statsTable,#resourcesTable").on("mouseover",".currencyWithTooltip",function(e){clearTimeout(d),d=setTimeout(function(){$("#currencyTooltip").show()},400);var t=$(this).children().first().text();t=t.slice(0,-2);var a=$(this).children().eq(1),n=a.text(),i=a.attr("data-personal");$(".currencyTooltipName").text(t),$("#currencyTooltipTotal").text(n).removeClass().addClass(oi(t)),$("#currencyTooltipMarketable").text(i).removeClass().addClass(oi(t));var o=$("#currencyTooltip"),r=window.innerWidth,s=$(document).height(),l=!1,c=0,p=0,u=!1;$(this).offset().left+$(this).width()>r/2?(c=$(this).offset().left-o.width()-22,u="left"):(c=$(this).offset().left+$(this).width()+22,u="right"),(c<0||c+o.width()>r)&&(l=!0),l?(c=$(this).offset().left,u="bottom",(p=$(this).offset().top+$(this).height())+o.height()>s&&((p=$(this).offset().top-o.height())<0?(u="bottom",p=$(this).offset().top+$(this).height()):u="top")):(p=Math.max(0,$(this).offset().top-o.height()/2))+o.height()>s&&(p=$(this).offset().top-o.height()-20,c=$(this).offset().left-$(this).width()/2,u="top"),o.css("left",c).css("top",p).removeClass("tooltip_top tooltip_bottom tooltip_left tooltip_right").addClass("tooltip_"+u)}),$("#statsTable,#resourcesTable").on("mouseout",".currencyWithTooltip",function(e){clearTimeout(d),d=setTimeout(function(){$("#currencyTooltip").hide()},400)}),$("#currencyTooltip").on("mouseover",function(){clearTimeout(d)}),$("#currencyTooltip").on("mouseout",function(){d=setTimeout(function(){$("#currencyTooltip").hide()},400)}),$("#tradesTable").on("mouseover",".levelWithTooltip",function(e){clearTimeout(p),p=setTimeout(function(){$("#levelTooltip").show()},400);var t=$(this).attr("data-skill");$("#levelTooltipName").text(t+" ("+$(this).attr("data-level")+")"),$("#tradeTooltipXPBar").removeClass().addClass(oi(t));var a=$(this).attr("data-xp"),n=$(this).attr("data-tnl"),i=Math.min(100,a/n*100);$("#currentTradeTooltipXP").text(ui(a)),$("#tradeTooltipLevelCost").text(ui(n)),$("#tradeTooltipLevelPercent").text(ui(i,2)),$("#tradeTooltipXPFill").css("width",i+"%");var o=$("#levelTooltip"),r=window.innerWidth,s=$(document).height(),l=!1,c=0,d=0,u=!1;$(this).offset().left+$(this).width()>r/2?(c=$(this).offset().left-o.width()-22,u="left"):(c=$(this).offset().left+$(this).width()+22,u="right"),(c<0||c+o.width()>r)&&(l=!0),l?(c=$(this).offset().left,u="bottom",(d=$(this).offset().top+$(this).height())+o.height()>s&&((d=$(this).offset().top-o.height())<0?(u="bottom",d=$(this).offset().top+$(this).height()):u="top")):(d=Math.max(0,$(this).offset().top-o.height()/2))+o.height()>s&&(d=$(this).offset().top-o.height()-20,c=$(this).offset().left-$(this).width()/2,u="top"),o.css("left",c).css("top",d).removeClass("tooltip_top tooltip_bottom tooltip_left tooltip_right").addClass("tooltip_"+u)}),$("#tradesTable").on("mouseout",".levelWithTooltip",function(e){clearTimeout(p),p=setTimeout(function(){$("#levelTooltip").hide()},400)}),$("#levelTooltip").on("mouseover",function(){clearTimeout(p)}),$("#levelTooltip").on("mouseout",function(){p=setTimeout(function(){$("#levelTooltip").hide()},400)}),$("#inventoryWrapper,#houseViewedRoomItemWrapper,.marketListings").on("click",".itemWithTooltip",function(e){e.preventDefault(),"marketListings"==$(this).closest("table").attr("id")&&$("#marketMyListings").is(":hidden")||e.shiftKey&&(na(JSON.parse($(this).attr("data-json"))),e.ctrlKey||_a())}),$("#inventoryWrapper,#houseViewedRoomItemWrapper,.marketListings").on("click",".gemWithTooltip",function(e){e.preventDefault(),"marketListings"==$(this).closest("table").attr("id")&&$("#marketMyListings").is(":hidden")||e.shiftKey&&(ia(JSON.parse($(this).attr("data-json"))),e.ctrlKey||_a())})}function ra(){$("#massButtonHolder,#massDeconstruct,#gemFilterHolder").show(),$("#massScrap,#inventoryItemCountWrapper").hide(),yt("inventory_gems",{})}function sa(e){var t=$("#inventoryTable");t.empty(),"No items"===e?t.html('<tr><td class="center nomatch" style="vertical-align: top;">You aren\'t carrying any gems.</td></tr>'):(t.append('<tr class="hidden-xs hidden-sm"><th>Gem</td><th>Tier</th><th>Actions</th></tr>'),$.each(e,function(e,a){t.append('<tr><td data-th="Gem">'+xt(a)+'</td><td data-th="Tier">'+ui(Math.floor(a.l/10))+'</td><td data-th="Actions" style="font-size: 80%;" data-gemid="'+a.i+'"><a class="marketGemLink">[Market]</a> <a class="deconstructLink">[Deconstruct]</a> <a class="chatGemLink">[Chat]</a> <a class="moreGemOptions">[More]</a></td></tr>')}),$("#gemInventoryFilter").keyup())}function la(e){var t,a=$("#inventoryTable");if(a.empty(),"No items"===e.result)a.html('<tr><td class="center nomatch" style="vertical-align: top;">You aren\'t carrying any '+e.item_type+".</td></tr>");else{var n={Swords:"Damage",Bows:"Damage",Staves:"Damage",Helmets:"Armor",Breastplates:"Armor",Gloves:"Armor",Boots:"Armor",Shields:"Armor",Quivers:"Armor",Rakes:"Damage",Muskets:"Damage","Leaf Blowers":"Damage",Fingerlings:"Damage",Cornucopias:"Armor","Meshed Potatoes":"Armor","Oven Mitts":"Armor","Bread Loafers":"Armor","Serving Platters":"Armor"};$("#massSell,#massScrap").attr("data-type",e.item_type);var i=parseInt($("#level").text().replace(/,/g,""));$.each(e.result,function(e,o){void 0!==t&&a.append('<tr class="hidden-xs hidden-sm"><th style="height: 24px;"></td></tr>'),t=1,a.append('<tr><th colspan="5" class="invTypeHeader" data-th="'+e+'"><strong>'+e+'</strong></td></tr><tr class="hidden-xs hidden-sm"><td><strong>Item Name</strong></td><td><strong>Level</strong></td><td><strong>'+n[e]+"</strong></td><td><strong>Gems</strong></td><td><strong>Actions</strong></td></tr>"),$.each(o,function(t,o){var r=JSON.parse($("#"+Ke[o.s]).attr("data-json")).p;a.append('<tr><td data-th="Item">'+Ct(o)+'</td><td data-th="Level"'+(i<o.l?' class="failure"':"")+">"+o.l+'</td><td data-th="'+n[e]+'">'+(o.p>r?'<span class="higherPower">':"<span>")+o.p+'</span></td><td data-th="Gems">'+(o.hog?'<span class="higherPower">':"")+(o.gs-o.gsr)+"/"+o.gs+(o.hog?"</span>":"")+'</td><td data-th="Actions" style="font-size: 80%;" data-itemid="'+o.i+'"><a class="equipLink'+(i<o.l?" disabled":"")+'">[Equip]</a> <a class="marketLink">[Market]</a> <a class="scrapLink">[Scrap]</a> <a class="itemClanDonateLink">[Donate]</a> <a class="chatItemLink">[Chat]</a> <a class="moreItemOptions">[More]</a></td></tr>')})})}}function ca(e){var t=$("#clanInventoryTable").dataTable();t.fnClearTable(),$("#armory_held").text(e.result.item_count),$("#armory_max").text(e.result.max_items+" item"+(1==e.result.max_items?"":"s")),e.result.items.length&&t.fnAddData(e.result.items),t.fnPageChange(0)}function da(e){"gem"!=e?(yt("inventory_items",{item_type:e}),"accessory"==e?$("#massButtonHolder").hide():($("#massButtonHolder,#massScrap,#inventoryItemCountWrapper").show(),$("#massDeconstruct,#gemFilterHolder").hide())):ra()}function pa(){clearTimeout(g),g=setTimeout(function(){$("#eventCalendarLink").text(function(){var e=moment().tz("America/New_York"),t=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),a=new Array("Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sep","Oct","Nov","Dec"),n=(t[e.get("day")],e.get("date")),i=a[e.get("month")],o=(e.get("year"),e.get("hour")),r=e.get("minute"),s=e.get("second");n<10&&(n="0"+n);o<10&&(o="0"+o);i<10&&(i="0"+i);r<10&&(r="0"+r);s<10&&(s="0"+s);return i+" "+n+" - "+o+":"+r+":"+s+" "+(o>=20||o<=5?"ðŸŒ™":"â˜€ï¸")}()),pa()},1e3)}function ua(){clearTimeout(f),f=setTimeout(function(){!function(){var e=Date.now(),t=0;jQuery.isEmptyObject(dt)?$("#effectInfo").hide():($("#effectTable").empty(),$("#effectInfo").show(),$.each(dt,function(a,n){var i=n.n,o=$('#effectTable div[statid="'+n.t+'"]');n.e>e?(t=1,o.length?(o.children().first().children().first().text(i+":"),o.children().first().children().last().html(ci((n.e-e)/1e3)),o.attr("data-statname",n.n)):$("#effectTable").append('<div class="statWithTooltip col-xs-6 col-md-12" statid="'+n.t+'" data-statname="'+i+'"><div class="row"><div class="col-xs-6 col-md-12 col-lg-5">'+i+':</div><div class="col-xs-6 col-md-12 col-lg-7">'+ci((n.e-e)/1e3)+"</div></div></div>")):o&&(delete dt[a],o.remove())}),t<0?$("#effectTable").hide():$("#effectTable").show());ua()}()},1e3)}function ma(){clearTimeout(_),_=setTimeout(function(){!function(){var e=Date.now();ut?($("#eventCountdown").show(),ut>e?$("#eventCountdown").html(ci((ut-e)/1e3)):$("#eventCountdown").text("!")):$("#eventCountdown").hide();ma()}()},1e3)}function ha(){clearTimeout(v),v=setTimeout(function(){!function(){var e=Date.now(),t=0;$.isEmptyObject(pt)?$("#houseTimerInfo").hide():($("#houseTimerInfo").show(),$.each(pt,function(a,n){var i=n.n,o=$('#houseTimerTable div[data-typeid="'+i+'"]');n.next>e?(t=1,o.length?(o.children().first().children().first().text(i+":"),o.children().first().children().last().html(ci((n.next-e)/1e3))):$("#houseTimerTable").append('<div class="col-xs-6 col-md-12" data-typeid="'+i+'"><div class="row"><div class="col-xs-6 col-md-12 col-lg-5">'+i+':</div><div class="col-xs-6 col-md-12 col-lg-7">'+ci((n.next-e)/1e3)+"</div></div></div>")):o&&(pt[a]=null,delete pt[a],o.remove(),"Construction"==i&&$("#constructionNotifier").show())}),t<0?$("#houseTimerTable").hide():$("#houseTimerTable").show(),$.isEmptyObject(pt)&&$("#houseTimerInfo").hide());ha()}()},1e3)}function fa(e,t,a,n,i,o){var r,s="",l=1==o?" time.":" times.",c=Ue[n];a={"-1":"fists",0:"sword",1:"staff",2:"bow",100:"bite",101:"claw",102:"sting",103:"slam",104:"drain",105:"swarm",106:"strangle",107:"stab",108:"club",109:"whip",110:"chill",111:"deafen",112:"cleave",113:"burn",114:"pierce",115:"confuse",116:"prick",117:"shock",118:"blind",119:"drown",120:"suffocate",150:"musket",151:"rake",152:"leaf_blower",153:"fingerling"}[a],"enemy"==e?(r='<span class="ally">you</span>',s+='<span class="enemyName"></span> '):(r='<span class="enemyName"></span>',s+='<span class="ally">You</span> ');var d=i?' <span style="color:'+c+';">'+i+"</span>":"";return"fists"==a?s+="swung at "+r+" with "+t+d+" "+o+" "+l:"bow"==a?s+="aimed "+t+d+" and fired an arrow at "+r+" "+o+" "+l:"sword"==a?s+="sliced at "+r+" with "+t+d+" "+o+" "+l:"staff"==a?s+="swung at "+r+" with "+t+d+" "+o+" "+l:"bite"==a?s+="chomped at "+r+" with "+t+" teeth "+o+" "+l:"claw"==a?s+="clawed at "+r+(i?" with "+t+d:"")+" "+o+" "+l:"sting"==a?s+="tried to sting "+r+" with "+t+d+" "+o+" "+l:"slam"==a?s+="tried to slam "+r+" with "+t+d+" "+o+" "+l:"drain"==a?s+="attempted to drain "+r+" with "+t+d+" "+o+" "+l:"swarm"==a?s+="swarmed at "+r+" "+o+" "+l:"strangle"==a?s+="attempted to strangle "+r+" with "+t+d+" "+o+" "+l:"stab"==a?s+="stabbed at "+r+" with "+t+d+" "+o+" "+l:"club"==a?s+="tried to club "+r+" with "+t+d+" "+o+" "+l:"whip"==a?s+="whipped "+t+d+" at "+r+" "+o+" "+l:"chill"==a?s+="tried to chill "+r+" with "+t+d+" "+o+" "+l:"deafen"==a?s+="tried to deafen "+r+" with "+t+d+" "+o+" "+l:"cleave"==a?s+="swung "+t+d+" wildly in an attempt to cleave "+r+" "+o+" "+l:"shock"==a?s+="shocked "+r+" with "+t+d+" "+o+" "+l:"burn"==a?s+="tried to burn "+r+" with "+t+d+" "+o+" "+l:"pierce"==a?s+="raised "+t+d+" at "+r+" in attempt to pierce through "+("enemy"==e?"your":"their")+" skin "+o+" "+l:"confuse"==a?s+="tried to confuse "+r+" with "+t+d+" "+o+" "+l:"prick"==a?s+="tried to prick "+r+" with "+t+d+" "+o+" "+l:"blind"==a?s+="tried to blind "+r+" with "+t+d+" "+o+" "+l:"drown"==a?s+="tried to drown "+r+" with "+t+d+" "+o+" "+l:"suffocate"==a?s+="tried to suffocate "+r+" with "+t+d+" "+o+" "+l:"musket"==a?s+="aimed "+t+d+" and fired at "+r+" "+o+" "+l:"rake"==a?s+="swiped at "+r+" with "+t+d+" "+o+" "+l:"leaf_blower"==a?s+="tried to blow "+r+" away with "+t+d+" "+o+" "+l:"fingerling"==a&&(s+="prodded "+r+" with "+t+d+" "+o+" "+l),s}function $a(e,t,a,n){var i,o,r="";o={"-1":"fists",0:"sword",1:"staff",2:"bow",100:"bite",101:"claw",102:"sting",103:"slam",104:"drain",105:"swarm",106:"strangle",107:"stab",108:"club",109:"whip",110:"chill",111:"deafen",112:"cleave",113:"burn",114:"pierce",115:"confuse",116:"prick",117:"shock",118:"blind",119:"drown",120:"suffocate",150:"musket",151:"rake",152:"leaf_blower",153:"fingerling"}[t.s];var s=Ue[t.q],l=e.npc?e.npc:"your";if(e.crit&&(r+='<span style="color: red;">*'+(1==e.crit?"":e.crit+"x ")+"CRIT*</span> "),e.npc){if(i='<span class="ally">you</span>',r+='<span class="'+(n?"bossName":"enemyName")+'"></span> ',!n){lt.playerInfo.hp.c-=e.dmg;var c=Math.max(0,lt.playerInfo.hp.c/lt.playerInfo.hp.m*100);$(".currentPlayerHP").text(fn(Math.max(0,lt.playerInfo.hp.c),1e7)),$(".PlayerHPFill").animate({width:c+"%"},a)}}else if(i='<span class="'+(n?"bossName":"enemyName")+'"></span>',r+='<span class="ally">You</span> ',!n){lt.monsterInfo.hp.c-=e.dmg;c=Math.max(0,lt.monsterInfo.hp.c/lt.monsterInfo.hp.m*100);$(".currentMonsterHP").text(fn(Math.max(0,lt.monsterInfo.hp.c),1e7)),$(".MonsterHPFill").animate({width:c+"%"},a)}if("counter"==e.type)return e.dmg>0?r+='counter the attack, dealing <span class="opal">'+ui(e.dmg)+"</span> damage.":r+="attempt to counter the attack, but miss.",r;if("spell"==e.type)return r+='cast a spell at <span class="'+(n?"bossName":"enemyName")+'"></span>, dealing <span class="opal">'+ui(e.dmg)+"</span> damage.";if("poison"==e.type)return r+='poison dealt <span style="color:#7300E6">'+ui(e.dmg)+'</span> damage to <span class="'+(n?"bossName":"enemyName")+'"></span>!';if("scorch"==e.type)return r='You scorched <span class="'+(n?"bossName":"enemyName")+"\"></span>'s armor!";var d=e.dmg?" hitting "+e.hits+" time"+(1==e.hits?"":"s")+', dealing <span class="opal">'+ui(e.dmg)+"</span> damage.":", but miss"+(e.npc?"es":"")+"!",p=e.hits+e.misses,u=' <span style="color:'+s+';">'+t.n+"</span>";return"fists"==o?r+="swing"+(e.npc?"s":"")+" at "+i+" with "+l+' <span style="color:'+s+';">'+t.n+"</span> "+p+(1==p?" time":" times")+d:"bow"==o?r+="aim"+(e.npc?"s ":" ")+l+' <span style="color:'+s+';">'+t.n+"</span> and fire"+(e.npc?"s ":" ")+" an arrow at "+i+" "+p+(1==p?" time":" times")+d:"sword"==o?r+="slice"+(e.npc?"s":"")+" at "+i+" with "+l+' <span style="color:'+s+';">'+t.n+"</span> "+p+(1==p?" time":" times")+d:"staff"==o?r+="swing"+(e.npc?"s":"")+" at "+i+" with "+l+' <span style="color:'+s+';">'+t.n+"</span> "+p+(1==p?" time":" times")+d:"bite"==o?r+="chomp"+(e.npc?"s":"")+" at "+i+" with "+l+" teeth "+p+(1==p?" time":" times")+d:"claw"==o?r+="claw"+(e.npc?"s":"")+" at "+i+(t.length?" with "+l+u:"")+" "+p+(1==p?" time":" times")+d:"sting"==o?r+="tr"+(e.npc?"ies":"y")+" to sting "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"slam"==o?r+="tr"+(e.npc?"ies":"y")+" to slam "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"drain"==o?r+="attempt"+(e.npc?"s":"")+" to drain "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"swarm"==o?r+="swarm"+(e.npc?"s":"")+" at "+i+" "+p+(1==p?" time":" times")+d:"strangle"==o?r+="attempt"+(e.npc?"s":"")+" to strangle "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"stab"==o?r+="stab"+(e.npc?"s":"")+" at "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"club"==o?r+="tr"+(e.npc?"ies":"y")+" to club "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"whip"==o?r+="whip"+(e.npc?"s":"")+" "+l+u+" at "+i+" "+p+(1==p?" time":" times")+d:"chill"==o?r+="tr"+(e.npc?"ies":"y")+" to chill "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"deafen"==o?r+="tr"+(e.npc?"ies":"y")+" to deafen "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"cleave"==o?r+="swing"+(e.npc?"s":"")+" "+l+u+" wildly "+p+(1==p?" time":" times")+" in attempt to cleave "+i+d:"shock"==o?r+="attempt"+(e.npc?"s":"")+" to shock "+i+" with "+l+u+" "+p+" "+(1==p?" time":" times")+d:"burn"==o?r+="tr"+(e.npc?"ies":"y")+" to burn "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"pierce"==o?r+="raise"+(e.npc?"s":"")+" "+l+u+" at "+i+" in attempt to pierce through "+(e.npc?"your":"their")+" skin "+p+(1==p?" time":" times")+d:"confuse"==o?r+="tr"+(e.npc?"ies":"y")+" to confuse "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"prick"==o?r+="tr"+(e.npc?"ies":"y")+" to prick "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"blind"==o?r+="tr"+(e.npc?"ies":"y")+" to blind "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"drown"==o?r+="tr"+(e.npc?"ies":"y")+" to drown "+i+" "+p+(1==p?" time":" times")+d:"suffocate"==o?r+="tr"+(e.npc?"ies":"y")+" to suffocate "+i+" with "+l+u+" "+p+(1==p?" time":" times")+d:"musket"==o?r+="aim"+(e.npc?"s ":" ")+l+' <span style="color:'+s+';">'+t.n+"</span> and fire"+(e.npc?"s ":" ")+" at "+i+" "+p+(1==p?" time":" times")+d:"rake"==o?r+="swipe"+(e.npc?"s":"")+" at "+i+" with "+l+' <span style="color:'+s+';">'+t.n+"</span> "+p+(1==p?" time":" times")+d:"leaf_blower"==o?r+="tr"+(e.npc?"ies":"y")+" to blow "+i+" away with "+l+u+" "+p+(1==p?" time":" times")+d:"fingerling"==o&&(r+="prodd"+(e.npc?"s":"")+i+" with "+l+u+" "+p+(1==p?" time":" times")+d),r}function va(e){$("#modalTitle").html(e.title),L.html(e.content),M.fadeIn("medium"),R.fadeIn("medium"),L.css("height",""),L.css("max-height",""),R.css("height",""),R.css("max-height",""),M.css("height",window.innerHeight)}function ga(e){var t=$("#modal2Wrapper");$("#modal2Title").html(e.title),D.html(e.content),M.is(":visible")||M.fadeIn("medium"),t.fadeIn("medium"),M.css("z-index",104)}function _a(){var e=$("#modal2Wrapper");D.empty(),e.is(":visible")?(M.css("z-index",94),e.fadeOut("medium")):(R.fadeOut("medium"),M.fadeOut("medium"),ya()),R.is(":visible")||M.fadeOut("medium")}function ya(){$("#modToolWrapper,#eventCalendarWrapper,#bossModalWrapper,#chatMessageHistoryWrapper,#rulesWrapper,#gameRulesWrapper,#chatRulesWrapper,#houseWrapper,#house_notification,#premium_shop_notification,#premiumShopWrapper,#shortActivityWrapper,#accountActivityWrapper,#title_notification,#gameStatsWrapper,#onlineListWrapper,#rankingsWrapper,#milestonesWrapper,#accountRegistrationWrapper,#accountManagementWrapper,#account_management_notification,#clanWrapper,#viewedClanWrapper,#inventoryWrapper,#trainingWrapper,#marketWrapper,#questWrapper,#updateWrapper,#market_notification,#quest_notification,#train_notification,#profileWrapper,#chatHelpWrapper,#gameHelpWrapper,#helpWrapper").hide()}function ba(e){var t;e.mobdesc&&$("#mobDesc").html(e.mobdesc.desc+(e.mobdesc.fight?' <a id="fight">[Fight]</a>':"")+(e.mobdesc.talk?' <a id="talk">[Talk]</a>':"")),e.greeting&&(t=e.greeting,clearTimeout(window.greeting),window.greeting=setTimeout(function(){t.highlight&&(ht.push(t.highlight),$(t.highlight).css("-webkit-animation","pulsate-outer .8s infinite alternate").css("-moz-animation","pulsate-outer .8s infinite alternate").css("-animation","pulsate-outer .8s infinite alternate")),ka(t.message)},t.delay)),e.mobdesc.talk&&$("#talk").on("click",function(){window.clearTimeout(window.greeting),$(this).fadeOut(0).delay(2e3).fadeIn(200),$.get("talk.php",function(e){ka(e.message)})})}function ka(e){bn($("#interactionInfo"),e)}function wa(e){$("#basePage>a").html(e.tn),$("#loadBlacksmith").html(e.bs),$("#loadMobList,#battleGrounds>a").html(e.el)}function Ca(){Da(),yt("town_blacksmith",{})}function xa(e){$("#breastplate_sell").html(Ct(e.shop_info.bp)),$("#helmet_sell").html(Ct(e.shop_info.he)),$("#gloves_sell").html(Ct(e.shop_info.gl)),$("#boots_sell").html(Ct(e.shop_info.bo)),$("#sword_sell").html(Ct(e.shop_info.sw)),$("#staff_sell").html(Ct(e.shop_info.st)),$("#bow_sell").html(Ct(e.shop_info.bow)),$("#shield_sell").html(Ct(e.shop_info.sh)),$("#quiver_sell").html(Ct(e.shop_info.qu)),$("#rod_sell").html(Wt(e.shop_info.rod)),$("#axe_sell").html(Wt(e.shop_info.axe)),$("#pickaxe_sell").html(Wt(e.shop_info.pa)),$("#chisel_sell").html(Wt(e.shop_info.ch)),$("#hammer_sell").html(Wt(e.shop_info.ha)),$("#saw_sell").html(Wt(e.shop_info.saw)),$('.tool_cost[data-type="food"]').attr("data-tier",e.shop_info.rod.tier).html("<span>"+e.shop_info.rod.cost+"</span>"),$('.tool_cost[data-type="wood"]').attr("data-tier",e.shop_info.axe.tier).html("<span>"+e.shop_info.axe.cost+"</span>"),$('.tool_cost[data-type="iron"]').attr("data-tier",e.shop_info.pa.tier).html("<span>"+e.shop_info.pa.cost+"</span>"),$('.tool_cost[data-type="stone"]').attr("data-tier",e.shop_info.ch.tier).html("<span>"+e.shop_info.ch.cost+"</span>"),$('.tool_cost[data-type="crafting"]').attr("data-tier",e.shop_info.ha.tier).html("<span>"+e.shop_info.ha.cost+"</span>"),$('.tool_cost[data-type="carving"]').attr("data-tier",e.shop_info.saw.tier).html("<span>"+e.shop_info.saw.cost+"</span>"),$(".item_cost").each(function(){$(this).attr("data-tier",e.shop_info.i_t),$(this).html("<span>"+ui(e.shop_info.i_p)+" Gold</span>")})}function Ta(e){$("#dungeonRoomWrapper").show(),$("#areaName").html("Eternal Dungeon"),$("#roomName").html(function(e){if(e>3&&e<21)return e+"th";switch(e%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd";default:return e+"th"}}(e.floor)+" Floor"),$("#dungeonRoomDescription").html(ot[e.desc]),$("#dungeonMap").html(e.map),e.search?$("#dungeonSearch").removeClass("disabled"):$("#dungeonSearch").addClass("disabled"),$("#dungeonEnemyList").html(""),$.each(e.enemies,function(e,t){$("#dungeonEnemyList").append("<li>"+t.desc+' <a class="dungeon_fight" data-id="'+t.id+'">[Fight]</a></li>')}),e.n?$('.dungeon_move[data-direction="north"]').removeClass("disabled"):$('.dungeon_move[data-direction="north"]').addClass("disabled"),e.s?$('.dungeon_move[data-direction="south"]').removeClass("disabled"):$('.dungeon_move[data-direction="south"]').addClass("disabled"),e.e?$('.dungeon_move[data-direction="east"]').removeClass("disabled"):$('.dungeon_move[data-direction="east"]').addClass("disabled"),e.w?$('.dungeon_move[data-direction="west"]').removeClass("disabled"):$('.dungeon_move[data-direction="west"]').addClass("disabled"),e.d?$('.dungeon_move[data-direction="down"]').removeClass("disabled"):$('.dungeon_move[data-direction="down"]').addClass("disabled")}function Wa(){yt("town",{})}function La(e,t,a){yt("buy_item",{item_type:e,tier:t,confirm:a=a||!1})}function Da(){Be.hide(),Pe.hide(),Ae.removeClass("fatigued"),ht.length&&($.each(ht,function(e,t){$(t).css("-webkit-animation","").css("-moz-animation","").css("-animation","")}),ht=[]),$("#mobDesc,#interactionInfo,#area_list_notification").empty(),clearTimeout(window.greeting),clearTimeout(n),clearInterval(window.currentinterval),clearInterval(window.roundinterval),document.title="Relics of Avabur"}function Ra(e){$(".bossParticipantWrapper").show();var t=$(".bossParticipantList");$.each(t,function(t,a){var n=$(a).dataTable();n.fnClearTable(),e.pl.length&&n.fnAddData(e.pl),n.fnPageChange(0)})}function Ma(){yt("event_participants",{})}function Ia(e,t){var a=e.p.autos_remaining;a>0?document.title=a+" Stamina - Relics of Avabur":(document.title="Fatigued - Relics of Avabur",a),$(".currentBossHP").text(ui(e.bhp)),$(".maxBossHP").text(ui(e.bmhp)),$(".BossHPFill,.BossHPFill").width(e.bhp/e.bmhp*100+"%"),$(".bossHitPointPercent").text(ui(e.bhp/e.bmhp*100,2)),$("#currentBossPlayerHP").text(ui(e.hp)),$("#maxBossPlayerHP").text(ui(e.mhp)),$("#PlayerBossHPFill").width(e.hp/e.mhp*100+"%");var n=e.food/e.foodcost*100,i=e.wood/e.woodcost*100,o=e.iron/e.ironcost*100,r=e.stone/e.stonecost*100;$("#currentBossFoodTier").text(e.foodTier),$("#currentBossWoodTier").text(e.woodTier),$("#currentBossIronTier").text(e.ironTier),$("#currentBossStoneTier").text(e.stoneTier),$("#currentBossFood").text(ui(e.food)),$("#bossFoodCost").text(ui(e.foodcost)),$("#bossFoodPercent").text(ui(n,2)),$('.bossResourceFill[data-type="food"]').css("width",n+"%"),$("#currentBossWood").text(ui(e.wood)),$("#bossWoodCost").text(ui(e.woodcost)),$("#bossWoodPercent").text(ui(i,2)),$('.bossResourceFill[data-type="wood"]').css("width",i+"%"),$("#currentBossIron").text(ui(e.iron)),$("#bossIronCost").text(ui(e.ironcost)),$("#bossIronPercent").text(ui(o,2)),$('.bossResourceFill[data-type="iron"]').css("width",o+"%"),$("#currentBossStone").text(ui(e.stone)),$("#bossStoneCost").text(ui(e.stonecost)),$("#bossStonePercent").text(ui(r,2)),$('.bossResourceFill[data-type="stone"]').css("width",r+"%"),e.so&&m.play(),e.harvestInfo.length&&($("#bossWrapper>.bossPrepareWrapper,#bossWrapper>.bossNotHere,#bossBattleWrapper").hide(),$("#bossStatWrapper,#bossHarvestWrapper,.battleBossTextWrapper").show(),$("#tradeBossGainList").append("<li>You found "+e.harvestInfo+"</li>"),$("#tradeBossGainList").children()&&$("#tradeBossGainList").children().length>50&&$("#tradeBossGainList li:first-child").remove(),$("#tradeBossGainWrapper").is(":hover")||$("#tradeBossGainWrapper").animate({scrollTop:$("#tradeBossGainWrapper").prop("scrollHeight")},0)),e.battleInfo.length&&($("#bossWrapper>.bossPrepareWrapper,#bossWrapper>.bossNotHere,#bossHarvestWrapper").hide(),t?($("#bossStatWrapper").hide(),$("#bossBattleWrapper,.hpContainer,.battleBossTextWrapper").show()):$("#bossStatWrapper,#bossBattleWrapper,.hpContainer,.battleBossTextWrapper").show(),function(e,t,a,n,i){var o=0;!function r(){"heal"==e[o].type?($(".battleBossText").prepend('<li>You healed <span style="color: green;">'+ui(e[o].dmg)+" HP!</li>"),e[o].dmg*=-1):$(".battleBossText").prepend("<li>"+$a(e[o],e[o].npc?t:a,n,1)+"</li>");hn(e[o].npc?1:0,e[o].dmg,e[o].type,1);o++;$(".enemyBossName,.bossName:not([named])").text(i).attr("named","true");$(".battleBossText").children()&&$(".battleBossText").children().length>50&&$(".battleBossText li:last-child").remove();o<e.length&&setTimeout(function(){r()},(n-1e3)/e.length)}()}(e.battleInfo,e.bossWeapon,e.playerWeapon,e.next_action,e.bossname)),$("#bossTimeRemaining").text(ci(e.time_remaining)),$(".enemyBossName,.bossName:not([named])").text(e.bossname)}function Sa(){Oe.not(":visible").length&&(Da(),Oe.show(),$(".autosAreCanceled,.staminaBeingReplenished,.autoWrapper,.fatigueWrapper,.bossNotHere,.eventShopWrapper,.bossParticipantWrapper,#bossStatWrapper,#bossBattleWrapper,#bossHarvestWrapper").hide(),$("#playerBossName").text($("#username").text()),$(".bossPrepareWrapper").show()),Ga()}function Aa(e){if(C.show(),$(".eventShopWrapper").hide(),e.pl?Ra(e):$("#bossWrapper>.bossParticipantWrapper").hide(),e.active)if("Failed"===e.status){if(e.message)return n=e.message,$(".bossPrepareWrapper,.boss_failure_notification").show(),$("#bossStatWrapper,#bossBattleWrapper,#bossHarvestWrapper").hide(),void $(".boss_failure_notification").text(n)}else{var t=e.p.autos_remaining;if($(".autosMaximum").text(ui(e.p.autos_max)),t>=0)0==t?$(".autoWrapper").show().addClass("failure"):$(".autoWrapper").show().removeClass("failure"),$(".fatigueWrapper,.staminaBeingReplenished").hide();else{$(".autoWrapper,.staminaBeingReplenished").hide(),$(".fatigueWrapper").show();var a=Math.abs(t);$(".bossFatigueAutos").text(a+(1==a?" action":" actions"))}$(".boss_failure_notification").text("").hide(),Ya(),Ia(e),Ua(e.p),Ga()}else $(".bossNotHere,.bossParticipantWrapper").show(),$("#bossStatWrapper,#bossBattleWrapper,#bossHarvestWrapper,.boss_failure_notification").hide();var n}function Ba(){Ne.not(":visible").length&&(Da(),Ne.show(),$("#dungeonInfo,#tradeskillInfo,#tradeskillQuest,#professionQuest,#craftingInfo,#carvingInfo,#bossWrapper").hide(),$("#resourcesTable,#tradesTable").addClass("hidden-xs").addClass("hidden-sm"),$("#attrTable,#skillTable").removeClass("hidden-xs").removeClass("hidden-sm"),$("#battleInfo,#battleQuest").show(),$(".playerName").text($("#username").text()),$("#battlePrepareWrapper").show(),$(".autosAreCanceled,.staminaBeingReplenished,.autoWrapper,.fatigueWrapper,#battleStatusButtons,.hpContainer,.battleTextContainer,.summary,.battleResult,.battleRewards,.battleClanRewards,#battleIngredientResult,.battleLevelResult,#battleQuestResult,.battleStatResult,#battleDropResult,#battleContinueButtons").hide(),$("#actionTimeWrapper").css("width","100%")),Ga()}function Pa(e){if($("#battlePrepareWrapper").hide(),$(".hpContainer,#battleStatusButtons,.battleTextContainer,.battleTextWrapper").show(),$("#actionTimeWrapper").css("width",""),"Failed"!=e.status){var t=e.p.autos_remaining;if($(".autosMaximum").text(ui(e.p.autos_max)),t>=0)0==t?$(".autoWrapper").show().addClass("failure"):$(".autoWrapper").show().removeClass("failure"),$(".fatigueWrapper,.staminaBeingReplenished").hide();else{$(".autoWrapper,.staminaBeingReplenished").hide(),$(".fatigueWrapper").show();var a=Math.abs(t);$("#battleFatigueAutos").text(a+" battle"+(1==a?"":"s"))}Ya(),un(e),Ga()}else Va(e.message)}function Na(){qe.not(":visible").length&&(Da(),qe.show(),$("#dungeonInfo,#battleInfo,#battleQuest,#professionQuest,#craftingInfo,#carvingInfo,#bossWrapper").hide(),$("#resourcesTable,#tradesTable").removeClass("hidden-xs").removeClass("hidden-sm"),$("#attrTable,#skillTable").addClass("hidden-xs").addClass("hidden-sm"),$("#tradeskillInfo,#tradeskillQuest").show(),$("#harvestPrepareWrapper").show(),$(".autosAreCanceled,.staminaBeingReplenished,.autoWrapper,.fatigueWrapper,#harvestStatusButtons,#tsExpWrapper,#tradeskillInfoWrapper,#rightTradeWrapper,#tradeskillContinueButtons").hide(),$("#tradeActionTimeWrapper").css("width","100%")),Ga()}function qa(e){if($("#harvestPrepareWrapper").hide(),$("#harvestStatusButtons,#tradeskillInfoWrapper,#rightTradeWrapper,#tsExpWrapper").show(),"Failed"==e.status)return t=e.message,$(".autoWrapper,.staminaBeingReplenished,.fatigueWrapper").hide(),$("#tradeResult").html(t||"An error occurred while harvesting."),C.show(),$("#tradeRewards,#tradeClanRewards,#harvestLevelResult,#harvestQuestResult,#harvestingredientResult,#harvestStatResult,#harvestDropResult").hide(),$("#tradeskillInfoWrapper").show(),void $(document).attr("title","Autos Canceled - Relics of Avabur");var t,a=(e=e.results).p.autos_remaining;if($(".autosMaximum").text(ui(e.p.autos_max)),a>=0)0==a?$(".autoWrapper").show().addClass("failure"):$(".autoWrapper").show().removeClass("failure"),$(".fatigueWrapper,.staminaBeingReplenished").hide();else{$(".autoWrapper,.staminaBeingReplenished").hide(),$(".fatigueWrapper").show();var n=Math.abs(a);$("#harvestFatigueAutos").text(n+" harvest"+(1==n?"":"s"))}Ya(),function(e){var t=e.p.autos_remaining;t>0?document.title=t+" Stamina - Relics of Avabur":(document.title="Fatigued - Relics of Avabur",t);if($("#tradeMult").hide(),e.a.e)return $("#tradeResult").html(e.a.e),C.show(),void $("#tradeRewards").hide();e.a.l?1==e.a.l?$("#harvestLevelResult").html("You gained a "+e.a.s+" level!")&&Ja("You gained a "+e.a.s+" level!","loot_other","#FF7"):$("#harvestLevelResult").html("You gained "+e.a.l+" "+e.a.s+" levels!")&&Ja("You gained "+e.a.l+" "+e.a.s+" levels!","loot_other","#FF7"):$("#harvestLevelResult").html(""),e.a.c_l&&$("#harvestLevelResult").html('<a class="openToolUpgrade">You can increase your '+e.a.t+"'s level!</a>");Ua(e.p);var a=e.a.txp/e.a.tc*100;$("#harvestCurrentTag").text(ii(e.a.s)),$("#tradeDone").text(e.a.s),$("#resourceType,#resourceClanType").text(e.a.r),$("#tradeXPBar").first().hasClass(e.a.r)||($("#tradeXPBar,.harvestGainWrapper").removeClass("food wood iron stone").addClass(e.a.r),$("#tradeskillAgain").val("Continue "+ii(e.a.s)));$("#resourceGain").text(ui(e.a.a)),$("#resourceClanGain").text(ui(e.a.ca)+" ("+e.a.tax+"%)"),$("#harvestExpGain").text(ui(e.a.xp)),$("#currentTradeXP").text(ui(e.a.txp)),$("#tradeLevelCost").text(ui(e.a.tc)),$("#tradeLevelPercent").text(ui(a,2)),$("#tradeXPFill").width(a+"%"),$("#tradeResult").text((n=e.a.r,i=e.a.t,"food"==n?"You fished with your "+i+" for a while...":"wood"==n?"You chopped the trees with your "+i+" for a while...":"iron"==n?"You mined with your "+i+" for a while...":"stone"==n?"You carved stone with your "+i+" for a while...":void 0)),e.a.ca?$("#tradeClanRewards").show():$("#tradeClanRewards").hide(),$("#tradeGainList").append("<li>You gained "+e.a.a+" "+e.a.r+(e.a.ca>0?" (+"+e.a.ca+" to clan ["+e.a.tax+"%])":"")+".</li>"),$("#tradeGainList").children()&&$("#tradeGainList").children().length>50&&$("#tradeGainList li:first-child").remove();var n,i;$("#tradeGainWrapper").is(":hover")||$("#tradeGainWrapper").animate({scrollTop:$("#tradeGainWrapper").prop("scrollHeight")},0);e.a.so&&m.play();e.a.fb?Ae.addClass("fatigued"):Ae.removeClass("fatigued");e.a.sr?($("#harvestStatResult").html(e.a.sr.drop),Ja(e.a.sr,"loot_stats")):$("#harvestStatResult").html(""),e.a.dr?($("#harvestDropResult").html(e.a.dr.drop),Ja(e.a.dr,"loot_drops")):$("#harvestDropResult").html(""),e.a.ir?($("#harvestIngredientResult").html(e.a.ir.drop),Ja(e.a.ir,"loot_ingredients")):$("#harvestIngredientResult").html(""),$("#harvestQuestResult").html(e.a.qf),e.a.mult.mod>1&&($("#tradeMult").show(),$("#tradeMult").html(" "+nt[e.a.mult.mod]));o=e.a.a,r=e.a.ca,s=parseInt(E.attr("data-value"))+1,l=parseInt(O.attr("data-value"))+o,c=parseInt(H.attr("data-value"))+r,E.attr("data-value",s).html(ui(s)),O.attr("data-value",l).html(fn(l,1e7)),H.attr("data-value",c).html(fn(c,1e7)),$("#areaContent,#tradeRewards,#tradeRewards,#tradeClanRewards,#harvestLevelResult,#harvestQuestResult,#harvestIngredientResult,#harvestStatResult,#harvestDropResult").show(),ja();var o,r,s,l,c}(e),Ga()}function Fa(){Fe.not(":visible").length&&(_a(),Da(),Fe.show(),$("#dungeonInfo,#battleInfo,#battleQuest,#tradeskillQuest,#tradeskillInfo,#carvingInfo,#bossWrapper").hide(),$("#resourcesTable,#tradesTable").removeClass("hidden-xs").addClass("hidden-sm"),$("#attrTable,#skillTable").addClass("hidden-xs").removeClass("hidden-sm"),$("#craftingInfo,#professionQuest").show(),$("#craftingPrepareWrapper").show(),$(".autosAreCanceled,.staminaBeingReplenished,.autoWrapper,.fatigueWrapper,#craftingStatusButtons,#craftingExpWrapper,#craftingInfoWrapper,#rightCraftingWrapper,#craftingContinueButtons").hide(),$("#craftingActionTimeWrapper").css("width","100%")),Ga()}function Ea(e){if($("#craftingPrepareWrapper").hide(),$("#craftingStatusButtons,#craftingInfoWrapper,#rightCraftingWrapper,#craftingExpWrapper").show(),"Failed"==e.status)return t=e.message,forceAutoStop=99,$(".autoWrapper,.staminaBeingReplenished,.fatigueWrapper").hide(),$("#craftingInfoWrapper").show(),$("#craftUsed").html(t||"An error occurred while crafting.").show(),C.show(),$("#craftRewards,#craftResult,#craftComplete,#craftLevelResult,#craftQuestResult,#craftIngredientResult,#craftStatResult,#craftDropResult").hide(),$("#craftInfoWrapper").show(),$(document).attr("title","Autos Canceled - Relics of Avabur"),$("#craftContinueButtons").show(),$("#craftContinue").prop("disabled",!1),void $("#craftContinue").show();var t,a=e.p.autos_remaining;if($(".autosMaximum").text(ui(e.p.autos_max)),a>=0)0==a?$(".autoWrapper").show().addClass("failure"):$(".autoWrapper").show().removeClass("failure"),$(".fatigueWrapper,.staminaBeingReplenished").hide();else{$(".autoWrapper,.staminaBeingReplenished").hide(),$(".fatigueWrapper").show();var n=Math.abs(a);$("#craftingFatigueAutos").text(n+(1==n?" crafting action":" crafting actions"))}Ya(),function(e){var t=e.p.autos_remaining;t>0?document.title=t+" Stamina - Relics of Avabur":(document.title="Fatigued - Relics of Avabur",t);if($("#craftMult").hide(),e.a.e)return $("#craftResult").html(e.a.e),C.show(),void $("#craftRewards").hide();e.a.l?1==e.a.l?$("#craftLevelResult").html("You gained a crafting level!")&&Ja("You gained a crafting level!","loot_other","#FF7"):$("#craftLevelResult").html("You gained "+e.a.l+" crafting levels!")&&Ja("You gained "+e.a.l+" crafting levels!","loot_other","#FF7"):$("#craftLevelResult").html(""),Ua(e.p);var a=Math.min(100,e.a.txp/e.a.tc*100),n=e.a.ac/e.a.ar*100;$("#craftingLevelXPFill").width(a+"%"),$("#currentCraftingXP").text(ui(e.a.txp)),$("#craftingLevelCost").text(ui(e.a.tc)),$("#craftingLevelPercent").text(ui(a,2)),$("#craftingXPBar").removeClass().addClass(e.a.qn),$("#currentCraftingCost").text(ui(e.a.ac)),$("#craftingCost").text(ui(e.a.ar)),$("#craftingPercent").text(ui(n,2)),$("#craftingXPFill").width(n+"%"),$("#craftCurrentItem").html(Ct(e.a.i)),$("#craftCurrentTool").text(e.a.t),$("#currentlyCrafting").html(e.a.fi),$("#craftExpGain").text(ui(e.a.xp)),$("#craftingQueuedCount").text(ui(e.a.cq)),$("#craftingQueuedMax").text(ui(e.a.mq)),e.a.cq<1&&$("#craftingStatusButtons").slideUp();$("#craftUsed").html(e.a.m),$("#craftingGainList").append("<li>"+e.a.m+"</li>"),$("#craftingGainList").children()&&$("#craftingGainList").children().length>50&&$("#craftingGainList li:first-child").remove();e.a.c?($("#craftComplete").html(e.a.c),$("#craftingGainList").append("<li>"+e.a.c+"</li>"),$("#craftingGainList").children()&&$("#craftingGainList").children().length>50&&$("#craftingGainList li:first-child").remove()):$("#craftComplete").html("");var i=$('#houseViewedRoomItemWrapper .itemWithTooltip[data-json*=\'"i":'+e.a.i.i+"']");i&&i.closest("div").html(Ct(e.a.i)+" ("+ui(n,2)+"% to "+e.a.inl+")");$("#craftingItemBonuses").html("<li>Gemslots: "+e.a.i.gs+"</li>");var o=e.a.i.b;if(o){o=o.split(",");for(var r=0;r<o.length;r++)bonusSplit=o[r].split("="),bonusSplit[1]&&("percent"==bonusSplit[0].split(" ")[0]&&(bonusSplit[0]=bonusSplit[0].replace("percent",""),bonusSplit[1]=bonusSplit[1]+"%"),$("#craftingItemBonuses").append("<li>+"+bonusSplit[1]+" "+bonusSplit[0]+"</li>"))}$("#craftingGainWrapper").is(":hover")||$("#craftingGainWrapper").animate({scrollTop:$("#craftingGainWrapper").prop("scrollHeight")},0);e.a.so&&m.play();e.a.fb?Ae.addClass("fatigued"):Ae.removeClass("fatigued");e.a.sr?($("#craftStatResult").html(e.a.sr.drop),Ja(e.a.sr,"loot_stats")):$("#craftStatResult").html(""),e.a.dr?($("#craftDropResult").html(e.a.dr.drop),Ja(e.a.dr,"loot_drops")):$("#craftDropResult").html(""),e.a.ir?($("#craftIngredientResult").html(e.a.ir.drop),Ja(e.a.ir,"loot_ingredients")):$("#craftIngredientResult").html(""),$("#craftQuestResult").html(e.a.qf),e.a.mult.mod>1&&($("#craftMult").show(),$("#craftMult").html(" "+nt[e.a.mult.mod]));s=1,l=e.a.mu,c=e.a.xp,d=e.a.sa,p=parseInt(G.attr("data-value")),u=parseInt(Q.attr("data-value")),h=parseInt(Y.attr("data-value")),f=parseInt(U.attr("data-value")),p+=s,u+=l,h+=c,f+=d,G.attr("data-value",p).html(ui(p)),Q.attr("data-value",u).html(ui(u)),Y.attr("data-value",h).html(fn(h,1e7)),U.attr("data-value",f).html(ui(f)),$("#areaContent,#craftRewards,#craftResult,#craftComplete,#craftLevelResult,#craftQuestResult,#craftIngredientResult,#craftStatResult,#craftDropResult").show(),ja();var s,l,c,d,p,u,h,f}(e),Ga()}function Oa(){Ee.not(":visible").length&&(_a(),Da(),Ee.show(),$("#dungeonInfo,#battleInfo,#battleQuest,#tradeskillQuest,#tradeskillInfo,#craftingInfo,#bossWrapper").hide(),$("#resourcesTable,#tradesTable").removeClass("hidden-xs").addClass("hidden-sm"),$("#attrTable,#skillTable").addClass("hidden-xs").removeClass("hidden-sm"),$("#carvingInfo,#professionQuest").show(),$("#carvingPrepareWrapper").show(),$(".autosAreCanceled,.staminaBeingReplenished,.autoWrapper,.fatigueWrapper,#carvingStatusButtons,#carvingExpWrapper,#carvingInfoWrapper,#rightCarvingWrapper,#carvingContinueButtons").hide(),$("#carvingActionTimeWrapper").css("width","100%")),Ga()}function Ha(e){if($("#carvingPrepareWrapper").hide(),$("#carvingStatusButtons,#carvingInfoWrapper,#rightCarvingWrapper,#carvingExpWrapper").show(),"Failed"==e.status)return t=e.message,forceAutoStop=99,$(".autoWrapper,.staminaBeingReplenished,.fatigueWrapper").hide(),$("#carvingInfoWrapper").show(),$("#carveUsed").html(t||"An error occurred while carving."),C.show(),$("#carveRewards,#carveResult,#carveComplete,#carveLevelResult,#carveQuestResult,#carveIngredientResult,#carveStatResult,#carveDropResult").hide(),$("#carveInfoWrapper").show(),$(document).attr("title","Autos Canceled - Relics of Avabur"),$("#carveContinueButtons").show(),$("#carveContinue").prop("disabled",!1),void $("#carveContinue").show();var t,a=e.p.autos_remaining;if($(".autosMaximum").text(ui(e.p.autos_max)),a>=0)0==a?$(".autoWrapper").show().addClass("failure"):$(".autoWrapper").show().removeClass("failure"),$(".fatigueWrapper,.staminaBeingReplenished").hide();else{$(".autoWrapper,.staminaBeingReplenished").hide(),$(".fatigueWrapper").show();var n=Math.abs(a);$("#carvingFatigueAutos").text(n+(1==n?" carving action":" carving actions"))}Ya(),function(e){var t=e.p.autos_remaining;t>0?document.title=t+" Stamina - Relics of Avabur":(document.title="Fatigued - Relics of Avabur",t);if($("#carveMult").hide(),e.a.e)return $("#carveResult").html(e.a.e),C.show(),void $("#carveRewards").hide();e.a.l?1==e.a.l?$("#carveLevelResult").html("You gained a carving level!")&&Ja("You gained a carving level!","loot_other","#FF7"):$("#carveLevelResult").html("You gained "+e.a.l+" carving levels!")&&Ja("You gained "+e.a.l+" carving levels!","loot_other","#FF7"):$("#carveLevelResult").html(""),Ua(e.p);var a=e.a.txp/e.a.tc*100,n=e.a.ac/e.a.ar*100;$("#carvingLevelXPFill").width(a+"%"),$("#currentCarvingXP").text(ui(e.a.txp)),$("#carvingLevelCost").text(ui(e.a.tc)),$("#carvingLevelPercent").text(ui(a,2)),$("#carvingXPBar").removeClass().addClass(e.a.eqn),$("#currentCarvingCost").text(ui(e.a.ac)),$("#carvingCost").text(ui(e.a.ar)),$("#carvingPercent").text(ui(n,2)),$("#carvingXPFill").width(n+"%"),$("#carveCurrentItem").html(e.a.i),$("#carveCurrentTool").text(e.a.t),$("#carveExpGain").text(ui(e.a.xp)),$("#carvingQueuedCount").text(ui(e.a.cq)),$("#carvingQueuedMax").text(ui(e.a.mq)),e.a.cq<1&&$("#carvingStatusButtons").slideUp();var i=$('#houseViewedRoomItemWrapper .gemWithTooltip[data-json*=\'"i":'+e.a.gid+"']");i&&i.closest("div").html(e.a.i+" ("+ui(n,2)+"%)");$("#carveUsed").html(e.a.m),$("#carvingGainList").append("<li>"+e.a.m+"</li>"),$("#carvingGainList").children()&&$("#carvingGainList").children().length>50&&$("#carvingGainList li:first-child").remove();e.a.c?($("#carveComplete").html(e.a.c),$("#carvingGainList").append("<li>"+e.a.c+"</li>"),$("#carvingGainList").children()&&$("#carvingGainList").children().length>50&&$("#carvingGainList li:first-child").remove()):$("#carveComplete").html("");$("#carvingGainWrapper").is(":hover")||$("#carvingGainWrapper").animate({scrollTop:$("#carvingGainWrapper").prop("scrollHeight")},0);e.a.so&&m.play();e.a.fb?Ae.addClass("fatigued"):Ae.removeClass("fatigued");e.a.sr?($("#carveStatResult").html(e.a.sr.drop),Ja(e.a.sr,"loot_stats")):$("#carveStatResult").html(""),e.a.dr?($("#carveDropResult").html(e.a.dr.drop),Ja(e.a.dr,"loot_drops")):$("#carveDropResult").html(""),e.a.ir?($("#carveIngredientResult").html(e.a.ir.drop),Ja(e.a.ir,"loot_ingredients")):$("#carveIngredientResult").html(""),$("#carveQuestResult").html(e.a.qf),e.a.mult.mod>1&&($("#carveMult").show(),$("#carveMult").html(" "+nt[e.a.mult.mod]));o=1,r=e.a.mu,s=e.a.xp,l=e.a.c,c=parseInt(j.attr("data-value")),d=parseInt(J.attr("data-value")),p=parseInt(V.attr("data-value")),u=parseInt(z.attr("data-value")),c+=o,d+=r,p+=s,l&&u++,j.attr("data-value",c).html(ui(c)),J.attr("data-value",d).html(ui(d)),V.attr("data-value",p).html(fn(p,1e7)),z.attr("data-value",u).html(ui(u)),$("#areaContent,#carveRewards,#carveResult,#carveComplete,#carveLevelResult,#carveQuestResult,#carveIngredientResult,#carveStatResult,#carveDropResult").show(),ja();var o,r,s,l,c,d,p,u}(e),Ga()}function Ga(){Qa();clearInterval(n),n=setInterval(function(){Qa(),ae.first().html()<=0&&(Ye&&(Ne.is(":visible")?zt():Oe.is(":visible")?Ma():(qe.is(":visible")||Fe.is(":visible")||Ee.is(":visible"))&&Wa()),clearInterval(n))},500)}function Qa(){var e=Date.now(),t=new Number(Math.max(0,(Qe-e)/1e3)).toFixed(1);return ae.html(t),1e3*t}function Ya(){$("#actionTimeWrapper").show()}function Ua(e){$.each(e,function(e,t){if("levelPercent"==e)$("#"+e).text(ui(t,2)),$("#xpFill").width(t+"%");else if("quest_number"==e)$(".quest_number").text(t);else if("event_time"==e)ut=t?Date.now()+1e3*t:null;else if("weaponskill"==e)$("#weaponskill").text(t+":");else if("event_points"==e)$(".event_points").text(ui(t)),$(".event_point_name").text("Event Point"+(1==t?"":"s"));else if("replenishKey"==e)ft=t;else if("i_a_s"==e)t;else if("chatScroll"==e)"up"==($t=t)?($("#chatMessageListWrapper").animate({scrollTop:0},0),$("#chatMessageListWrapper").before($("#chatMessageWrapper"))):($("#chatMessageListWrapper").animate({scrollTop:$("#chatMessageListWrapper").prop("scrollHeight")},0),$("#chatMessageListWrapper").after($("#chatMessageWrapper")));else if("can_build_house"==e)1==t?$("#constructionNotifier").show():$("#constructionNotifier").hide();else if("can_house_harvest"==e)1==t?$("#harvestronNotifier").show():$("#harvestronNotifier").hide();else if("has_workshop"==e)1==t?$("#workshopNotifier").show():$("#workshopNotifier").hide();else if("bq_info2"==e)Kt("BATTLE",t.a,t.v,t.i,t.c,t.r,t.i2,t.c_g);else if("tq_info2"==e)Kt("HARVEST",t.a,t.v,t.i,t.c,t.r,t.i2,t.c_g);else if("pq_info2"==e)Kt("PROFESSION",t.a,t.v,t.i,t.c,t.r,t.i2,t.c_g);else if("eq_info"==e)Kt("EVENT",t.a,t.reward,t.i,t.c,t.r,null);else if("promo_active"==e)t>0?$("#promoActive").show():$("#promoActive").hide();else if("update_count"==e)t>0?$("#updateCount").text(t).show():$("#updateCount").text(t).hide();else if("next_action"==e)Qe=Date.now()+Math.max(0,t);else if("autos_remaining"==e)$(".autosRemaining").text(ui(t));else if("general_notification"==e)t?($("#general_notification").html(t),$("#generalNotificationWrapper,#general_notification").fadeIn()):$("#generalNotificationWrapper").fadeOut();else if(e.split("bonus_")[1]){e.split("bonus_")[1];$("#"+e.split("bonus_")[1]).attr("data-bonuses",t)}else if("house_timers"==e){if(t){var a=Date.now();$.each(t,function(e,t){pt[t.n]={n:t.n,next:a+1e3*t.next}})}}else if("clan_name"==e)$("#clan_name").html(t);else if("clan_level"==e)$("#clan_level").text(t);else if("house_level"==e)$("#house_level").text(t);else if("my_title"==e)$("#my_title").html(t);else if("mods"==e){a=Date.now();dt={},$.each(t,function(e,t){t.mod>1&&t.ends>0&&(dt[t.type]={n:t.n,t:t.type,e:a+1e3*t.ends})})}else"fatigue_buffer"==e?t>=1?$(".autosBuffer").show().text(" (+"+ui(t,2)+")"):$(".autosBuffer").hide().text(" (+"+ui(t,2)+")"):"gold"==e||"crafting_materials"==e||"gem_fragments"==e||"platinum"==e||"premium"==e||"food"==e||"wood"==e||"iron"==e||"stone"==e?$(".my"+e).text(fn(t.t,1e8)).attr("data-personal",ui(t.p)).attr("title",ui(t.t)):"crafting"==e||"carving"==e||"fishing"==e||"woodcutting"==e||"mining"==e||"stonecutting"==e?($("#"+e).text(fn(t.l,1e8)),$('.levelWithTooltip[data-skill="'+ii(e)+'"]').attr("data-level",t.l).attr("data-xp",t.xp).attr("data-tnl",t.tnl)):"strength"==e||"health"==e||"coordination"==e||"agility"==e?$("#"+e).text(fn(t.total,1e8)).attr("data-base",t.base).attr("data-bonuses",t.bonus):("level"==e&&t>=10&&$("#housing").show(),et.indexOf(e)>=0?$("#"+e).text(ui(t.total,2)+"%").attr("data-base",ui(t.base,2)+"%").attr("data-bonuses",t.bonus):$("#"+e).text(fn(t,1e8)).attr("title",ui(t)))})}function ja(){$("#latestLoot").children()&&$("#latestLoot").children().length>50&&$("#latestLoot li:last-child").remove(),$.each($(".shortActivitySection"),function(e,t){$(t).children()&&$(t).children().length>20&&$(t).children().first().remove()})}function Ja(t,a,n,i){a||(a="loot_other"),"loot_other"!=a&&$(".shortActivitySection[data-type="+a+"]").append('<div class="row"><div class="col-xs-12 col-md-3 right">'+t.time+'</div><div class="col-xs-12 col-md-9">'+(t.monster?"["+t.monster+"] ":"")+(t.drop||t.m)+"</div></div>"),!i&&He&&(e[a]=e[a]||[],e[a].push({m:t,c:a,co:n}),e[a].length>20&&e[a].shift(),sessionStorage.setItem("AvaburRecentLoot",JSON.stringify(e))),"loot_ingredients"==a&&(a="loot_drops");var o=0==$('#activityWrapper input[data-class="'+a+'"]').is(":checked");$("#latestLoot").prepend('<li class="'+a+'" style="'+(n?"color: "+n+";":"")+(o?"display: none;":"")+'">'+(t.drop||t.m||t)+"</li>"),ja()}function Va(e){$(".battleResult").text(e||"An error occurred during battle."),$(".autoWrapper,.staminaBeingReplenished").hide(),$(".fatigueWrapper").show(),C.show(),$(".battleRewards").hide(),$(".autoWrapper,.fatigueWrapper,#battleStatusButtons").slideUp(),$(".autosAreCanceled").show(),$(document).attr("title","Autos Canceled - Relics of Avabur");$("#battleContinueButtons");$("#battleContinueButtons").show(),$("#battleContinue").prop("disabled",!1),$("#battleContinue").show(),$("#battleAgain").prop("disabled",!1),$("#battleAgain").show()}function za(){va({title:"Moderator Tools"}),Xa("overview"),$("#modToolWrapper").show()}function Xa(e){var t;"overview"==e?t="mod_overview":"commands"==e?t="mod_commands":"bans"==e?t="mod_bans":"ip_duplicates"==e?t="mod_duplicate_ips":"lookup"==e&&(t="mod_lookup"),"bans"==e||"ip_duplicates"==e?yt(t,{}):"lookup"==e&&($(".mod_lookup_section").hide(),$("#mod_lookup_search").show()),$(".mod_tool_section").hide(),$(".mod_tool_section[data-type="+e+"]").show()}function Ka(e,t){yt("mod_lookup",{search_type:e,value:t})}function Za(e,t){yt("house",{n:t})}function en(e){$("#houseQuickBuildList").empty(),$.each(e,function(e,t){"level"==t.ty?$("#houseQuickBuildList").append('<li><a title="Remove this item type from this list" class="houseIgnoreQuickBuild" data-type="'+t.i+'">[X]</a> - <a class="houseViewRoomItem'+(t.hf?"":" disabled")+'" data-roomtype="'+t.r+'" data-itemtype="'+t.i+'">'+t.n+"</a> - "+t.tn+"</li>"):"new_item"==t.ty?$("#houseQuickBuildList").append('<li><a class="houseViewRoom'+(t.hf?"":" disabled")+'" data-type="'+t.r+'">'+t.n+" ("+t.rn+")</a> - "+t.tn+"</li>"):"tier"==t.ty&&$("#houseQuickBuildList").append('<li><a class="houseViewRoomItem'+(t.hf?"":" disabled")+'" data-roomtype="'+t.r+'" data-itemtype="'+t.i+'">'+t.n+"</a> -> "+t.nn+" - "+t.tn+"</li>")})}function tn(e,t,a){yt("house_harvest_job",{skill:e,minutes:t,confirm:a})}function an(e,t,a){$.confirm({title:"Confirm Harvestron Job",message:a,buttons:{Yes:{class:"green",action:function(){tn(e,t,1)}},No:{class:"red",action:function(){}}}})}function nn(e){if($("#houseName").text(e.n),$("#houseLevel").text(e.l),e.mine&&($("#currentHouseXP").text(ui(e.exp)),$("#houseLevelCost").text(ui(e.exp_cost)),$("#houseLevelPercent").text(ui(e.exp/e.exp_cost*100,2)),$("#houseXPFill").width(e.exp/e.exp_cost*100+"%")),e.trick_treat?$("#trick_treat").show().attr("data-user",e.on):$("#trick_treat").hide(),e.bonuses)if($("#houseBonusList").empty(),$.isEmptyObject(e.bonuses))$("#houseBonusList").append("<li>None!</li>");else if(e.mine){var t=e.bonuses;for(var a in t){var n=t[a],i='<div class="col-xs-12 col-md-6"><div class="row"><h4 class="center nobg col-xs-12">'+a+"</h4></div>";$.each(n,function(e,t){i+='<div class="row"><div class="col-xs-12"><a class="houseBonusValue" data-id="'+e+'">'+t+"</a></div></div>"}),i+="</div>",$("#houseBonusList").append(i)}}else{t=e.bonuses;for(var a in t){n=t[a],i='<div class="col-xs-12 col-md-6"><div class="row"><h4 class="center nobg">'+a+"</h4></div>";$.each(n,function(e,t){i+='<div class="row"><div class="col-xs-12">'+t+"</div></div>"}),i+="</div>",$("#houseBonusList").append(i)}}e.q_b&&en(e.q_b)}function on(e){$("#houseRoomsBuilt").empty(),!e||e.length<1?$("#houseRoomsBuilt").html('<div class="col-md-12">No rooms have been built here yet.</div>'):($("#houseRoomsBuilt").empty(),$.each(e,function(e,t){$("#houseRoomsBuilt").append('<div class="col-md-12"><a class="houseViewRoom" data-type="'+t.room_type+'"><h5>'+t.name+' (<span class="room_item_count">'+t.item_count+'</span> / <span class="room_item_max">'+(t.item_count+t.can_build)+"</span>)</h5></a></div>")}))}function rn(e,t){$("#houseRoomItemsBuilt").empty(),!t.items||t.items.length<1?$("#houseRoomItemsBuilt").text("No items have been built here yet."):$.each(t.items,function(e,a){$("#houseRoomItemsBuilt").append('<li><a class="houseViewRoomItem" data-roomtype="'+t.room_type+'" data-itemtype="'+a.item_type+'">'+a.name+"</a> ("+a.level+")</li>")})}function sn(e){$("#houseRoomItemPossibilities").html(""),!e.b_i||e.b_i.length<1?($("#houseRoomItemCanBuild").hide(),$("#houseRoomItemCannotBuild").show()):($("#houseRoomItemCanBuild").show(),$("#houseRoomItemCannotBuild").hide(),$.each(e.b_i,function(t,a){$("#houseRoomItemPossibilities").append('<option name="itemid" value="'+a.id+'" data-roomtype="'+e.room_type+'" data-costs="'+pi(a.costline)+'" data-time="'+a.build_time+'">'+a.name+"</option>")}),$("#houseRoomItemPossibilities").change())}function ln(e){$("#houseRoomPossibilities").html(""),!e||e.length<1?($("#houseRoomCanBuild").hide(),$("#houseRoomCannotBuild").show()):($("#houseRoomCanBuild").show(),$("#houseRoomCannotBuild").hide(),$.each(e,function(e,t){$("#houseRoomPossibilities").append('<option name="roomid" value="'+t.id+'" data-costs="'+pi(t.costline)+'" data-time="'+t.build_time+'">'+t.name+"</option>")}),$("#houseRoomPossibilities").change())}function cn(){var e=$("#houseTrashCompactorEffects"),t=e.attr("data-max"),a=e.val();a&&a.length>=t?$("#ms-houseTrashCompactorEffects").find(".ms-selectable .ms-elem-selectable").addClass("disabled"):$("#ms-houseTrashCompactorEffects").find(".ms-selectable .ms-elem-selectable").removeClass("disabled")}function dn(e){var t=$("#houseCraftingVetoList"),a=JSON.parse(t.attr("data-maxes")),n=a.total||0,i=(e=t.val()||[],$("#craftingType").val()),o=$("#craftingType option:selected").text(),r=Ve[i],s=$("#ms-houseCraftingVetoList>.ms-selectable").find(".ms-optgroup");$.each(s,function(e,t){var n=a[$(t).children().first().text()],i=$(t).find(".ms-selected").length;void 0!==n&&i>=n?$(t).find(".ms-elem-selectable").addClass("disabled"):$(t).find(".ms-elem-selectable").removeClass("disabled"),$(t).find('.ms-elem-selectable[data-restrictions*="'+r+'"]').addClass("disabled"),$(t).find('.ms-elem-selectable[data-restrictions*="'+o+'"]').addClass("disabled")}),e&&e.length>=n&&$("#ms-houseCraftingVetoList").find(".ms-selectable .ms-elem-selectable").addClass("disabled"),$("#craftingItemLevel").change()}function pn(e){D.is(":visible")&&_a(),$(".houseRoomItemName").text(e.name),$("#houseRoomItemTitle").text(e.title),$("#houseRoomItemDescription").html(e.desc),$("#houseHarvestingJobTime").change(),$("#houseRoomItemUpgradeTier,#houseRoomItemUpgradeLevel").attr("data-roomtype",e.room_type),$("#houseRoomItemUpgradeTier,#houseRoomItemUpgradeLevel").attr("data-itemtype",e.item_type),$("#houseRoomItemUpgradeLevelWrapper").show(),$("#houseRoomItemLevelUpgradeValue").text(parseInt(e.level)+1),$("#houseRoomItemLevelUpgradeTimeCost").text(e.level_upgrade_time),$("#houseRoomItemLevelUpgradeCost").html(e.level_upgrade_cost),e.can_upgrade_tier?($("#houseRoomItemUpgradeTierWrapper").show(),$("#houseRoomItemTierUpgradeName").text(e.next_tier),$("#houseRoomItemTierUpgradeTimeCost").text(e.tier_upgrade_time),$("#houseRoomItemTierUpgradeCost").html(e.tier_upgrade_cost)):$("#houseRoomItemUpgradeTierWrapper").hide(),$("#craftingMaterialVetoCostWrapper").hide(),$("#houseTrashCompactorEffects").multiSelect({afterInit:cn,afterSelect:cn,afterDeselect:cn}),$("#houseCraftingVetoList").multiSelect({afterInit:dn,afterSelect:dn,afterDeselect:dn}),$("#craft_sort_confirm,#carve_sort_confirm").hide(),$("#craft_sortable").sortable({opacity:.5,update:function(){$("#craft_sort_confirm").show()}}),$("#craft_sortable").disableSelection(),$("#carve_sortable").sortable({opacity:.5,update:function(){$("#carve_sort_confirm").show()}}),$("#carve_sortable").disableSelection(),$("#carvingType").change()}function un(e){var t=e.p.autos_remaining;if(t>0?document.title=t+" Stamina - Relics of Avabur":(document.title="Fatigued - Relics of Avabur",t),$(".battleClanRewards").hide(),$(".battleMult").hide(),e.b.e)return $(".battleResult").text(e.b.e),C.show(),void $(".battleRewards").hide();e.b.l?1==e.b.l?$(".battleLevelResult").html("You gained a level!")&&Ja("You gained a level!","loot_other","#FF7"):$(".battleLevelResult").html("You gained "+e.b.l+" levels!")&&Ja("You gained "+e.b.l+" levels!","loot_other","#FF7"):$(".battleLevelResult").html(""),Ua(e.p);var a=e.b.m,n=e.b.p;if(lt.bt=e.b.bt,lt.monsterInfo=a,lt.playerInfo=n,lt.currentRound=0,function(e,t,a,n,i){var o=parseInt(S.attr("data-value")),r=parseInt(A.attr("data-value")),s=parseInt(B.attr("data-value")),l=parseInt(P.attr("data-value")),c=parseInt(N.attr("data-value")),d=parseInt(q.attr("data-value"));if(1==e?(o++,s+=t,l+=a,c+=n,d+=i,S.attr("data-value",o).html(ui(o)),B.attr("data-value",s).html(fn(s,1e7)),P.attr("data-value",l).html(fn(l,1e7)),N.attr("data-value",c).html(fn(c,1e7)),q.attr("data-value",d).html(fn(d,1e7)),n>0||i>0?$(".battleClanRewards").show():$(".battleClanRewards").hide()):(r++,A.attr("data-value",r).html(ui(r))),0==r)var p=100;else p=o/(o+r)*100;F.html(ui(p,2)+"%")}(e.b.r,e.b.xp,e.b.g,e.b.cxp,e.b.cg),e.b.bt){ne.show(),n.hp.c=n.hp.m,a.hp.c=a.hp.m,$(".currentPlayerHP").text(fn(n.hp.m,1e7)),$(".currentMonsterHP").text(fn(a.hp.m,1e7)),$(".PlayerHPFill,.MonsterHPFill").animate({width:"100%"}),$(".playerBattleText,.monsterBattleText,.battleText").text(""),$(".playerRounds,.monsterRounds,.playerAttack,.monsterAttack,.summary,.battleResult,.battleRewards,.battleClanRewards,.battleLevelResult,#battleQuestResult,#battleIngredientResult,.battleStatResult,#battleDropResult").hide(),clearInterval(window.roundinterval);var i=(e.p.next_action-1e3)/lt.bt.length;mn(i),clearInterval(window.roundinterval),window.roundinterval=setInterval(function(){lt.currentRound&&!lt.bt[lt.currentRound]||mn(i)},i)}else ne.hide(),$(".playerRounds,.monsterRounds,.playerAttack,.monsterAttack,.summary,.battleResult,.battleRewards,.battleLevelResult,#battleIngredientResult,#battleQuestResult,.battleStatResult,#battleDropResult").show(),$(".PlayerHPFill,.MonsterHPFill").css("width","100%"),$(".monsterAttack").html(fa("enemy",a.hh,a.w.s,a.w.q,a.w.n,a.h+n.d)),$(".playerAttack").html(fa("ally","your",n.w.s,n.w.q,n.w.n,n.h+n.m)),$(".currentPlayerHP").text(fn(n.hp.c,1e7)),$(".maxPlayerHP").text(fn(n.hp.m,1e7)),$(".PlayerHPFill").width(n.hp.c/n.hp.m*100+"%"),$(".currentMonsterHP").text(fn(a.hp.c,1e7)),$(".maxMonsterHP").text(fn(a.hp.m,1e7)),$(".MonsterHPFill").width(a.hp.c/a.hp.m*100+"%"),$(".phits").text(n.h+(1==n.h?" time":" times")),$(".pcrits").text(n.c+(1==n.c?" crit":" crits")),$(".pmisses").text(n.m+(1==n.m?" time":" times")),$(".pdodges").text(n.d+(1==n.d?" time":" times")),$(".mhits").text(a.h+(1==a.h?" time":" times")),$(".pdamage").text(fn(n.dm)),$(".pavgdamage").text(fn(Math.ceil(n.dm/Math.max(1,e.b.ro)))),$(".pbasicdamage").text(fn(n.bd)),$(".pbasicavgdmg").text(fn(Math.floor(n.bd/Math.max(1,n.h)))),$(".pspellcastavgdmg").text(fn(Math.ceil(n.sd/Math.max(1,n.sc)))),$(".pspellcastdamage").text(fn(n.sd)),$(".pcounterdamage").text(fn(n.cd)),$(".pcounteravgdmg").text(fn(Math.ceil(n.cd/Math.max(1,n.ca)))),$(".phealing").text(fn(n.he)),$(".phealingavg").text(fn(Math.ceil(n.he/Math.max(1,n.hep)))),$(".mdamage").text(fn(a.dm)),$(".mavgdamage").text(fn(Math.ceil(a.dm/Math.max(1,a.h)))),1==n.w.s?$(".spellcastLine").show():$(".spellcastLine").hide();e.b.so&&m.play(),e.b.fb?Ae.addClass("fatigued"):Ae.removeClass("fatigued"),e.b.mult.mod>1&&($(".battleMult").show(),$(".battleMult").html(" "+nt[e.b.mult.mod])),$(".maxPlayerHP").text(fn(n.hp.m,1e7)),$(".maxMonsterHP").text(fn(a.hp.m,1e7)),$(".enemyName").text(a.n),$(".battleExpGain").text(ui(e.b.xp)),$(".goldGain").text(ui(e.b.g)),$(".battleDPGain").text(ui(e.b.dp)),$(".battleDPPlural").text(1==e.b.dp?"":"s"),$(".expClanGain").text(ui(e.b.cxp)+" ("+e.b.xp_tax+"%)"),$(".goldClanGain").text(ui(e.b.cg)+" ("+e.b.g_tax+"%)"),e.b.r?$(".battleResult").html('You defeated the <span class="enemyName"></span> after '+e.b.ro+(1==e.b.ro?" round":" rounds")+"!"):$(".battleResult").html('The <span class="enemyName"></span> defeated you after '+e.b.ro+(1==e.b.ro?" round":" rounds")+"."),e.b.sr?($(".battleStatResult").html(e.b.sr.drop),Ja(e.b.sr,"loot_stats")):$(".battleStatResult").html(""),e.b.ir?($("#battleIngredientResult").html(e.b.ir.drop),Ja(e.b.ir,"loot_ingredients")):$("#battleIngredientResult").html(""),e.b.dr?($("#battleDropResult").html(e.b.dr.drop),Ja(e.b.dr,"loot_drops")):$("#battleDropResult").html(""),$("#battleQuestResult").html(e.b.qf),$(".enemyName").each(function(){$(this).text(a.n)}),ja(),C.show()}function mn(e){lt.bt?(lt.hasOwnProperty("currentRound")||(lt.currentRound=0),"heal"==lt.bt[lt.currentRound].type?(ie.append("<li>You healed "+(lt.bt[lt.currentRound].times>1?lt.bt[lt.currentRound].times+" times ":"")+'for <span style="color: green;">'+ui(lt.bt[lt.currentRound].dmg)+"</span> HP!</li>"),lt.bt[lt.currentRound].dmg*=-1):"poison"==lt.bt[lt.currentRound].type?ie.append('<li>Your poison dealt <span style="color:#7300E6">'+ui(lt.bt[lt.currentRound].dmg)+'</span> damage to <span class="enemyName"></span>!</li>'):"scorch"==lt.bt[lt.currentRound].type?ie.append('<li>You scorched <span class="enemyName"></span>\'s armor!</li>'):"unscorch"==lt.bt[lt.currentRound].type?ie.append('<li><span class="enemyName"></span>\'s armor is no longer scorched!</li>'):"confound"==lt.bt[lt.currentRound].type?ie.append('<li><span class="enemyName"></span> has become confounded!</li>'):"unconfound"==lt.bt[lt.currentRound].type?ie.append('<li><span class="enemyName"></span> is no longer confounded!</li>'):"weaken"==lt.bt[lt.currentRound].type?ie.append('<li><span class="enemyName"></span> has become weakened!</li>'):"unweaken"==lt.bt[lt.currentRound].type?ie.append('<li><span class="enemyName"></span> is no longer weakened!</li>'):ie.append("<li>"+$a(lt.bt[lt.currentRound],lt.bt[lt.currentRound].npc?lt.monsterInfo.w:lt.playerInfo.w,e)+"</li>"),ne.animate({scrollTop:ne.prop("scrollHeight")},0),$(".enemyName").each(function(){$(this).text(lt.monsterInfo.n)}),hn(lt.bt[lt.currentRound].npc?1:0,lt.bt[lt.currentRound].dmg,lt.bt[lt.currentRound].type),lt.currentRound+=1,lt.currentRound>=lt.bt.length&&(clearInterval(window.roundinterval),$(".battleResult,.battleRewards,.battleClanRewards,.battleLevelResult,#battleQuestResult,.battleStatResult,#battleDropResult,#battleIngredientResult").show(),function(){var e="+"+$(".battleExpGain").first().text().replace(/,/g,""),t="+"+$(".goldGain").first().text().replace(/,/g,"");if(0==e&&0==t)return;var a={top:0,opacity:0},n={top:0,opacity:0},i=$(".battleExpWrapper").offset().left+$(".battleExpWrapper").width(),o=$(".battleExpWrapper").offset().top-Math.floor(6*Math.random()),r=$(".battleExpWrapper").offset().left,s=$(".goldWrapper").offset().top-Math.floor(6*Math.random()),l=$("#xpCount").offset();a.left=l.left+$("#xpCount").width()/2,a.top=l.top;var c=$(".gold").first().offset();n.left=c.left+$(".gold").first().width()/2,n.top=c.top;var d=$("<div>"+fn(e)+" XP</div>").addClass("numberCircle").addClass("xpCircle").css("position","absolute").css("font-size","80%"),p=$("<div>"+fn(t)+" Gold</div>").addClass("numberCircle").addClass("goldCircle").css("position","absolute").css("font-size","80%");p.css({top:s,left:r}),d.css({top:o,left:i}),$("body").append(d),$("body").append(p),d.animate({top:o-(10+40*Math.random())},1e3,function(){d.animate(a,2e3,function(){$(this).remove()})}),p.animate({top:s-(10+40*Math.random())},1e3,function(){p.animate(n,2e3,function(){$(this).remove()})})}())):clearInterval(window.roundinterval)}function hn(e,t,a,n){if(0!=t&&null!=t){var i,o,r;o=!e&&t>0?n?".enemyBossName":".monsterHPBar":n?"#currentBossPlayerHP":".playerHPBar",t>0?(i="-"+t,r="spell"==a?"spellCircle":"badCircle"):(i="+"+-1*t,r="goodCircle");var s={top:0,opacity:0},l=$(o).last().offset().left+$(o).width(),c=$(o).last().offset().top-Math.floor(6*Math.random());s.left=l,s.top=c-20;var d=$("<div>"+fn(i)+"</div>").addClass("numberCircle").addClass(r).css("position","absolute");d.css({top:c,left:l}),$("body").append(d),d.animate({top:c-(10+40*Math.random())},500,function(){d.animate(s,1e3,function(){d.remove()})})}}function fn(e,t){if(isNaN(e))return 0;isNaN(t)&&(t=0);var a=Math.abs(e);return a>=1e66&&a>=t?"far too much":a>=1e63&&a>=t?ui(e/1e63,3)+"Vi":a>=1e60&&a>=t?ui(e/1e60,3)+"NoD":a>=1e57&&a>=t?ui(e/1e57,3)+"OcD":a>=1e54&&a>=t?ui(e/1e54,3)+"SpD":a>=1e51&&a>=t?ui(e/1e51,3)+"SeD":a>=1e48&&a>=t?ui(e/1e48,3)+"QiD":a>=1e45&&a>=t?ui(e/1e45,3)+"QaD":a>=1e42&&a>=t?ui(e/1e42,3)+"TrD":a>=1e39&&a>=t?ui(e/1e39,3)+"DuD":a>=1e36&&a>=t?ui(e/1e36,3)+"UnD":a>=1e33&&a>=t?ui(e/1e33,3)+"De":a>=1e30&&a>=t?ui(e/1e30,3)+"No":a>=1e27&&a>=t?ui(e/1e27,3)+"Oc":a>=1e24&&a>=t?ui(e/1e24,3)+"Sp":a>=1e21&&a>=t?ui(e/1e21,3)+"Sx":a>=1e18&&a>=t?ui(e/1e18,3)+"Qi":a>=1e15&&a>=t?ui(e/1e15,3)+"Qa":a>=1e12&&a>=t?ui(e/1e12,3)+"T":a>=1e9&&a>=t?ui(e/1e9,3)+"B":a>=1e6&&a>=t?ui(e/1e6,2)+"M":a>=1e3&&a>=t?ui(e/1e3,2)+"K":ui(e)}function $n(e,t,a,n,i,o,r,s,l){$("#marketTypeSelector").find(".active").removeClass("active");t=Math.max(0,t);$("#amountToSell,#sellingPrice").val(""),yt("market",{type:"page",page:"market",market_type:e,page_num:t,q:a,ll:n,hl:i,st:o,effect:r,ev:s,gem_only:l})}function vn(){var e,t,a=$("#marketPagingLinks .page_cur>a");a.length?(e=a.attr("data-t"),t=a.attr("data-st"),a.attr("data-page")):(e=$("#marketTypeSelector .active").first().attr("data-type"),t=$("#marketTypeSelector .active").first().attr("data-subtype"));$("#marketTypeSelector .active").attr("data-type");$n(e,a.attr("data-page"),a.attr("data-q"),a.attr("data-ll"),a.attr("data-hl"),t,a.attr("data-effect"),a.attr("data-ev"),a.attr("data-gemmed"))}function gn(e,t){yt("market_buy",{id:e,amount:t})}function _n(e,t,a){var n=0,i=e;e=Math.max(0,e),t=Math.max(0,t);a||(a="result"),e>10&&(10*t-50>0&&(n=Math.min(10*t-50,10*e-100)),n+100<e&&(i=n+100));var o='<ul class="pagenav">';for(0!=t&&(o+='<li class="page_link page_first"><a data-page="0">&lt;&lt;</a></li><li class="page_link page_prev"><a>&lt;</a></li>');n<i;)o+='<li class="page_link'+(n/10==t?" page_cur":"")+'" title="'+(n+1)+" to "+(n+10)+'"><a class="pageLink" data-page="'+n/10+'">'+(n/10+1)+"</a>",n+=10;return t+1<Math.floor((e+9)/10)&&(o+='<li class="page_link page_next"><a>&gt;</a></li><li class="page_link page_last"><a data-page="'+(Math.max(1,Math.floor((e+9)/10))-1)+'">&gt;&gt;</a></li>'),o+="</ul>Page "+(t+1)+" of "+Math.max(1,Math.floor((e+9)/10))+" ("+e+" "+a+(1==e?"":"s")+")",e&&!isNaN(t)?o:""}function yn(e,t){yt("clans",{start:e,vm:t})}function bn(e,t){$(e).fadeOut(0,function(){$(e).html(t),$(e).fadeIn(1e3)})}function kn(e,t){yt("username_change",{name:e,currency:t})}function wn(e,t){yt("gender_change",{gender:e,currency:t})}function Cn(e){yt("clan_view",{name:e})}function xn(){$("#donateCrystals,#donatePlatinum,#donateGold,#donateFood,#donateWood,#donateIron,#donateStone").val("")}function Tn(){var e=$("#inviteClanMemberName").val();e&&yt("clan_invite",{name:e})}function Wn(e){$("#viewedClanMemberWrapper").hide(),yt("clan_members",{clan:e})}function Ln(){Pn(),$("#viewedClanProfileWrapper,#viewedClanMemberWrapper,#myClanBuildingsWrapper,#myClanFundsWrapper,#myClanDonationWrapper,#myClanActivityWrapper,#myClanRankEditWrapper,#myClanAdminWrapper").hide(),$("#myClanRankWrapper").fadeIn(500),$("#viewMyClanRanks").addClass("active"),yt("clan_ranks",{clan:$("#myClanLinks").attr("data-id")})}function Dn(){Pn(),$("#viewedClanProfileWrapper,#viewedClanMemberWrapper,#myClanBuildingsWrapper,#myClanFundsWrapper,#myClanDonationWrapper,#myClanActivityWrapper,#myClanRankWrapper,#myClanAdminWrapper").hide(),$("#myClanRankEditWrapper").fadeIn(500),$("#viewMyClanRanks").addClass("active")}function Rn(){Dn(),$("#myClanRankDeleteOptions").hide(),$("#myClanRankName").val(""),$("#myClanRankID").val(""),$("#myClanRankExperienceTax,#myClanRankGoldTax,#myClanRankResourceTax").val(10),$("#myClanRankDropTax").val(5),$('#myClanRankEditTable input[name*="permission"]').prop("checked",!1),$("#myClanRankEditTable tr").eq(-2).hide(),$("#myClanRankSaveChanges").off("click").on("click",function(e){e.preventDefault(),function(){var e=$('#myClanRankEditTable input[type="checkbox"]'),t={},a=0;if(e.length)for(var n=0;n<e.length;n++)e.eq(n).prop("checked")&&(a|=e[n].name);t.clan=$("#myClanLinks").attr("data-id"),t.name=$("#myClanRankName").val(),t.id=$("#myClanRankID").val(),t.exptax=$("#myClanRankExperienceTax").val(),t.goldtax=$("#myClanRankGoldTax").val(),t.restax=$("#myClanRankResourceTax").val(),t.droptax=$("#myClanRankDropTax").val(),t.prefs=a,yt("clan_rank_add",t)}()})}function Mn(){yt("clan_buildings",{clan:$("#myClanLinks").attr("data-id")})}function In(e){yt("clan_rank_edit",{clan:$("#myClanLinks").attr("data-id"),rank:e})}function Sn(e){var t=$('#myClanRankEditTable input[type="checkbox"]'),a={},n=0;if(t.length)for(var i=0;i<t.length;i++)t.eq(i).prop("checked")&&(n|=t[i].name);a.clan=$("#myClanLinks").attr("data-id"),a.rank=e,a.name=$("#myClanRankName").val(),a.id=$("#myClanRankID").val(),a.exptax=$("#myClanRankExperienceTax").val(),a.goldtax=$("#myClanRankGoldTax").val(),a.restax=$("#myClanRankResourceTax").val(),a.droptax=$("#myClanRankDropTax").val(),a.deleterank=$('input[name="deleterank"]').prop("checked"),a.moveto=$("#myClanRankDeleteOptions :selected").val(),a.prefs=n,yt($('input[name="deleterank"]').prop("checked")?"clan_rank_edit":"clan_rank_change",a)}function An(e,t){var a=$('#accountActivityCheckboxes input[type="checkbox"]'),n={};n.p=e;var i=[];if(t&&(n.username=t),a.length)for(var o=0,r=a.length;o<r;o++)a.eq(o).prop("checked")&&i.push(a[o].name);yt("account_activity",{p:e,username:t,types:i.join(",")})}function Bn(e){var t=[],a=$('#clanActivityCheckboxes input[type="checkbox"]'),n={};if(n.p=e,a.length)for(var i=0,o=a.length;i<o;i++)a.eq(i).prop("checked")&&t.push(a[i].name);n.types=t.join(","),yt("clan_activity",n)}function Pn(){$("#clanLinksWrapper a").removeClass("active"),$("#viewed_clan_notification").empty(),$("#myClanBuildingsWrapper,#myClanProfileWrapper,#viewedClanMemberWrapper,#myClanFundsWrapper,#myClanActivityWrapper,#myClanDonationWrapper,#myClanRankWrapper,#myClanRankEditWrapper,#myClanAdminWrapper,#myClanArmoryWrapper").hide()}function Nn(){yt("house_list",{}),$("#houseViewedWrapper").fadeOut(1e3,function(){$("#houseUnownedWrapper").fadeOut(1e3,function(){$("#houseListingWrapper").fadeIn(500)})})}function qn(){yt("register_check",{})}function Fn(e){e.m&&bn($("#area_list_notification"),e.m),e.monster&&ba(e.monster),$("#area_list").html(e.html),$("#areaName").html(e.room.area),$("#roomName").html(e.room.name),$("#roomDescription").html(e.room.desc),$("#area_preview_name").text($("#area_list option:selected").attr("data-name")),$("#area_preview_description").text($("#area_list option:selected").attr("data-desc")),$("#area_preview_travel_cost").html('Travel Cost: <span class="gold">'+ui($("#area_list option:selected").attr("data-travelcost"))+" Gold</span>"),$("#townWrapper,#townTravelWrapper").fadeIn()}function En(){$("#settingsLinksWrapper button").removeClass("active"),$("#account_management_notification").empty(),$("#settingsAccountDetailsWrapper,#settingsAccountTitleEditWrapper,#settingsAccountReferralsWrapper,#settingsAccountTitlesWrapper,#settingsAccountTitleCreateWrapper,#titleBackArrow,#settingsAccountPreferencesWrapper,#settingsClanPreferencesWrapper").hide()}function On(){$(".milestoneButton").removeClass("active"),$("#milestone_notification,#milestoneTable,#milestoneProgressTable").empty()}function Hn(){$(".preferenceButton").removeClass("active")}function Gn(e){if($("#accountTitleList").empty(),$.isEmptyObject(e))$("#title_notification").html("You don't have any titles of that kind.").show();else{$("#title_notification").hide();var t="";for(var a in e){var n=e[a],i=n.titles;t+='<div class="col-xs-12 col-md-12 col-centered" style="vertical-align:top;"><div class="row"><div class="col-xs-12"><h3 class="center nobg">'+a+"</h3>"+("hide"!==n.count?'<div class="center" style="font-size:80%;">'+i.length+" / "+n.count+"</div>":"")+"</div></div>",i.forEach(function(e){t+='<div class="row"><div class="col-xs-7 col-md-3 col-md-offset-4">'+e.title+'</div><div class="col-xs-3 col-md-1">'+(e.in_use?"In Use":'<a class="setTitleButton" data-id="'+e.id+'">Use</a>')+'</div><div class="col-xs-2 col-md-1">'+(e.can_edit?'<a class="titleChangeColor" data-id="'+e.id+'">Edit</a>':"")+"</div></div>"}),t+="</div>"}$("#accountTitleList").html(t)}}function Qn(e,t){$("#ranking_clan_sort").is(":checked")?yt("rankings_view_clan",{rank_type:e,page_num:t,clan_only:$("#ranking_clan_only").is(":checked"),active_only:$("#ranking_active_only").is(":checked")}):yt("rankings_view",{rank_type:e,page_num:t,clan_only:$("#ranking_clan_only").is(":checked"),active_only:$("#ranking_active_only").is(":checked")})}function Yn(){yt("settings_preferences",{})}function Un(e){$.each(e,function(e,t){$('#settingsAccountPreferencesWrapper input[type="text"][data-preference-id="'+e+'"').val(t);var a=$('#settingsAccountPreferencesWrapper input[data-preference-id="'+e+'"');a.length&&$.each(a,function(e,a){var n=$(a),i=n.val();(t&i)==i?n.prop("checked",!0):n.prop("checked",!1)})})}function jn(e){$("#settingsClanExpPreference").val(e.exp_tax),$("#settingsClanGoldPreference").val(e.gold_tax),$("#settingsClanResourcePreference").val(e.res_tax),$("#settingsClanDropPreference").val(e.drop_tax)}function Jn(e){yt("title_create",{currency:e,title:$("#titleCreateTitle").val(),colorid:$("#titleCreateColorOptions option:selected").attr("name"),freecolor:$("#titleCreateFreecolor").is(":checked")})}function Vn(){yt("title_create",{})}function zn(){$("#titleCreateDisplay").html('<span style="color: '+$("#titleCreateColorOptions option:selected").val()+' !important;">'+$("#titleCreateTitle").val()+"</span>")}function Xn(e){"up"==$t?T.prepend(e):(T.append(e),$("#chatMessageList").is(":hover")||$("#chatMessageListWrapper").animate({scrollTop:$("#chatMessageListWrapper").prop("scrollHeight")},0))}function Kn(){$n("currency",null,null,null,null,"premium"),va({title:"Market"}),$("#market_notification").hide(),$("#marketWrapper").show()}function Zn(e){e!=rt[rt.length-1]&&rt.push(e),rt.length>20&&rt.shift(),st=rt.length}function ei(e){var t=$.trim(W.html());if((t=(t=t.replace(/<br>/g,"")).replace(/&nbsp;/g," "))&&t.length>=1){var n=function(e){var t;if("/"==e[0]){var a,n=e.split(" "),i=n[0].toLowerCase();if("/profile"==i)return(a=(a=n.splice(1).join(" ")).match(/"(.*)+"/)?a.match(/"(.*)+"/)[1]:a)||(a=$("#username").text()),Vt(a),void Zn(e);if("/lookup"==i)return a=(a=n.splice(1).join(" ")).match(/"(.*)+"/)?a.match(/"(.*)+"/)[1]:a,za(),Xa("lookup"),Ka("username",a),void Zn(e);if("/logs"==i)return(a=(a=n.splice(1).join(" ")).match(/"(.*)+"/)?a.match(/"(.*)+"/)[1]:a)||(a=$("#username").text()),ya(),va({title:"Activity Log"}),$("#accountActivityWrapper").show(),An(0,a),void Zn(e);if("/addupdate"==i)yt("updates_add_template",{});else if("/calc"==i){var o=n.splice(1).join(" ");Xn('<li class="chat_notification">Calculation: '+o+" = "+math.eval(o)+"</li>"),Zn(e)}else if("/setchan"==i)$("#channel"+n[1]).prop("selected",!0);else if("/clear"==i)T.empty();else if("/help"==i)va({title:"Help Files"}),$("#helpWrapper").show(),$('.helpButton[data-type="CHAT"]').click();else if("/unignore"==i)t={type:"unignore",target:n[1]};else if("/ignore"==i)t={type:"ignore",target:n[1]};else if("/join"==i)t={type:"join",channel:n[1]?n[1]:$("#chatChannel option:selected").val(),password:n[2]};else if("/leave"==i)t={type:"leave",channel:n[1]?n[1]:$("#chatChannel option:selected").val()};else if("/mods"==i||"/modlist"==n[0])t={type:"modlist"};else if("/me"==i)t={type:"emote",channel:$("#chatChannel option:selected").val(),message:n.slice(1).join(" ")};else if("/list"==i)t={type:"chanlist",channel:$("#chatChannel option:selected").val()};else if("/ignorelist"==i)t={type:"ignorelist"};else if("/ignoredby"==i)t={type:"ignoredby"};else if("/ref"==i)t={type:"reflink"};else if("/online"==i)t={type:"onlinecount"};else if("/last"!=i||n[1]){var r,s=/\/(\d+)/g.exec(n[0]);s?(r=$("#channel"+$(".privateChannel").eq(s[1]-1).attr("data-id").replace(/\?/g,"\\?").replace(/</g,"\\<").replace(/\./g,"\\.").replace(/\&/g,"\\&").replace(/#/g,"\\#").replace(/'/g,"\\'").replace(/>/g,"\\>")).val(),e=n.slice(1).join(" ")):r=$("#chatChannel option:selected").val(),t={type:"message",channel:r,message:e}}else t={type:"history",channel:$("#chatChannel option:selected").val()}}else t={type:"message",channel:$("#chatChannel option:selected").val(),message:e};if(t)return t}(t);n&&(Zn(W.html()),a.send(JSON.stringify(n)))}else Xn('<li style="color: red;">What would you like to say?</li>');W.html("")}function ti(e){for(var t,n,i='<span style="color: #ff7;">[</span>',o='<span style="color: #ff7;">]</span>',r=e.length-1;r>=0;r--){var s="",l="";e[r].modtag&&(s=e[r].modtag);var c="",d=tt[e[r].c_id];if("Main"!=d&&(c=at[e[r].c_id]&&"AREA"!=d?i+'<span style="color: '+(e[r].chancolor?e[r].chancolor:at[e[r].c_id])+';">'+d+(e[r].chantag?" "+e[r].chantag:"")+"</span>"+o:i+'<span style="color: '+e[r].chancolor+';">'+e[r].channame+"</span>"+o),e[r].e>0&&(c+=" * "),e[r].title?(c+=" "+("CLAN"==d?'<span style="color: '+e[r].chancolor+';">'+e[r].title+"</span>":""),l="CLAN"!=d?-1!==e[r].title.indexOf("#USERNAME#")?e[r].title.replace("#USERNAME#",'<a class="profileLink">'+e[r].u+"</a>"):e[r].title+' <a class="profileLink">'+e[r].u+"</a>":'<a class="profileLink">'+e[r].u+"</a>"):l='<a class="profileLink">'+e[r].u+"</a>","login_info"==e[r].type){if(Ua((f=e[r]).p),clearInterval(window.currentinterval),Ga(),bt(f.equipment.bp,"breastplate"),bt(f.equipment.he,"helmet"),bt(f.equipment.ha,"gloves"),bt(f.equipment.bo,"boots"),bt(f.equipment.we,"weapon"),bt(f.equipment.oh,"shield"),kt(f.equipment.ri,"ring"),kt(f.equipment.am,"amulet"),kt(f.equipment.cr,"crown"),la(f.inventory),Da(),$("#townWrapper,#townMainWrapper").fadeIn(),$("#areaName").html(f.town.room.area),$("#roomName,#basePage>a").html(f.town.room.name),ae.text(ui(Math.max(0,f.p.next_action/1e3),1)),$("#roomDescription").html(f.town.room.desc),wa(f.town),f.town.monster&&ba(f.town.monster),f.house&&(nn(f.house),on(f.house.rooms),ln(f.house.can_build),f.house.can_house_harvest?$("#harvestronNotifier").show():$("#harvestronNotifier").hide()),f.restarting){"battling"==f.restarting?Ba():"crafting"==f.restarting?Fa():"carving"==f.restarting?Oa():Na();var p='<div class="center">You were away for '+e[r].time_away+" and have begun "+f.restarting+" again automatically.</div>";if(f.offline_rewards&&!$.isEmptyObject(f.offline_rewards)){var u=f.offline_rewards;p+='<div class="mt10">In your absense, you received: <ul>';for(var h in u)p+="<li>"+h+": "+f.offline_rewards[h]+"</li>";p+="</ul></div>"}$.alert("","Welcome Back!"),$("#confirmBox p").html(p)}}else if("logged_out"==e[r].type)window.location="/?expired=1";else if("multilog"==e[r].type)window.location="/?multilog=1";else if("got_banned"==e[r].type)window.location="/?banned=1";else if("page"==e[r].type){x.hide();var f=e[r];if("captcha_submit"==e[r].page)f.s?(n=f,f.t,f.z,Ua(n.p),$(".fatigueWrapper,.autoWrapper").hide(),$(".staminaBeingReplenished").show()):(f.v,$("#captcha_explanation").html("You failed to correctly enter the captcha.  Please try again."),grecaptcha.reset());else if("register"==e[r].page)Ua(f.p),f.s?($("#registrationInfo").html('<h3 class="nobg">Thanks for Registering!</h3>'+f.m),$("#username").text(f.u),$("#loadRegistration").remove(),$("#loadSettings").show()):($("#register_result").addClass("failure"),bn($("#register_notification"),f.m));else if("register_check"==e[r].page)va({title:"Account Registration"}),$("#accountManagementWrapper").show(),f.is_registered?(bn($("#account_management_notification"),"Your account is already registered!"),$("#loadRegistration").remove(),$("#loadSettings").show()):$("#accountRegistrationWrapper").show();else if("email_change"==e[r].page)f.s?($("#email_change_result").removeClass("failure"),$("#current_password_ef").val(""),$("#new_email").val(""),$("#new_email_confirm").val(""),$("#captchaHolderDetailChange").html('<div class="g-recaptcha center" style="margin-top: 10px;"></div>'),recaptchaOnloadCallback()):$("#email_change_result").addClass("failure"),bn($("#email_change_result"),f.m);else if("password_change"==e[r].page)f.s?($("#pw_change_result").removeClass("failure"),$("#current_password").val(""),$("#new_password").val(""),$("#new_password_confirm").val(""),$("#captchaHolderDetailChange").html('<div class="g-recaptcha center" style="margin-top: 10px;"></div>'),recaptchaOnloadCallback()):$("#pw_change_result").addClass("failure"),bn($("#pw_change_result"),f.m);else if("online_list"==e[r].page){var v=$("#onlineStaff").dataTable(),g=$("#onlinePlayers").dataTable();v.fnClearTable(),g.fnClearTable(),f.s.length&&v.fnAddData(f.s),f.p.length&&g.fnAddData(f.p),v.fnPageChange(0),g.fnPageChange(0);var _=v.fnGetData().length,b=g.fnGetData().length;_?$("#onlineStaffWrapper").show():$("#onlineStaffWrapper").hide(),b?$("#onlinePlayersWrapper").show():$("#onlinePlayersWrapper").hide(),$("#totalPlayersWrapper").html("There "+(1==_?"is":"are")+" currently "+ui(_)+" staff "+(1!=_?"members":"member")+" and "+ui(b)+" "+(1!=b?"players":"player")+" online.")}else if("reset_session_stats"==e[r].page)"battle"==f.stat?(S.text("0").attr("data-value",0),A.text("0").attr("data-value",0),B.text("0").attr("data-value",0),P.text("0").attr("data-value",0),N.text("0").attr("data-value",0),q.text("0").attr("data-value",0),F.text("100.00%")):"harvest"==f.stat?(E.text("0").attr("data-value",0),O.text("0").attr("data-value",0),H.text("0").attr("data-value",0)):"crafting"==f.stat?(G.text("0").attr("data-value",0),Q.text("0").attr("data-value",0),Y.text("0").attr("data-value",0),U.text("0").attr("data-value",0)):"carving"==f.stat&&(j.text("0").attr("data-value",0),J.text("0").attr("data-value",0),V.text("0").attr("data-value",0),z.text("0").attr("data-value",0));else if("profile"==e[r].page){if($("#viewed_profile_notification").text(""),!f.s)return $.alert("Sorry, you can't view the profile of someone who doesn't exist!"),$("#profile_no_user").show(),void $("#profile_exists").hide();$("#profile_no_user").hide(),$("#profile_exists").show(),f.result.clan?($("#profile_clan_info").show(),$("#profile_clan_rank").html(f.result.clan.rank),$("#profile_clan_name").html(f.result.clan.name)):$("#profile_clan_info").hide(),f.result.mine||f.result.im_staff?($("#profile_creation_info,#profileDescriptionEditButtons,.profile_per_day_wrapper,#profile_edit_edit,#profile_stat_statistics_button").show(),$("#profile_creation_date").text(f.result.creation_date)):$("#profile_creation_info,#profileDescriptionEditButtons,.profile_per_day_wrapper,#profile_edit_edit,#profile_stat_statistics_button").hide(),f.result.im_staff?($(".lookup, .mod_activity_view, .mod_post_note").attr("data-value",f.result.username),$("#profile_mod_links").show(),f.result.description.banned?($("#profile_edit_enable").show(),$("#profile_edit_disable").hide()):($("#profile_edit_enable").hide(),$("#profile_edit_disable").show())):$("#profile_mod_links,#profile_edit_enable,#profile_edit_disable").hide(),f.result.description.banned?($("#profile_banned_username").text(f.result.username),$("#profile_banned").show()):$("#profile_banned").hide(),$("#profile_gender").html(f.result.gender),$("#profile_title").html(f.result.title),$("#profile_link").html(f.result.link),$("#profile_edit_edit").val("Edit"+(f.result.mine?"":" as Moderator")),$("#profile_description").val(f.result.description.description),$("#profile_house_level").attr("data-owner",f.result.username);for(var w in f.result.levels){var C=f.result.levels[w];$("#profile_"+w+"_level").text(ui(C.level)),C.hasOwnProperty("rank")&&$("#profile_"+w+"_level_ranking").text("(#"+C.rank+")")}for(var w in f.result.stats){C=f.result.stats[w];$("#profile_stats_"+w).text(ui(C.value)),C.hasOwnProperty("rank")&&$("#profile_stats_"+w+"_ranking").text("(#"+C.rank+")")}$("#profile_kills").text(ui(f.result.battle.kills.value)),$("#profile_kills_ranking").text("(#"+f.result.battle.kills.rank+")"),$("#profile_kills_per_day").text(ui(f.result.battle.kills.per_day)),$("#profile_deaths").text(ui(f.result.battle.deaths.value)),$("#profile_deaths_ranking").text("(#"+f.result.battle.deaths.rank+")"),$("#profile_harvests").text(ui(f.result.harvests.harvests.value)),$("#profile_harvests_ranking").text("(#"+f.result.harvests.harvests.rank+")"),$("#profile_harvests_per_day").text(ui(f.result.harvests.harvests.per_day)),$("#profile_resources_gained").text(ui(f.result.harvests.resources.value)),$("#profile_resources_gained_ranking").text("(#"+f.result.harvests.resources.rank+")"),$("#profile_crafts").text(ui(f.result.profession.crafts.value)),$("#profile_crafts_ranking").text("(#"+f.result.profession.crafts.rank+")"),$("#profile_crafts_per_day").text(ui(f.result.profession.crafts.per_day)),$("#profile_carves").text(ui(f.result.profession.carves.value)),$("#profile_carves_ranking").text("(#"+f.result.profession.carves.rank+")"),$("#profile_carves_per_day").text(ui(f.result.profession.carves.per_day)),$("#profile_quests").text(ui(f.result.quest.total.value)),$("#profile_quests_ranking").text("(#"+f.result.quest.total.rank+")"),$("#profile_quests_battle").text(ui(f.result.quest.battle.value)),$("#profile_quests_harvest").text(ui(f.result.quest.harvest.value)),$("#profile_quests_profession").text(ui(f.result.quest.profession.value)),f.result.hasOwnProperty("other")&&($("#profile_damage_total").text(ui(f.result.other.damage.total)),$("#profile_damage_weapon").text(ui(f.result.other.damage.weapon)),$("#profile_damage_training").text(ui(f.result.other.damage.training)),$("#profile_armor_penetration").text(ui(f.result.other.damage.armor_penetration,2)+"%"),$("#profile_armor_total").text(ui(f.result.other.armor.total)),$("#profile_armor_level").text(ui(f.result.other.armor.level)),$("#profile_armor_equipment").text(ui(f.result.other.armor.equipment)),$("#profile_armor_training").text(ui(f.result.other.armor.training)),$("#profile_armor_toughness").text(ui(f.result.other.armor.toughness)),$("#profile_armor_house").text(ui(f.result.other.armor.house))),ya(),va({title:f.result.username+"'s Profile"}),$("#profileWrapper").show();var L=$("#profile_description");L.length&&(L.height(0).height(L.prop("scrollHeight")),L.val().split("\n").length>5&&L.height("inherit").attr("rows",5),L.prop("readonly",!0))}else if("town"==e[r].page)Da(),$("#areaName").html(f.room.area),$("#roomName,#basePage>a").html(f.room.name),ae.text(ui(Math.max(0,f.p.next_action/1e3),1)),$("#roomDescription").html(f.room.desc),wa(f),Ua(f.p),$("#townWrapper,#townMainWrapper").fadeIn(),f.monster&&ba(f.monster),clearInterval(window.currentinterval),Ga();else if("town_blacksmith"==e[r].page)f.monster&&ba(f.monster),$("#areaName").html(f.room.area),$("#roomName").html(f.room.name),$("#roomDescription").html(f.room.desc),xa(f),$("#townWrapper,#townForgeWrapper").fadeIn(),clearInterval(window.currentinterval),Ga();else if("town_battlegrounds"==e[r].page)if($("#areaName").html(f.room.area),$("#roomName").html(f.room.name),$("#roomDescription").html(f.room.desc),$("#townWrapper,#enemyListWrapper").show(),ae.text(ui(Math.max(0,f.p.next_action/1e3),1)),Ua(f.p),f.e){$("#enemyWrapper").show(),$("#noEnemyWrapper").hide(),$("#enemyList").empty();for(var R=0;R<f.e.length;R++)$("#enemyList").append("<option"+(f.e[R].s?' selected="selected" style="color: #FF7;"':f.e[R].q?' style="color: #21FF00;"':"")+' value="'+f.e[R].v+'" name="'+f.e[R].n+'">'+f.e[R].n+"</option>");clearInterval(window.currentinterval),Ga()}else $("#enemyWrapper").hide(),$("#noEnemyWrapper").show(),$("#noEnemyWrapper").html("No enemies were found in this area.");else if("town_travel"==e[r].page)Fn(f),clearInterval(window.currentinterval),Ga();else if("buy_item"==e[r].page)f.needs_confirm?setTimeout(function(){$.confirm({title:"Shipping Confirmation",message:f.m,buttons:{OK:{class:"green",action:function(){La(f.item_type,f.tier,!0)}},Cancel:{class:"red",action:function(){}}}})},1e3):ka(f.m),f.shop_info&&xa(f),f.s&&Ja(f.m),f.p&&Ua(f.p);else if("travel"==e[r].page)Da(),Fn(f),wa(f),Ua(f.p);else if("quests"==e[r].page)va({title:"Quest Center"}),$("#questWrapper").show(),f.el&&$("#quest_enemy_list").html(f.el),f.lh&&$('.questButton[value="'+f.lh+'"]').click(),f.ph&&$('.questButton[value="'+f.ph+'"]').click();else if("quest_request"==e[r].page){if(Ua(f.p),f.first_quest)return;bn($("#quest_notification"),f.m),Zt()}else if("quest_complete"==e[r].page)bn($("#quest_notification"),f.m),Ua(f.p),Zt();else if("quest_forfeit_check"==e[r].page)f.p?$.confirm({title:"Quest Forfeit Confirmation",message:f.m,buttons:{OK:{class:"green",action:function(){yt("quest_forfeit",{qtype:f.qtype})}},Cancel:{class:"red",action:function(){}}}}):bn($("#quest_notification"),f.m);else if("quest_forfeit"==e[r].page)bn($("#quest_notification"),f.m),Ua(f.p),Zt();else if("stamina_replenish"==e[r].page)e[r].captcha||e[r].s>0&&($(".fatigueWrapper,.autoWrapper").hide(),$(".staminaBeingReplenished").show()),Ua(e[r].p);else if("equipment"==e[r].page)bt(e[r].result.bp,"breastplate"),bt(e[r].result.he,"helmet"),bt(e[r].result.ha,"gloves"),bt(e[r].result.bo,"boots"),bt(e[r].result.we,"weapon"),bt(e[r].result.oh,"shield"),kt(e[r].result.ri,"ring"),kt(e[r].result.am,"amulet"),kt(e[r].result.cr,"crown");else if("inventory_items"==e[r].page)la(f),$("#inventoryItemCountHeld").text(f.held),$("#inventoryItemCountMaximum").text(f.holdable),e[r].loadouts.length?($("#mannequinInfo").show(),$("#mannequinOptions").html(e[r].loadouts.map(function(e){return'<option value="'+e+'">'+e+"</option>"}))):$("#mannequinInfo").hide();else if("inventory_gems"==e[r].page)sa(f.result);else if("inventory_tools"==e[r].page)$("#gemFilterHolder").hide(),$("#inventoryTable").empty(),f.result.s?($("#inventoryTable").append('<tr class="hidden-xs hidden-sm"><th>Resource</th><th>Tool</th><th>Tool Tier</th><th>Level</th><th>Upgrade</th></tr>'),$.each(f.result.t,function(e,t){$("#inventoryTable").append('<tr><td data-th="Resource">'+t.r+'</td><td data-th="Tool">'+Wt(t)+'</td><td data-th="Tool Tier">'+t.t+'</td><td data-th="Level">'+t.level+'</td><td data-th="Upgrade">'+(t.c_u?'<a class="toolUpgrade'+(t.c_l?"":" disabled")+'" data-type="'+t.s+'">[Once]</a>':"")+" "+(t.c_u?'<a class="toolUpgradeMax'+(t.c_l?"":" disabled")+'" data-type="'+t.s+'">[Max]</a>':"")+"</td></tr>")})):$("#inventoryTable").append('<tr><td class="nomatch center">You don\'t have any tools.</td></tr>');else if("inventory_accessories"==e[r].page){$("#gemFilterHolder").hide(),(ne=$("#inventoryTable")).empty(),"No items"!==f.result&&f.result.length?(ne.append('<tr class="hidden-xs hidden-sm"><th>Accessory</th><th>Actions</th></tr>'),$.each(f.result,function(e,t){ne.append('<tr><td data-th="Accessory">'+Tt(t)+'</td><td data-th="Actions"><a class="equipAccessoryLink'+(t.cw?"":" disabled")+'" data-id="'+t.i+'">[Equip]</a>'+(t.c_a?' <a class="upgradeAccessoryLink" data-id="'+t.i+'">[Upgrade]</a>':"")+"</td></tr>")})):ne.html('<tr><td class="center nomatch" style="vertical-align: top;">You aren\'t carrying any accessories.</td></tr>')}else if("inventory_ingredients"==e[r].page){$("#gemFilterHolder").hide(),(ne=$("#inventoryTable")).empty(),"No items"===f.result?ne.html('<tr><td class="center nomatch" style="vertical-align: top;">You aren\'t carrying any '+f.item_type+".</td></tr>"):(ne.append('<tr class="hidden-xs hidden-sm"><th>Ingredient</th><th>Amount</th><th>Actions</th></tr>'),$.each(f.result,function(e,t){ne.append('<tr><td data-th="Item">'+t.n+'</td><td data-th="Amount">'+ui(t.v)+'</td><td data-th="Actions">'+(t.m?'<a class="marketIngredientLink" data-id="'+t.iid+'" data-amount="'+t.v+'">[Market]</a> <a class="wireIngredientLink" data-id="'+t.iid+'" data-amount="'+t.v+'">[Send]</a>':"")+"</td></tr>")}))}else if("inventory_consumables"==e[r].page){$("#gemFilterHolder").hide(),(ne=$("#inventoryTable")).empty(),"No items"===f.result?ne.html('<tr><td class="center nomatch" style="vertical-align: top;">You aren\'t carrying any '+f.item_type+".</td></tr>"):(ne.append('<tr class="hidden-xs hidden-sm"><th>Consumable</th><th>Amount</th><th>Actions</th></tr>'),$.each(f.result,function(e,t){ne.append('<tr><td data-th="Item" title="'+t.d+'">'+t.n+'</td><td data-th="Amount">'+ui(t.v)+'</td><td data-th="Actions"><a class="'+(t.share?"consumableShare":t.transfer?"consumableTransfer":"consumableConsume")+'" data-id="'+t.iid+'" data-amount="'+t.v+'">[Use]</a></td></tr>')}))}else if("equip"==e[r].page||"unequip"==e[r].page)Lt(e[r].m),f.equip&&(bt(e[r].equip.bp,"breastplate"),bt(e[r].equip.he,"helmet"),bt(e[r].equip.ha,"gloves"),bt(e[r].equip.bo,"boots"),bt(e[r].equip.we,"weapon"),bt(e[r].equip.oh,"shield"),kt(e[r].equip.ri,"ring"),kt(e[r].equip.am,"amulet"),kt(e[r].equip.cr,"crown")),la(f),Ua(e[r].p);else if("equip_accessory"==e[r].page||"unequip_accessory"==e[r].page){Lt(f.result),f.equip&&(bt(f.equip.bp,"breastplate"),bt(f.equip.he,"helmet"),bt(f.equip.ha,"gloves"),bt(f.equip.bo,"boots"),bt(f.equip.we,"weapon"),bt(f.equip.oh,"shield"),kt(f.equip.ri,"ring"),kt(f.equip.am,"amulet"),kt(f.equip.cr,"crown")),(ne=$("#inventoryTable")).empty(),f.inv&&f.inv.length?(ne.append('<tr class="hidden-xs hidden-sm"><th>Accessory</th><th>Actions</th></tr>'),$.each(f.inv,function(e,t){ne.append('<tr><td data-th="Accessory">'+Tt(t)+'</td><td data-th="Actions"><a class="equipAccessoryLink'+(t.cw?"":" disabled")+'" data-id="'+t.i+'">[Equip]</a>'+(t.c_a?' <a class="upgradeAccessoryLink" data-id="'+t.i+'">[Upgrade]</a>':"")+"</td></tr>")})):ne.html('<tr><td class="center nomatch" style="vertical-align: top;">You aren\'t carrying any accessories.</td></tr>'),Ua(f.p)}else if("item_options"==e[r].page){if(f.s)ga({title:"Item Options",content:He=f.result});else $.alert(f.result)}else if("gem_options"==e[r].page){if(f.s)ga({title:"Gem Options",content:He=f.result});else $.alert(f.result)}else if("ingredient_wire"==e[r].page){Lt(f.result),_a(),(ne=$("#inventoryTable")).empty(),"No items"===f.ingredients?ne.html('<tr><td class="center nomatch" style="vertical-align: top;">You aren\'t carrying any ingredients.</td></tr>'):(ne.append('<tr class="hidden-xs hidden-sm"><th>Ingredient</th><th>Amount</th><th>Actions</th></tr>'),$.each(f.ingredients,function(e,t){ne.append('<tr><td data-th="Item">'+t.n+'</td><td data-th="Amount">'+ui(t.v)+'</td><td data-th="Actions"><a class="marketIngredientLink" data-id="'+t.iid+'" data-amount="'+t.v+'">[Market]</a> <a class="wireIngredientLink" data-id="'+t.iid+'" data-amount="'+t.v+'">[Send]</a></td></tr>')}))}else if("accessory_upgrade_check"==e[r].page){var M=e[r].accessory_id,I={};f.can&&(I.OK={class:"green",action:function(){yt("accessory_upgrade",{accessory:M})}}),I.Cancel={class:"red",action:function(){}},$.confirm({title:"Accessory Upgrade Confirmation",message:f.result+(f.can?"<br /><br/>Press OK to continue upgrading this accessory.":""),buttons:I})}else if("accessory_upgrade"==e[r].page){var ne;Lt(f.result),(ne=$("#inventoryTable")).empty(),f.equip&&(bt(f.equip.bp,"breastplate"),bt(f.equip.he,"helmet"),bt(f.equip.ha,"gloves"),bt(f.equip.bo,"boots"),bt(f.equip.we,"weapon"),bt(f.equip.oh,"shield"),kt(f.equip.ri,"ring"),kt(f.equip.am,"amulet"),kt(f.equip.cr,"crown")),f.inv&&f.inv.length?(ne.append('<tr class="hidden-xs hidden-sm"><th>Accessory</th><th>Actions</th></tr>'),$.each(f.inv,function(e,t){ne.append('<tr><td data-th="Accessory">'+Tt(t)+'</td><td data-th="Actions"><a class="equipAccessoryLink'+(t.cw?"":" disabled")+'" data-id="'+t.i+'">[Equip]</a>'+(t.c_a?' <a class="upgradeAccessoryLink" data-id="'+t.i+'">[Upgrade]</a>':"")+"</td></tr>")})):ne.html('<tr><td class="center nomatch" style="vertical-align: top;">You aren\'t carrying any accessories.</td></tr>'),Ua(f.p)}else if("harvest_level_increase_check"==e[r].page)$.confirm({title:"Harvesting Level Increase Confirmation",message:f.result,buttons:{Yes:{class:"green",action:function(){yt("harvest_level_increase",{skill:f.skill})}},No:{class:"red",action:function(){}}}});else if("harvest_level_increase"==e[r].page){if(Lt(f.result),f.s){Ua(f.p);var ie=$('.toolUpgrade[data-type="'+f.skill+'"]').parent().parent().children().eq(3),oe=parseInt(ie.html())+1;f.c_l?($('.toolUpgrade[data-type="'+f.skill+'"]').find("toolUpgrade").removeClass("disabled"),$('.toolUpgrade[data-type="'+f.skill+'"]').find("toolUpgradeMax").removeClass("disabled")):($('.toolUpgrade[data-type="'+f.skill+'"]').find("toolUpgrade").addClass("disabled"),$('.toolUpgrade[data-type="'+f.skill+'"]').find("toolUpgradeMax").addClass("disabled")),ie.html(oe)}}else if("harvest_level_max_check"==e[r].page){I={};f.skill?(I.Yes={class:"green",action:function(){yt("harvest_level_max",{skill:f.skill})}},I.No={class:"red",action:function(){}}):I.OK={class:"green",action:function(){}},$.confirm({title:"Harvesting Level Maximum Increase Confirmation",message:f.result,buttons:I})}else if("harvest_level_max"==e[r].page)Lt(f.result),f.s&&(Ua(f.p),$("#inventoryTable").empty(),$("#inventoryTable").append('<tr class="hidden-xs hidden-sm"><th>Resource</th><th>Tool</th><th>Tool Tier</th><th>Level</th><th>Upgrade</th></tr>'),f.t.s?$.each(f.t.t,function(e,t){$("#inventoryTable").append('<tr><td data-th="Resource">'+t.r+'</td><td data-th="Tool">'+Wt(t)+'</td><td data-th="Tool Tier">'+t.t+'</td><td data-th="Level">'+t.level+'</td><td data-th="Upgrade">'+(t.c_u?'<a class="toolUpgrade'+(t.c_l?"":" disabled")+'" data-type="'+t.s+'">[Once]</a>':"")+" "+(t.c_u?'<a class="toolUpgradeMax'+(t.c_l?"":" disabled")+'" data-type="'+t.s+'">[Max]</a>':"")+"</td></tr>")}):$("#inventoryTable").append('<tr><td class="nomatch center">You don\'t have any tools.</td></tr>'));else if("scrap"==e[r].page)Lt(e[r].result),e[r].itemid&&$('#inventoryTable .itemWithTooltip[data-json*="'+e[r].itemid+'"]').parent().parent().remove();else if("item_donate_to_clan"==e[r].page)Lt(e[r].m),e[r].itemid&&$('#inventoryTable .itemWithTooltip[data-json*="'+e[r].itemid+'"]').parent().parent().remove(),f.result&&ca(f);else if("item_return_to_clan"==e[r].page)f.result&&ca(f),bn($("#viewed_clan_notification"),f.m);else if("item_receive_from_clan"==e[r].page)D.is(":visible")&&_a(),f.result&&ca(f),bn($("#viewed_clan_notification"),f.m);else if("item_revoke_from_clan"==e[r].page)f.result&&ca(f),bn($("#viewed_clan_notification"),f.m);else if("scrap_all_check"==e[r].page)if(e[r].s){var re=e[r].item_type,se=e[r].q,le=e[r].result;$.confirm({title:"Mass Scrap Confirmation",message:le,buttons:{Yes:{class:"green",action:function(){yt("scrap_all",{item_type:re,quality:se})}},No:{class:"red",action:function(){}}}})}else bn($("#mass_scrap_notification"),e[r].result);else if("scrap_all"==e[r].page)Lt(e[r].result),e[r].s&&(da(e[r].item_type),_a(),Ua(e[r].p));else if("gem_deconstruct"==e[r].page)Lt(e[r].result),e[r].gemid&&$('#inventoryTable .gemWithTooltip[data-json*="'+e[r].gemid+'"]').parent().parent().remove();else if("deconstruct_all_check"==e[r].page)if(f.s){var ce=f.list;$.confirm({title:"Mass Deconstruction Confirmation",message:f.result,buttons:{Yes:{class:"green",action:function(){yt("deconstruct_all",{list:ce})}},No:{class:"red",action:function(){}}}})}else $.alert(f.result);else if("deconstruct_all"==e[r].page)Lt(f.result),f.s?(sa(f.gems),Ua(f.p)):$.alert(f.result);else if("settings_check"==e[r].page)$("#captchaHolderDetailChange").html('<div class="g-recaptcha center" style="margin-top: 10px;"></div>'),recaptchaOnloadCallback(),va({title:"Account Management"}),$("#accountManagementWrapper").show(),f.has_email?($("#registrationLinkEmailWrapper").hide(),null==f.activation?$("#registrationConfirmationWrapper").hide():$("#registrationConfirmationWrapper").show()):($("#registrationConfirmationWrapper").hide(),$("#registrationLinkEmailWrapper").show()),f.is_registered?($("#accountSettingsWrapper").show(),f.is_clanned?$("#settingsClanPreferences").show():$("#settingsClanPreferences").hide()):(bn($("#account_management_notification"),"You must register before changing account settings."),qn());else if("settings_milestones"==e[r].page)f.m?bn($("#milestone_notification"),f.m):"PROGRESS_CHECK"==e[r].milestone_type?($("#milestoneTable").hide(),$("#milestoneProgressTable").show(),$("#milestoneProgressTable").append('<tr class="hidden-xs hidden-sm"><th>Milestone Type</th><th>Progress</th><th>Reward</th></tr>'),$.each(f.milestones.daily,function(e,t){$("#milestoneProgressTable").append('<tr><td colspan="2"><div class="milestoneBarWrapper"><div class="milestoneBarName">'+t.name+'</div><div class="milestoneBarProgressText">'+t.current+" / "+t.next+" ("+ui(t.percent,2)+'%)</div><div class="milestoneBarFillComplete" style="width: '+t.percent+'%"></div><div class="milestoneBarFillIncomplete"></div><div style="clear: both;"></div></td><td>'+t.reward+"</td></tr>")}),$.each(f.milestones.lifetime,function(e,t){$("#milestoneProgressTable").append('<tr><td colspan="2"><div class="milestoneBarWrapper"><div class="milestoneBarName">'+t.name+'</div><div class="milestoneBarProgressText">'+t.current+" / "+t.next+" ("+ui(t.percent,2)+'%)</div><div class="milestoneBarFillComplete" style="width: '+t.percent+'%"></div><div class="milestoneBarFillIncomplete"></div><div style="clear: both;"></div></td><td>'+t.reward+"</td></tr>")})):($("#milestoneTable").show(),$("#milestoneProgressTable").hide(),$("#milestone_notification").html((f.milestones.totalfame?"You have earned a total of "+ui(f.milestones.totalfame)+" fame from "+f.milestones.type+" milestones.<br />":"")+f.milestones.next),$("#milestoneTable").append('<tr class="hidden-xs hidden-sm"><th>'+f.milestones.type+"</th><th>"+f.milestones.rewardtype+" Reward</th><th>Progress</th></tr>"),$.each(f.milestones.milestone,function(e,t){$("#milestoneTable").append("<tr"+(t.has?' class="active"':"")+'><td data-th="'+f.milestones.type+'">'+(isNaN(t.amt)?t.amt:ui(t.amt))+'</td><td data-th="'+f.milestones.rewardtype+'">'+(isNaN(t.fame)?t.fame:ui(t.fame))+'</td><td data-th="Progress">'+(isNaN(t.progress)?t.progress:ui(t.progress,2)+"%")+"</td></tr>")}),$("#milestoneTableWrapper").animate({scrollTop:$("#milestoneTableWrapper").prop("scrollHeight")},0));else if("settings_preferences"==e[r].page)Un(f.preferences),$('#settingsAccountPreferencesWrapper ul[data-preference-id="10"]').html(f.cl),jn(f.taxes);else if("settings_preferences_change"==e[r].page){if(bn($("#account_management_notification"),f.m),f.s){Un(f.preferences);var de=$t;($t=f.cs)!=de&&(T.children().each(function(e,t){T.prepend(t)}),"up"==$t?($("#chatMessageListWrapper").animate({scrollTop:0},0),$("#chatMessageListWrapper").before($("#chatMessageWrapper"))):($("#chatMessageListWrapper").animate({scrollTop:$("#chatMessageListWrapper").prop("scrollHeight")},0),$("#chatMessageListWrapper").after($("#chatMessageWrapper")))),f.theme?$("body").attr("class")!=f.theme&&$("body").css("background","#013B39").animate({"background-color":"#FFF",opacity:0},2e3,function(){$("body").attr("class",f.theme).animate({opacity:1},2e3).css("background","")}):($("body").hasClass("workmode")||$("body").hasClass("halloween")||$("body").hasClass("veesy")||$("body").hasClass("stripped")||$("body").hasClass("vday")||$("body").hasClass("novday"))&&$("body").animate({opacity:0},2e3,function(){$("body").css("background","#FFF").attr("class","").animate({"background-color":"#013B39"},2e3,function(){$("body").css("background","").animate({opacity:1})})})}}else if("settings_clan_taxes"==e[r].page)bn($("#account_management_notification"),f.result.m),jn(f.result.taxes);else if("referrals_load"==e[r].page)if(f.result.c>0){$("#accountReferralCount").text("You have referred "+ui(f.result.c)+" player"+(1!=f.result.c?"s":"")+" with a total of "+ui(f.result.total_rewards.nobility)+" nobility and "+ui(f.result.total_rewards.fame)+" fame."),$("#accountReferralTableHolder").show();var pe=$("#accountReferralTable").dataTable();pe.fnClearTable(),f.result.refs.length&&pe.fnAddData(f.result.refs)}else $("#accountReferralCount").text("You haven't referred anyone yet."),$("#accountReferralTableHolder").hide();else if("titles_view"==e[r].page)f.result.m?bn($("#title_notification"),f.result.m):Gn(f.result.groups);else if("title_create"==e[r].page)f.colors?($("#settingsAccountTitlesWrapper").hide(),$("#settingsAccountTitleCreateWrapper").show(),$("#titleBackArrow").show(),$("#titleCreateColorOptions,#titleCreateTitle").empty(),$("#titleCreateFreecolor").prop("checked",!1),$.each(f.colors,function(e,t){$("#titleCreateColorOptions").append('<option id="'+t.id+'" name="'+t.id+'" style="color: '+t.color+' !important;">'+t.color+"</span>")}),$("#titleCreateColorOptions").change()):(bn($("#title_create_notification,#title_notification"),f.m),f.s&&(f.titles&&Gn(f.titles.groups),$("#backToTitleList").click(),$("#titleCreateTitle").empty(),$("#titleCreateFreecolor").prop("checked",!1).change(),Ua(f.p)));else if("title_edit"==e[r].page)f.result?($("#settingsAccountTitlesWrapper").hide(),$("#settingsAccountTitleEditWrapper").show(),$("#titleBackArrow").show(),$("#title_edit_notification").empty(),f.result.title?($("#titleEditColor,#titleEditMakeFreecolor").attr("data-id",f.result.titleid),$("#titleEditColorOptions").empty(),$("#titleEditTitle").text(f.result.title),$.each(f.result.colors,function(e,t){$("#titleEditColorOptions").append('<option id="'+t.id+'" name="'+t.id+'" style="color: '+t.color+' !important;">'+t.color+"</span>")}),$("#titleEditColorOptions").change(),f.result.fc>0?($("#titleEditMakeFreecolor").hide(),$("#titleEditColor").val("Change color")):($("#titleEditMakeFreecolor").show(),$("#titleEditColor").val("Change color for 50 Crystals"))):bn($("#title_edit_notification"),f.m)):(bn($("#title_notification,#title_edit_notification"),f.m),f.s&&(f.titles&&Gn(f.titles.groups),Ua(f.p)));else if("titles_set"==e[r].page){bn($("#title_notification"),f.m);var ue=f.result;ue.s&&Gn(ue.titles.groups),Ua(ue.p)}else if("training"==e[r].page)$("#training_cost_total").text(f.reduction),At(f.skills,!0);else if("train_skill"==e[r].page)Ua(f.p),At(f.skills),bn($("#train_notification"),f.m);else if("boosts"==e[r].page)$("#premiumShopCurrentNobility").text(ui(f.n)),$("#premium_purchased_today").text(f.ppt),$("#premium_purchased_today_word").text("crystal"+(1==f.ppt?"":"s")),$("#premium_purchase_gold_count").val(0).keyup(),Ot(f.boosts,!0),$promoElement=$("#currentPromotions"),$promoElement.html(""),f.cs?($("#spendingLimitWrapper").show(),$("#premiumSpendingLimit").text(f.cs),$("#premiumShopDollarAmount").attr("max",f.cs)):($("#spendingLimitWrapper").hide(),$("#premiumShopDollarAmount").attr("max",99999)),$("#spending_limit_change_time").text(f.cst),f.promos?$.each(f.promos,function(e,t){$promoElement.append('<div class="center"><h5 class="active nobg">'+t.n+"</h5> ("+(t.tl?t.tl+" remaining":"running indefinitely")+")<div>"+t.d+"</div></div>")}):$promoElement.append('<div class="center">There are currently no active promotions.</div>');else if("boosts_set_spending_limit"==e[r].page)Et(),bn($("#premium_shop_notification"),f.m);else if("boost_purchase"==e[r].page)f.s>0&&(Ua(f.p),f.boosts&&Ot(f.boosts,!0)),bn($("#premium_shop_notification"),f.m);else if("boost_purchase_stamina"==e[r].page)f.s>0&&(Ua(f.p),Ot(f.boosts)),bn($("#premium_shop_notification"),f.m);else if("purchase_crystals_gold"==e[r].page)f.m&&bn($("#premium_shop_notification"),f.m),f.s&&$("#premium_purchase_gold_count").val(0).keyup(),f.p&&(Ua(f.p),$("#premium_purchased_today").text(f.ppt),$("#premium_purchased_today_word").text("crystal"+(1==f.ppt?"":"s")));else if("boost_allocation"==e[r].page)bn($("#allocation_notification"),f.m),Ua(f.p);else if("boost_allocation_template"==e[r].page)ga({title:"Reallocate Boosts",content:f.m});else if("house"==e[r].page){if(!f.s)return void $.alert("That user doesn't have a house!");va({title:"Housing"}),$("#houseWrapper,#houseRoomBuildingWrapper").show(),$("#houseViewedRoomWrapper,#houseViewedRoomItemWrapper,#houseListingWrapper").hide(),f.have?($("#houseViewedWrapper").show(),$("#houseUnownedWrapper").hide(),bn($("#house_notification"),f.m),nn(f),on(f.rooms),ln(f.can_build),f.mine?($("#houseRoomBuildingWrapper"),$("#houseXPBar,#houseRoomsBuiltWrapper,#houseQuickBuildWrapper").show()):($("#houseRoomBuildingWrapper"),$("#houseXPBar,#houseRoomsBuiltWrapper,#houseBuildNewRoomWrapper,#houseRoomCanBuild,#houseRoomCannotBuild,#houseQuickBuildWrapper").hide())):($("#houseViewedWrapper").hide(),$("#houseUnownedWrapper").show(),f.can_buy?($("#houseOverlevel").show(),$("#houseUnderlevel").hide()):($("#houseOverlevel").hide(),$("#houseUnderlevel").show()))}else if("house_list"==e[r].page){(ge=$("#house_list").dataTable()).fnClearTable(),f.houses.length&&ge.fnAddData(f.houses),ge.fnPageChange(0)}else if("house_build_room"==e[r].page)bn($("#house_notification"),f.m),Ua(f.p),nn(f),f.s&&(on(f.rooms),ln(f.b_r));else if("house_build_room_item"==e[r].page){if(bn($("#house_notification"),f.m),Ua(f.p),nn(f),f.s)(me=$('.houseViewRoom[data-type="'+f.room.room_type+'"]')).find(".room_item_count").text(f.room.items.length),me.find(".room_item_max").text(f.room.items.length+f.room.b_i.length),rn(0,f.room),sn(f.room),ln(f.b_r)}else if("house_room_item_upgrade_level"==e[r].page||"house_room_item_upgrade_tier"==e[r].page)bn($("#house_notification"),f.m),Ua(f.p),nn(f),f.s&&($("#constructionNotifier").hide(),on(f.rooms),pn(f.item),ln(f.b_r));else if("house_room"==e[r].page){var me;$("#houseRoomBuildingWrapper").fadeOut(function(){$("#houseViewedRoomItemWrapper").fadeOut(function(){$("#houseViewedRoomWrapper").fadeIn()})}),f.m&&bn($("#house_notification"),f.m),f.room&&(me=$('.houseViewRoom[data-type="'+f.room.room_type+'"]'),$("#houseRoomName").text(f.room.name),sn(f.room),rn(0,f.room),$(".houseViewRoom.active").removeClass("active"),me.addClass("active")),D.is(":visible")&&_a()}else if("house_room_item"==e[r].page)va({title:"Housing"}),$("#houseViewedRoomItemWrapper").is(":visible")||($("#houseListingWrapper").hide(),$("#houseViewedWrapper").show(),$("#houseViewedRoomWrapper").fadeOut(function(){$("#houseRoomBuildingWrapper").fadeOut(function(){$("#houseWrapper").fadeIn(function(){$("#houseViewedRoomItemWrapper").fadeIn()})})})),f.m&&bn($("#house_notification"),f.m),f.item&&pn(f.item);else if("house_bonus_check"==e[r].page){if(f.m)return void $.alert(f.m);p='<div class="center" style="margin: 0 auto;"><ul style="list-style-type: none;">';jQuery.isEmptyObject(f.bonuses)?p+="<li>No items provide that boost!</li>":$.each(f.bonuses,function(e,t){p+='<li><a class="houseViewRoomItem" data-roomtype="'+t.rid+'" data-itemtype="'+t.iid+'">'+t.iname+"</a> - "+t.e+" - "+t.ut+"</li>"}),ga({title:"House Bonuses",content:p+="</ul></div>"})}else if("house_all_builds"==e[r].page){if(f.m)return void $.alert(f.m);p='<div class="center" style="margin: 0 auto;"><ul style="list-style-type: none;">';$.each(f.q_b,function(e,t){"level"==t.ty?p+="<li"+(t.hf?"":' style="text-decoration: line-through"')+">"+(t.ig?'<a class="houseUnignoreQuickBuild" data-type="'+t.i+'">[+]</a> - ':"")+'<a class="houseViewRoomItem" data-roomtype="'+t.r+'" data-itemtype="'+t.i+'">'+t.n+" ("+t.rn+")</a> - "+t.tn+"</li>":"new_item"==t.ty?p+="<li"+(t.hf?"":' style="text-decoration: line-through"')+'><a class="houseViewRoom" data-type="'+t.r+'">'+t.n+" ("+t.rn+")</a> - "+t.tn+"</li>":"tier"==t.ty&&(p+="<li"+(t.hf?"":' style="text-decoration: line-through"')+'><a class="houseViewRoomItem" data-roomtype="'+t.r+'" data-itemtype="'+t.i+'">'+t.n+"</a> -> "+t.nn+" - "+t.tn+"</li>")}),ga({title:"House Build Timers",content:p+="</ul></div>"})}else if("house_harvest_job"==e[r].page)f.c?an(f.skill,f.minutes,f.m):(bn($("#house_notification"),f.m),f.s&&($("#harvestronNotifier").hide(),Ua(f.p),pn(f.item)));else if("loadout_add"==e[r].page)bn($("#house_notification"),f.m),f.s&&pn(f.item);else if("loadout_remove"==e[r].page)bn($("#house_notification"),f.m),f.s&&pn(f.item);else if("loadout_use"==e[r].page)bn($("#house_notification"),f.m),Lt(f.m),f.item&&pn(f.item),f.equipment&&(bt(f.equipment.bp,"breastplate"),bt(f.equipment.he,"helmet"),bt(f.equipment.ha,"gloves"),bt(f.equipment.bo,"boots"),bt(f.equipment.we,"weapon"),bt(f.equipment.oh,"shield"),kt(f.equipment.ri,"ring"),kt(f.equipment.am,"amulet"),kt(f.equipment.cr,"crown")),f.result&&la(f);else if("house_harvest_job_cancel"==e[r].page)bn($("#house_notification"),f.m),f.s&&($("#harvestronNotifier").show(),Ua(f.p),pn(f.item));else if("house_ignore_build"==e[r].page||"house_unignore_build"==e[r].page)f.m&&bn($("#house_notification"),f.m),f.q_b&&en(f.q_b);else if("house_trash_compactor_setting"==e[r].page)bn($("#house_notification"),f.m),f.s&&pn(f.item);else if("house_buy"==e[r].page)f.s&&($("#houseViewedWrapper").show(),$("#houseUnownedWrapper").hide(),Ua(f.p),nn(f),on(f.rooms),ln(f.b_r)),bn($("#house_notification"),f.m);else if("craft_item"==e[r].page)f.s?pn(f.item):$.alert(f.m,"Your Crafting Queue is Full!");else if("craft_cancel"==e[r].page)f.e||(pn(f.item),bn($("#craftingQueueNotification"),f.m));else if("craft_finalize"==e[r].page)$.alert(f.m,"Craft Finalized!"),f.e||(pn(f.item),bn($("#craftingQueueNotification"),f.m));else if("craft_queue_raise"==e[r].page)f.e||(pn(f.item),bn($("#craftingQueueNotification"),f.m));else if("craft_queue_rearrange"==e[r].page)$.alert(f.m,"Crafting Queue Rearrangement"),$("#craft_sort_confirm").hide();else if("carve_gem"==e[r].page)f.s?pn(f.item):$.alert(f.m,"Carving Error!");else if("carve_cancel"==e[r].page)f.e||(pn(f.item),bn($("#carvingQueueNotification"),f.m));else if("carve_queue_raise"==e[r].page)f.e||(pn(f.item),bn($("#carvingQueueNotification"),f.m));else if("carve_queue_rearrange"==e[r].page)$.alert(f.m,"Carving Queue Rearrangement"),$("#carve_sort_confirm").hide();else if("updates"==e[r].page)$("#updateList").html(f.html),f.is_full_list||$("#updateList").append('<div class="mt10 center"><a id="loadAllUpdates">Load All Updates</a></div>'),va({title:"Recent News"}),$("#updateWrapper").show(),$("#updateCount").val(0).hide();else if("updates_add_template"==e[r].page)ga({title:"Add an Update",content:f.html}),$("#patch_name").focus();else if("updates_add"==e[r].page)bn($("#update_add_notification"),f.m),f.s&&($("#update_creation_table tr:gt(1)").remove(),$("#patch_name").val(""),$('textarea[name="update_text[]"]').val(""));else if("account_activity"==e[r].page)if(f.u&&$("#accountActivityUsername").html(f.u),f.m)bn($("#activity_notification"),f.m);else if(f.t<1)bn($("#activity_notification"),"You don't have any logged activity of that kind."),$("#accountActivityTable,#accountActivityPagingLinks").hide();else{$("#activity_notification").empty();var he=$("#accountActivityTable");$("#accountActivityPagingLinks").show(),he.show(),he.html('<div class="row"><div class="col-md-1">&nbsp;</div><div class="col-md-2 right" style="font-size: 120%; text-shadow: 2px 2px 2px #000;">Time</div><div class="col-md-2 right" style="font-size: 120%; text-shadow: 2px 2px 2px #000; display: none;">IP</div><div class="col-md-7" style="font-size: 120%; text-shadow: 2px 2px 2px #000;">Details</div></div>');for(var fe=0,$e=(ve=f.al).length;fe<$e;fe++)he.append('<div class="row"><div class="col-md-1"><a class="removeAccountActivity" data-aid="'+ve[fe].aid+'">X</a></div><div class="col-md-2 right" title=" '+ve[fe].ds+'">'+ve[fe].ts+' ago</div><div class="col-md-2 right" style="display: none;">'+ve[fe].ip+'</div><div class="col-md-7">'+ve[fe].m+"</div></div>");$("#accountActivityPagingLinks").html(_n(f.t,f.p))}else if("clan_activity"==e[r].page)if(f.m)bn($("#viewed_clan_notification"),f.m);else{(he=$("#clanActivityTable")).html('<div class="row"><div class="col-md-2 right" style="font-size: 120%; text-shadow: 2px 2px 2px #000;">Time</div><div class="col-md-10" style="font-size: 120%; text-shadow: 2px 2px 2px #000;">Details</div></div>');var ve;for(fe=0,$e=(ve=f.al).length;fe<$e;fe++)he.append('<div class="row"><div class="col-md-2 right" title="'+ve[fe].ds+'">'+ve[fe].ts+' ago</div><div class="col-md-10">'+ve[fe].m+"</div></div>");$("#clanActivityPagingLinks").html(_n(f.t,f.p))}else if("clan_bans"==e[r].page)$("#clan_banned_members").empty(),f.list.length?$.each(f.list,function(e,t){$("#clan_banned_members").append('<tr><td><a class="profileLink">'+t+'</a></td><td><input class="clan_unban_name" type="button" value="Unban!"></td></tr>')}):$("#clan_banned_members").append('<tr><td colspan="2">Your clan hasn\'t banned anyone.</td></tr>'),$("#myClanAdminWrapper").fadeIn(500),$("#viewMyClanAdminPanel").addClass("active");else if("clan_name_change"==e[r].page)bn($("#viewed_clan_notification"),f.m),f.s&&($("#clan_name_change").empty(),$("#viewedClanName").text(f.n));else if("clan_mass_tax_change"==e[r].page||"clan_application_status"==e[r].page)bn($("#viewed_clan_notification"),f.m);else if("clan_ban"==e[r].page||"clan_unban"==e[r].page)$("#clan_banned_members").empty(),bn($("#viewed_clan_notification"),f.m),f.hasOwnProperty("users")&&f.users.length?$.each(f.users,function(e,t){$("#clan_banned_members").append('<tr><td><a class="profileLink">'+t+'</a></td><td><input class="clan_unban_name" type="button" value="Unban!"></td></tr>')}):$("#clan_banned_members").append('<tr><td colspan="2">Your clan hasn\'t banned anyone.</td></tr>');else if("clans"==e[r].page){var ge;if((f=f.result).c)$("#clanlessWrapper").hide(),$("#clannedWrapper").show(),$("#yourClanName").html(f.c.name),$("#yourClanOwner").html('<a class="profileLink">'+f.c.owner+"</a>"),$("#yourClanLevel").text(ui(f.c.level)+" ("+ui(f.c.level_percent,2)+"%)"),$("#yourClanMembers").text(ui(f.c.members)),$("#yourClanMaxMembers").text(ui(f.c.maxmembers)),$("#yourClanBuildings").text(ui(f.c.buildings)),$("#yourClanMaxBuildings").text(ui(f.c.maxbuildings)),f.c.mine?$(".disbandYourClan").show():$(".disbandYourClan").hide();else if($("#clanWrapper").show(),$("#clannedWrapper").hide(),$("#clanlessWrapper").show(),$("#clan_invites").empty(),f.ci&&f.ci.length)for(R=0;R<f.ci.length;R++)$("#clan_invites").append('<li><a class="viewClan">'+f.ci[R].name+'</a> <input type="button" class="acceptInvite" value="Accept" data-clanid="'+f.ci[R].id+'"> <input type="button" class="declineInvite" value="Decline" data-clanid="'+f.ci[R].id+'"></li>');else $("#clan_invites").append("<li>You don't have any pending clan invitations.</li>");(ge=$("#clan_list").dataTable()).fnClearTable(),f.cl.length&&ge.fnAddData(f.cl),ge.fnPageChange(0),va({title:"Clan Hall"})}else if("clan_create"==e[r].page)f.s?(_a(),yn(0,1),bn($("#clan_notification"),f.m)):bn($("#clan_create_notification"),f.m),f.p&&Ua(f.p);else if("clan_apply"==e[r].page)bn($("#viewed_clan_notification"),f.m);else if("clan_accept"==e[r].page||"clan_decline"==e[r].page)$("#clan_notification").html(f.m),f.s&&yn(0,1);else if("clan_leave"==e[r].page)f.s?(yn(0),$("#viewedClanWrapper").hide(),bn($("#clan_notification"),f.m)):bn($("#viewed_clan_notification"),f.m);else if("clan_disband"==e[r].page)f.s?(yn(0),$("#viewedClanWrapper").hide(),bn($("#clan_notification"),f.m)):bn($("#viewed_clan_notification"),f.m);else if("clan_edit_description"==e[r].page)bn($("#viewed_clan_notification"),f.m),f.s&&($("#viewedClanDescription").prop("readonly",!0),$("#cancelEditDescription,#saveEditDescription").hide(),$("#editEditDescription").show(),$("#viewedClanDescription").height(0).height($("#viewedClanDescription")[0].scrollHeight));else if("clan_view"==e[r].page)f.result.id?(t=f.result,ya(),va({title:"Clan Hall"}),$("#myClanBuildingsWrapper,#viewedClanMemberWrapper,#myClanFundsWrapper,#myClanActivityWrapper,#myClanDonationWrapper,#myClanRankWrapper,#myClanRankEditWrapper,#myClanAdminWrapper").hide(),$("#viewedClanProfileWrapper").show(),$("#viewedClanWrapper").fadeIn(500),Pn(),$("#viewMyClanInfo").addClass("active"),$("#myClanLinks").attr("data-id",t.id),t.mine?($("#myClanLinks").show(),$("#viewedClanMOTDWrapper").show(),$("#viewMyClanAdminPanel").show(),$(".applyToClan").hide(),$(".leaveYourClan").show()):($("#myClanLinks").hide(),$("#viewMyClanAdminPanel").hide(),$(".applyToClan").show(),$("#viewedClanMOTDWrapper").hide(),$(".leaveYourClan").hide()),t.edit_desc?($("#clanDescriptionEditButtons,#editEditDescription").show(),$("#cancelEditDescription,#saveEditDescription").hide()):$("#clanDescriptionEditButtons").hide(),$("#viewedClanDescription").prop("readonly",!0),$("#viewedClanMOTD").html(t.motd),t.motd&&null!=t.motd&&"null"!=t.motd||$("#viewedClanMOTDWrapper").hide(),t.owner?$(".disbandYourClan").show():$(".disbandYourClan").hide(),$("#viewedClanName").text(t.name),$("#viewedClanLevel").text(t.level),$("#viewedClanLevelPercent").text(ui(t.level_percent,2)),$("#viewedClanCurrentExperience").text(fn(t.experience,1e6)),$("#viewedClanLevelCost").text(fn(t.level_cost,1e6)),$("#viewedClanMemberCount").text(ui(t.members)),$("#viewedClanMaxMembers").text(ui(t.maxmembers)),$("#viewedClanBuildingCount").text(ui(t.buildings)),$("#viewedClanMaxBuildings").text(ui(t.maxbuildings)),$("#viewedClanExperienceTax").text(ui(t.exptax)),$("#viewedClanGoldTax").text(ui(t.goldtax)),$("#viewedClanResourceTax").text(ui(t.restax)),$("#viewedClanDropTax").text(ui(t.droptax)),$("#viewedClanDescription").val(t.description),$("#viewedClanDescription").height(0).height($("#viewedClanDescription")[0].scrollHeight),$(".applyToClan").attr("data-id",t.id)):$.alert("Whoops!  That clan doesn't seem to exist...");else if("clan_members_manage"==e[r].page)bn($("#viewed_clan_notification"),f.m),f.s&&Wn($("#myClanLinks").attr("data-id"));else if("clan_members"==e[r].page){$("#clanMemberList,#viewed_clan_notification").empty();var _e="";if(f.m&&bn($("#viewed_clan_notification"),f.m),f.can_invite?$("#clan_member_invite_wrapper").show():$("#clan_member_invite_wrapper").hide(),f.ranks&&$.each(f.ranks,function(e,t){if(0==t.rankid)return!0;_e+='<option value="'+t.rankid+'">'+t.name+"</option>"}),f.members){$("#clanMemberList").append('<thead><tr class="hidden-xs hidden-sm"><th class="header">Member</th>'+(f.mine?'<th class="header">Last Active</th>':"")+'<th class="header">Rank</th><th class="header">Level</th><th class="header">Fishing</th><th class="header">Woodcutting</th><th class="header">Mining</th><th class="header">Stonecutting</th><th class="header">Crafting</th><th class="header">Carving</th><th  class="header" colspan="4">&nbsp;</th></thead><tbody>');var ye=parseInt(f.my_rank);$.each(f.members,function(e,t){$("#clanMemberList").append('<tr><td><a class="profileLink'+(1==t.banned?" banned":"")+'">'+t.username+"</a></td>"+(f.mine?'<td class="clan_member_last_active" data-sort="'+t.active_time+'">'+(t.active?t.active+("Now"==t.active?"":" ago"):"&nbsp;")+"</td>":"")+'<td class="clan_member_rank">'+t.rankname+'</td><td class="clan_member_level right" style="color:#01b0aa;">'+t.level+'</td><td class="clan_member_fishing right food">'+t.fishing+'</td><td class="clan_member_woodcutting right wood">'+t.woodcutting+'</td><td class="clan_member_mining right iron">'+t.mining+'</td><td class="clan_member_stonecutting right stone">'+t.stonecutting+'</td><td class="clan_member_crafting right crafting_materials">'+t.crafting+'</td><td class="clan_member_carving right gem_fragments">'+t.carving+"</td>"+((f.can_promote_or_demote||f.can_kick||f.owner)&&parseInt(t.rankid)>=ye&&!f.owner?'<td colspan="2">You can\'t manage this member because they are of equal or greater rank than you.</td>':(f.can_promote_or_demote||f.owner?0==t.rankid?"<td>Invitation Pending</td>":-1==t.rankid?'<td><label for="accept-application-'+t.userid+'"><input id="accept-application-'+t.userid+'" type="radio" value="acceptapp" name="manage['+t.userid+'][action]"> Accept application</label></td>':'<td><label for="change-rank-'+t.userid+'"><input id="change-rank-'+t.userid+'" type="radio" value="changerank" name="manage['+t.userid+'][action]"> Change rank to <select name="manage['+t.userid+'][rank]">'+_e+"</select></label></td>":"")+(f.can_kick||f.owner?0==t.rankid?'<td><label for="revoke-invitation-'+t.userid+'"><input id="revoke-invitation-'+t.userid+'" type="radio" value="kick" name="manage['+t.userid+'][action]"> Revoke Invitation</label></td>':'<td><label for="clan-kick-'+t.userid+'"><input id="clan-kick-'+t.userid+'" type="radio" value="kick" name="manage['+t.userid+'][action]"> Kick</label></td>':"")+(f.owner?t.rankid<1?"<td>&nbsp;</td>":'<td><label for="transfer-leadership-'+t.userid+'"><input id="transfer-leadership-'+t.userid+'" type="radio" value="transferleadership" name="manage['+t.userid+'][action]"> Transfer leadership</label></td>':""))+"</tr>")}),"levels"==$("#clan_members_level_manage_toggle").attr("data-type")?($("#clanMemberList #clanMemberList tr>th:nth-child(4),#clanMemberList tr>th:nth-child(5),#clanMemberList tr>th:nth-child(6),#clanMemberList tr>th:nth-child(7),#clanMemberList tr>th:nth-child(8),#clanMemberList tr>th:nth-child(9),#clanMemberList tr>th:nth-child(10),#clanMemberList tr>td:nth-child(4),#clanMemberList tr>td:nth-child(5),#clanMemberList tr>td:nth-child(6),#clanMemberList tr>td:nth-child(7),#clanMemberList tr>td:nth-child(8),#clanMemberList tr>td:nth-child(9),#clanMemberList tr>td:nth-child(10)").show(),$("#clanMemberList tr>th:nth-child(11),#clanMemberList tr>th:nth-child(12),#clanMemberList tr>th:nth-child(13),#clanMemberList tr>td:nth-child(11),#clanMemberList tr>td:nth-child(12),#clanMemberList tr>td:nth-child(13)").hide()):($("#clanMemberList #clanMemberList tr>th:nth-child(4),#clanMemberList tr>th:nth-child(5),#clanMemberList tr>th:nth-child(6),#clanMemberList tr>th:nth-child(7),#clanMemberList tr>th:nth-child(8),#clanMemberList tr>th:nth-child(9),#clanMemberList tr>th:nth-child(10),#clanMemberList tr>td:nth-child(4),#clanMemberList tr>td:nth-child(5),#clanMemberList tr>td:nth-child(6),#clanMemberList tr>td:nth-child(7),#clanMemberList tr>td:nth-child(8),#clanMemberList tr>td:nth-child(9),#clanMemberList tr>td:nth-child(10)").hide(),$("#clanMemberList tr>th:nth-child(11),#clanMemberList tr>th:nth-child(12),#clanMemberList tr>th:nth-child(13),#clanMemberList tr>td:nth-child(11),#clanMemberList tr>td:nth-child(12),#clanMemberList tr>td:nth-child(13)").show()),$("#clanMemberList").append('</tbody><tfoot><tr style="background: none;"><td colspan="6"><input id="confirmClanMemberChanges" type="button" value="Confirm Changes" /></td></tr></tfoot>'),$("#clanMemberList").tablesorter({sortInitialOrder:"desc",textExtraction:function(e){return $(e).attr("data-sort")?$(e).attr("data-sort"):e.title?e.title.replace(/,/g,""):e.textContent}}),(f.can_promote_or_demote||f.can_kick||f.owner)&&f.mine&&"levels"!=$("#clan_members_level_manage_toggle").attr("data-type")?$("#confirmClanMemberChanges").show():$("#confirmClanMemberChanges").hide()}$("#viewedClanMemberWrapper").fadeIn(500)}else if("clan_treasury"==e[r].page){if(f.m)bn($("#viewed_clan_notification"),f.m);else(f=f.result).m&&bn($("#viewed_clan_notification"),f.m),$("#myClanFundsWrapper").fadeIn(1e3),$("#myClanCurrentCrystals").text(ui(f.crystals)).attr("realvalue",f.crystals).removeClass("clanFundModified"),$("#myClanCurrentPlatinum").text(ui(f.platinum)).attr("realvalue",f.platinum).removeClass("clanFundModified"),$("#myClanCurrentGold").text(ui(f.gold)).attr("realvalue",f.gold).removeClass("clanFundModified"),$("#myClanCurrentFood").text(ui(f.food)).attr("realvalue",f.food).removeClass("clanFundModified"),$("#myClanCurrentWood").text(ui(f.wood)).attr("realvalue",f.wood).removeClass("clanFundModified"),$("#myClanCurrentIron").text(ui(f.iron)).attr("realvalue",f.iron).removeClass("clanFundModified"),$("#myClanCurrentStone").text(ui(f.stone)).attr("realvalue",f.stone).removeClass("clanFundModified"),$("#myPersonalCurrentCrystals").text(ui(f.pcrystals)).attr("realvalue",f.pcrystals).removeClass("clanFundModified"),$("#myPersonalCurrentPlatinum").text(ui(f.pplatinum)).attr("realvalue",f.pplatinum).removeClass("clanFundModified"),$("#myPersonalCurrentGold").text(ui(f.pgold)).attr("realvalue",f.pgold).removeClass("clanFundModified"),$("#myPersonalCurrentFood").text(ui(f.pfood)).attr("realvalue",f.pfood).removeClass("clanFundModified"),$("#myPersonalCurrentWood").text(ui(f.pwood)).attr("realvalue",f.pwood).removeClass("clanFundModified"),$("#myPersonalCurrentIron").text(ui(f.piron)).attr("realvalue",f.piron).removeClass("clanFundModified"),$("#myPersonalCurrentStone").text(ui(f.pstone)).attr("realvalue",f.pstone).removeClass("clanFundModified"),f.next_costs?($.each(f.next_costs,function(e,t){$("#nextBuildingCost"+e).text(ui(t.cost))}),$("#nextBuildingName").text(f.next_name),$("#myClanNextBuildingCosts").show(),$("#myClanFunds").removeClass("col-md-12").addClass("col-md-8"),$(".clanFundHolder").removeClass("col-md-4").addClass("col-md-6")):($("#myClanNextBuildingCosts").hide(),$("#myClanFunds").removeClass("col-md-8").addClass("col-md-12"),$(".clanFundHolder").removeClass("col-md-6").addClass("col-md-4"))}else if("clan_armory"==e[r].page)f.s?($("#myClanArmoryWrapper").fadeIn(1e3),ca(f,f.can_borrow,f.can_take,f.can_revoke)):$.alert(f.m);else if("clan_buildings"==e[r].page)f.m?bn($("#viewed_clan_notification"),f.m):($.each(f.buildings,function(e,t){$("#clanBuilding"+t.id+"Level").text(t.level),t.marked?$('.clanBuildingMarkButton[data-id="'+t.id+'"]').val("Unmark as Next"):$('.clanBuildingMarkButton[data-id="'+t.id+'"]').val("Mark as Next"),$.each(t.costs,function(e,a){$("#clanBuilding"+t.id+e+"Cost").text(ui(a.cost)),$("#clanBuilding"+t.id+e+"Cost").attr("title","Your clan has "+ui(a.have)),a.can_afford?$("#clanBuilding"+t.id+e+"Cost").removeClass("failure"):$("#clanBuilding"+t.id+e+"Cost").addClass("failure")})}),$("#clanBuildingsRemaining").text(ui(f.remaining)),f.can_upgrade?$(".upgradeClanBuildingButton,.downgradeClanBuildingButton,.clanBuildingMarkButton").show():$(".upgradeClanBuildingButton,.downgradeClanBuildingButton,.clanBuildingMarkButton").hide());else if("clan_building_mark"==e[r].page){if(f.m&&bn($("#viewed_clan_notification"),f.m),f.id){$('.clanBuildingMarkButton[data-id!="'+f.id+'"]').val("Mark as Next");var be=$('.clanBuildingMarkButton[data-id="'+f.id+'"]');"Mark as Next"==be.val()?be.val("Unmark as Next"):be.val("Mark as Next")}}else if("clan_building_upgrade"==e[r].page||"clan_building_downgrade"==e[r].page)f.m&&bn($("#viewed_clan_notification"),f.m),f.s&&Mn();else if("clan_donate"==e[r].page)bn($("#viewed_clan_notification"),f.m),f.p&&(xn(),Ua(f.p)),f.result.crystals&&$("#myClanCurrentCrystals").text(ui(f.result.crystals)).attr("realvalue",f.result.crystals).removeClass("clanFundModified"),f.result.platinum&&$("#myClanCurrentPlatinum").text(ui(f.result.platinum)).attr("realvalue",f.result.platinum).removeClass("clanFundModified"),f.result.gold&&$("#myClanCurrentGold").text(ui(f.result.gold)).attr("realvalue",f.result.gold).removeClass("clanFundModified"),f.result.food&&$("#myClanCurrentFood").text(ui(f.result.food)).attr("realvalue",f.result.food).removeClass("clanFundModified"),f.result.wood&&$("#myClanCurrentWood").text(ui(f.result.wood)).attr("realvalue",f.result.wood).removeClass("clanFundModified"),f.result.iron&&$("#myClanCurrentIron").text(ui(f.result.iron)).attr("realvalue",f.result.iron).removeClass("clanFundModified"),f.result.stone&&$("#myClanCurrentStone").text(ui(f.result.stone)).attr("realvalue",f.result.stone).removeClass("clanFundModified"),f.result.pcrystals&&$("#myPersonalCurrentCrystals").text(ui(f.result.pcrystals)).attr("realvalue",f.result.pcrystals).removeClass("clanFundModified"),f.result.pplatinum&&$("#myPersonalCurrentPlatinum").text(ui(f.result.pplatinum)).attr("realvalue",f.result.pplatinum).removeClass("clanFundModified"),f.result.pgold&&$("#myPersonalCurrentGold").text(ui(f.result.pgold)).attr("realvalue",f.result.pgold).removeClass("clanFundModified"),f.result.pfood&&$("#myPersonalCurrentFood").text(ui(f.result.pfood)).attr("realvalue",f.result.pfood).removeClass("clanFundModified"),f.result.pwood&&$("#myPersonalCurrentWood").text(ui(f.result.pwood)).attr("realvalue",f.result.pwood).removeClass("clanFundModified"),f.result.piron&&$("#myPersonalCurrentIron").text(ui(f.result.piron)).attr("realvalue",f.result.piron).removeClass("clanFundModified"),f.result.pstone&&$("#myPersonalCurrentStone").text(ui(f.result.pstone)).attr("realvalue",f.result.pstone).removeClass("clanFundModified");else if("clan_invite"==e[r].page)bn($("#viewed_clan_notification"),f.m),f.s&&Wn($("#myClanLinks").attr("data-id"));else if("clan_ranks"==e[r].page)$("#clanRankList").empty(),f.m?bn($("#viewed_clan_notification"),f.m):($.each(f.ranks,function(e,t){$("#clanRankList").append("<li>"+t.name+(f.can_edit?' (<a class="editRank" data-id="'+t.rankid+'">edit</a>)':"")+"<ul><li>Members: "+(t.members?'<a class="profileLink">'+t.members.map(function(e){return e.username}).join('</a>, <a class="profileLink">')+"</a>":"None")+"<li>Taxes: "+t.exptax+"% Experience, "+t.goldtax+"% Gold, "+t.restax+"% Resources, "+t.droptax+"% Drops</li><li>Permissions: "+t.permission_string+"</li></ul></li>")}),f.can_edit?$("#myClanCreateRank").show():$("#myClanCreateRank").hide(),$(".editRank").one("click",function(e){e.preventDefault(),Dn(),In($(this).attr("data-id"))}));else if("clan_rank_add"==e[r].page)bn($("#viewed_clan_notification"),f.m),f.s&&In(f.rid);else if("clan_rank_edit"==e[r].page)f.m?bn($("#viewed_clan_notification"),f.m):($("#myClanRankEditTable tr").eq(-2).show(),$("#myClanRankName").val(f.my_rank.name),$("#myClanRankID").val(f.my_rank.id).attr("real-id",f.my_rank.id),$("#myClanRankExperienceTax").val(f.my_rank.exptax),$("#myClanRankGoldTax").val(f.my_rank.goldtax),$("#myClanRankResourceTax").val(f.my_rank.restax),$("#myClanRankDropTax").val(f.my_rank.droptax),$.each(f.my_rank.permissions,function(e,t){$('#myClanRankEditTable input[name="'+e+'"]').prop("checked",t)}),$("#myClanRankDeleteOptions").show().empty(),$.each(f.ranks,function(e,t){$("#myClanRankDeleteOptions").append('<option value="'+t.rankid+'">'+t.name+"</option>")})),$("#myClanRankSaveChanges").off("click").on("click",function(e){e.preventDefault(),Sn($("#myClanRankID").attr("real-id"))});else if("clan_rank_change"==e[r].page)bn($("#viewed_clan_notification"),f.m),$('#myClanRankEditTable input[name="deleterank"]').prop("checked",!1),f.s&&!f.deletedrank&&In(f.rid?f.rid:id);else if("clan_donations"==e[r].page)$("#myClanDonationWrapper").fadeIn(500),$("#myClanDonationTable>tbody").empty(),$.each(f.results,function(e,t){$("#myClanDonationTable>tbody").append('<tr><td><a class="profileLink">'+e+'</a></td><td class="hidden-xs hidden-sm" title="'+t.joinedts+'">'+(t.joined?t.joined+" ago":"Not a Member")+'</td><td class="crystals donator_list_crystals" title="'+ui(t.crystals,0,1)+'">'+fn(t.crystals)+'</td><td class="platinum donator_list_platinum" title="'+ui(t.platinum,0,1)+'">'+fn(t.platinum)+'</td><td class="gold donator_list_gold" title="'+ui(t.gold,0,1)+'">'+fn(t.gold)+'</td><td class="food donator_list_food" title="'+ui(t.food,0,1)+'">'+fn(t.food)+'</td><td class="wooden donator_list_wood" title="'+ui(t.wood,0,1)+'">'+fn(t.wood)+'</td><td class="iron donator_list_iron" title="'+ui(t.iron,0,1)+'">'+fn(t.iron)+'</td><td class="stone donator_list_stone" title="'+ui(t.stone,0,1)+'">'+fn(t.stone)+'</td><td class="donator_list_experience" title="'+ui(t.experiences,0,1)+'">'+fn(t.experiences)+"</td></tr>")}),$("#myClanDonationTable").trigger("update");else if("market"==e[r].page){var ke,we=f.requested,Ce=we.market_type,xe=we.q,Te=we.ll,We=we.hl,Le=we.st,De=we.effect,Re=we.effectvalue,Me=Number(we.page_num),Ie=f.result.page,Se=f.item_popup,Ae=f.gem_popup,Be=f.ingredient_popup,Pe=f.gemmed;f=f.result;if(Se){var Ne='<table class="marketListings sorted_table">';if(f.l&&f.l.length){Ne+='<thead><tr class="hidden-xs hidden-sm"><th>Item</th><th>'+f.doa+"</th><th>Level</th><th>Price</th><th>Seller</th></thead>";for(fe=0;fe<f.l.length;fe++)Ne+='<tr id="market-listing-'+f.l[fe].tid+'"><td data-th="Item">'+Ct(f.l[fe].i)+'</td><td data-th="'+f.doa+'">'+f.l[fe].i.p+'</td><td data-th="Level Req">'+f.l[fe].i.l+'</td><td data-th="Price">'+ui(f.l[fe].price)+'</td><td data-th="Seller"><a class="profileLink">'+f.l[fe].seller+"</a></td></td></tr>"}else Ne+="<tr><th>No "+f.cn+" like that have been posted to the market!</th></tr>";return void ga({title:"Sell Item on the Market",content:'<h3 class="full center nobg">'+y+'</h3><div style="margin-top: 20px;" class="center">Post to the Market for <input type="text" id="marketPrice" size="6"></input> Gold <input type="button" id="marketItemSell" value="Sell"></input></div>'+(Ne+="</table>")})}if(Ae){Ne='<table class="marketListings sorted_table">';if(f.l&&f.l.length){Ne+='<thead><tr class="hidden-xs hidden-sm"><th class="header">Gem</th><th class="header">Level</th><th class="header">Price</th><th class="header">Seller</th></thead>';for(fe=0;fe<f.l.length;fe++)Ne+='<tr id="market-listing-'+f.l[fe].tid+'"><td data-th="Gem">'+xt(f.l[fe].g)+'</td><td data-th="Level Req">'+f.l[fe].g.l+'</td><td data-th="Price">'+ui(f.l[fe].price)+'</td><td data-th="Seller"><a class="profileLink">'+f.l[fe].seller+"</a></td></tr>"}else Ne+="<tr><th>No "+f.cn+" like that have been posted to the market!</th></tr>";return void ga({title:"Sell Gem on the Market",content:'<h3 class="full center nobg">'+y+'</h3><div style="margin-top: 20px;" class="center">Post to the Market for <input type="text" id="marketPrice" size="6"></input> Gold <input type="button" id="marketGemSell" value="Sell"></input></div>'+(Ne+="</table>")})}if(Be){Ne='<table class="marketListings sorted_table">';if(f.l&&f.l.length){Ne+='<thead><tr class="hidden-xs hidden-sm"><th class="header">'+f.cn+'</th><th class="header">Price Per Unit</th><th class="header">Total Price</th><th class="header">Seller</th></tr></thead>';for(fe=0;fe<f.l.length;fe++)Ne+='<tr id="market-listing-'+f.l[fe].tid+'"><td data-th="'+f.cn+'">'+ui(f.l[fe].v)+(f.l[fe].n?" "+f.l[fe].n:"")+'</td><td data-th="Price Per Unit">'+ui(f.l[fe].price)+'</td><td data-th="Total Price">'+ui(f.l[fe].price*f.l[fe].v)+'</td><td data-th="Seller"><a class="profileLink">'+f.l[fe].seller+"</a></td></tr>";Ne+="</table>"}else Ne+="<tr><th>No "+f.cn+" have been posted to the market!</th></tr></table>";ga({title:"Sell Ingredients on the Market",content:'<h3 id="ingredientMarketName" class="full center nobg">'+y+'</h3><div class="center">You have '+ui(k)+' available.</div><div style="margin-top: 20px;" class="center">Put <input id="marketIngredientAmount" type="text" size="6"> on the Market for <input type="text" id="marketPrice" size="6"></input> Gold each <input type="button" id="marketIngredientSell" value="Sell"></input></div>'+Ne})}if($(".marketListings>thead").empty(),"mine"==Ce)if($("#marketPostListingWrapper").hide(),$("#marketListingFilterWrapper").hide(),$("#marketQuickBuy").hide(),$("#marketMyListings").show(),f.t>0){$(".marketListings>thead").html('<tr class="hidden-xs hidden-sm"><th class="header">Listing</th><th class="header">Price Per Unit</th><th>Remove</th></tr>');for(fe=0;fe<f.l.length;fe++)ke+='<tr id="market-listing-'+f.l[fe].tid+'"><td data-th="Listing">',f.l[fe].i?ke+=Ct(f.l[fe].i):f.l[fe].g?ke+=xt(f.l[fe].g):ke+=ui(f.l[fe].v)+" "+f.l[fe].n,ke+='</td><td data-th="Price Per Unit">'+ui(f.l[fe].price)+'</td><td ><input type="button" class="removeListing" value="Remove"></tr>'}else ke+='<tr><td class="center nomatch">You don\'t currently have anything posted on the market.</td></tr>';else if(f.i)if($("#marketIngredientFilterWrapper,#marketGemFilterWrapper,#marketQuickBuy").hide(),$("#marketItemFilterWrapper").show(),"armor"==f.stn?$("#marketItemFilter").html('<option data-type="armor">All</option><option data-type="breastplate">Breastplates</option><option data-type="helmet">Helmets</option><option data-type="gloves">Gloves</option><option data-type="boots">Boots</option><option data-type="shield">Shields</option><option data-type="quiver">Quivers</option>'):$("#marketItemFilter").html('<option data-type="weapon">All</option><option data-type="sword">Swords</option><option data-type="bow">Bows</option><option data-type="staff">Staves</option>'),$('#marketItemFilter option[data-type="'+f.cn+'"]').prop("selected",!0),$("#marketListingFilterWrapper").show(),$("#marketPostListingWrapper,#marketMyListings").hide(),f.r){$(".marketListings>thead").html('<tr class="hidden-xs hidden-sm"><th>Item</th><th>'+f.doa+"</th><th>Level</th><th>Price</th><th>Seller</th><th>Purchase</th></tr>");for(fe=0;fe<f.l.length;fe++)ke+='<tr id="market-listing-'+f.l[fe].tid+'"><td data-th="Item">'+Ct(f.l[fe].i)+'</td><td data-th="'+f.doa+'">'+f.l[fe].i.p+'</td><td data-th="Level Req">'+f.l[fe].i.l+'</td><td data-th="Price">'+ui(f.l[fe].price)+'</td><td data-th="Seller"><a class="profileLink">'+f.l[fe].seller+"</a></td><td>"+(f.l[fe].owner?'<input type="button" class="removeListing" value="Remove">':'<input type="button" class="buyMarketListing" value="Buy">')+"</td></tr>"}else ke+='<tr><td class="center nomatch">No matching '+f.cn+" listings have been posted.</td></tr>";else if(f.g)if($("#marketListingFilterWrapper").show(),$("#marketGemFilter").html(f.filter),$("#marketItemFilterWrapper,#marketIngredientFilterWrapper,#marketQuickBuy").hide(),$("#marketGemFilterWrapper").show(),$("#marketPostListingWrapper,#marketMyListings").hide(),$('#marketGemFilter option[value="'+Le+'"]').prop("selected",!0),f.r){$(".marketListings>thead").html('<tr class="hidden-xs hidden-sm"><th class="header">Gem</th><th class="header">Level</th><th class="header">Price</th><th class="header">Seller</th><th>Purchase</th></tr>');for(fe=0;fe<f.l.length;fe++)ke+='<tr id="market-listing-'+f.l[fe].tid+'"><td data-th="Item">'+xt(f.l[fe].g)+'</td><td data-th="Level Req">'+f.l[fe].g.l+'</td><td data-th="Price">'+ui(f.l[fe].price)+'</td><td data-th="Seller"><a class="profileLink">'+f.l[fe].seller+"</a></td><td>"+(f.l[fe].owner?'<input type="button" class="removeListing" value="Remove">':'<input type="button" class="buyMarketListing" value="Buy">')+"</td></tr>"}else ke+='<tr><td class="center nomatch">No matching '+f.cn+" listings have been posted.</td></tr>";else if($("#marketListingFilterWrapper,#marketMyListings").hide(),$("#marketQuickBuy").show(),$("#quickBuyType").text(f.cn).attr("data-st",Le).attr("data-type",Ce),$("#currentCurrency").html(ui(f.ca)),$("#currencyName").html(f.cn),f.ing?($("#marketListingFilterWrapper").show(),$("#marketIngredientFilter").html(f.filter),$("#marketItemFilterWrapper,#marketGemFilterWrapper").hide(),$("#marketIngredientFilterWrapper").show(),$("#marketPostListingWrapper").hide(),$('#marketIngredientFilter option[value="'+Le+'"]').prop("selected",!0)):$("#marketPostListingWrapper").show(),f.r){$(".marketListings>thead").html('<tr class="hidden-xs hidden-sm"><th class="header">'+f.cn+'</th><th class="header">Price Per Unit</th><th class="header">Total Price</th><th class="header">Seller</th><th>Purchase</th></tr>');for(fe=0;fe<f.l.length;fe++)ke+='<tr id="market-listing-'+f.l[fe].tid+'"><td data-th="'+f.cn+'">'+ui(f.l[fe].v)+(f.ing&&f.l[fe].n?" "+f.l[fe].n:"")+'</td><td data-th="Price Per Unit">'+ui(f.l[fe].price)+'</td><td data-th="Total Price">'+ui(f.l[fe].price*f.l[fe].v)+'</td><td data-th="Seller"><a class="profileLink">'+f.l[fe].seller+"</a></td><td>"+(f.l[fe].owner?'<input type="button" class="removeListing" value="Remove">':'<input type="button" class="buyMarketListing" value="Buy">')+"</td></tr>"}else ke+='<tr><td class="center nomatch">No matching listings have been posted.</td></tr>';if($(".marketListings>tbody").html(ke),$(".marketListings").trigger("update"),$("#marketPagingLinks").html(_n(f.t,Ie)),$(".pageLink").attr("data-t",Ce).attr("data-s",parseInt(Ie)+1).attr("data-q",xe).attr("data-ll",Te).attr("data-hl",We).attr("data-st",Le).attr("data-effect",De).attr("data-ev",Re).attr("data-gemmed",Pe),$(".page_next a").attr("data-t",Ce).attr("data-s",parseInt(Ie)+1).attr("data-q",xe).attr("data-ll",Te).attr("data-hl",We).attr("data-st",Le).attr("data-effect",De).attr("data-ev",Re).attr("data-gemmed",Pe),$(".page_prev a").attr("data-t",Ce).attr("data-s",parseInt(Ie)-1).attr("data-q",xe).attr("data-ll",Te).attr("data-hl",We).attr("data-st",Le).attr("data-effect",De).attr("data-ev",Re).attr("data-gemmed",Pe),$(".page_first a,.page_last a").attr("data-t",Ce).attr("data-q",xe).attr("data-ll",Te).attr("data-hl",We).attr("data-st",Le).attr("data-effect",De).attr("data-ev",Re).attr("data-gemmed",Pe),"ingredient"==f.type||"gem"==f.type)$("#marketTypeSelector *[data-type="+Ce+"]").addClass("active");else if("item"==f.type){var qe=f.stn;$('#marketTypeSelector *[data-type="item"][data-subtype='+("weapons"==qe?"weapon":"armor")+"]").addClass("active")}else $("#marketTypeSelector *[data-subtype="+Le+"][data-type="+Ce+"]").addClass("active");0==f.ur&&$("#market_notification").html("You must be registered to use the market.").show(),$(".marketListings").tablesorter({textExtraction:function(e){return e.textContent.replace(/,/g,"")}})}else if("market_buy"==e[r].page)bn($("#market_notification"),f.result),f.s&&Ua(f.p),D.is(":visible")&&_a(),vn();else if("market_quick_buy"==e[r].page)bn($("#market_notification"),f.m),f.s&&(Ua(f.p),vn());else if("market_remove"==e[r].page)bn($("#market_notification"),f.r),Ua(f.p),f.s&&$("#market-listing-"+f.listingId).remove();else if("market_currency"==e[r].page)bn($("#market_notification"),f.result),f.s&&(Ua(f.p),vn());else if("market_item"==e[r].page)Lt(f.result),_a(),$("#inventoryTypes .active").click();else if("market_gem"==e[r].page)Lt(f.result),_a(),$("#inventoryTypes .active").click();else if("market_ingredient"==e[r].page)Lt(f.result),_a(),$("#inventoryTypes .active").click();else if("consumable_consume"==e[r].page)Lt(f.m),$("#inventoryTypes .active").click(),f.p&&Ua(f.p),D.is(":visible")&&_a();else if("rankings_view"==e[r].page||"rankings_view_clan"==e[r].page){var Fe;if("rankings_view_clan"==e[r].page?$("#modalTitle").text("Clan Rankings"):$("#modalTitle").text("Rankings"),f.m)bn($("#ranking_notification"),f.m);else(f=f.result).ranks.length?($("#ranking_notification").text("Ranks will update again in "+f.next+"."),f.isHouse?Fe="House":"user"==f.ranktype?Fe="Title":"clan"==f.ranktype&&(Fe="Clan"),$("#rankingTable").empty(),$("#rankingTable").removeClass("highrank").removeClass("lowrank").addClass(f.bt),$("#rankingTable").append('<tr class="hidden-xs hidden-sm"><th>Rank</th><th>'+("user"==f.ranktype?"Adventurer":"Clan")+"</th>"+("user"==f.ranktype?"<th>"+Fe+"</th>":"")+"<th>"+f.stat+"</th>"),$.each(f.ranks,function(e,t){$("#rankingTable").append("<tr"+(t.me?' class="my_rank"':"")+'><td data-th="Rank">'+t.r+'</td><td data-th="'+("user"==f.ranktype?"Adventurer":"Clan")+'">'+("user"==f.ranktype?'<a class="profileLink">'+t.u+"</a>":'<a class="viewClan">'+t.c+"</a>")+"</td>"+("user"==f.ranktype?'<td data-th="'+Fe+'">'+t.t+"</td>":"")+'<td data-th="'+f.stat+'">'+(isNaN(t.v)?t.v:t.v%1!=0?ui(t.v,2):ui(t.v))+"</td></tr>")}),$("#rankingPagingLinks").html(_n(f.total,f.page,"rank")),$("#rankingPagingLinks").show(),$("#rankingPagingLinks a.pageLink").off("click").on("click",function(e){e.preventDefault(),Qn(f.rank_type,$(this).attr("data-page"))}),$("#rankingPagingLinks li.page_next a").off("click").on("click",function(e){e.preventDefault(),Qn(f.rank_type,parseInt(f.page)+1)}),$("#rankingPagingLinks li.page_prev a").off("click").on("click",function(e){e.preventDefault(),Qn(f.rank_type,parseInt(f.page)-1)}),$("#rankingPagingLinks li.page_first a,#rankingPagingLinks li.page_last a").off("click").on("click",function(e){e.preventDefault(),Qn(f.rank_type,parseInt($(this).attr("data-page")))})):(bn($("#ranking_notification"),"The rankings for this category were empty.  This may have happened because the ranks were being updated at the time of your request."),$("#rankingPagingLinks").hide())}else if("fame_shop"==e[r].page)f.m&&$("#milestone_notification").html(f.m),f.s&&($("#fameShopPurchaseTable").html('<tr class="hidden-xs hidden-sm"><th>Reward</th><th>Cost</th></tr>'),$.each(f.list,function(e,t){$("#fameShopPurchaseTable").append('<tr><td data-th="Reward">'+t.n+'</td><td data-th="Cost"><a data-type="'+t.t+'">Purchase for '+ui(t.c)+" Fame Points</a></td></tr>")}));else if("fame_shop_purchase"==e[r].page)$("#milestone_notification").html(f.m),f.s&&(Ua(f.p),$("#fameShopPurchaseTable").html('<tr class="hidden-xs hidden-sm"><th>Reward</th><th>Cost</th></tr>'),$.each(f.list,function(e,t){$("#fameShopPurchaseTable").append('<tr><td data-th="Reward">'+t.n+'</td><td data-th="Cost"><a data-type="'+t.t+'">Purchase for '+ui(t.c)+" Fame Points</a></td></tr>")})),$("#fameShopPurchaseTable a").removeClass("disabled");else if("event_shop"==e[r].page)$(".eventShopWrapper").html(f.html);else if("event_shop_purchase"==e[r].page)$(".event_shop_notification").html(f.m),f.p&&Ua(f.p),$(".eventShopPurchaseTable a").removeClass("disabled");else if("item_transfer"==e[r].page)f.s>0?(_a(),Lt(f.m),da($(".inventoryLoad.active").attr("data-itemtype"))):bn($("#item_options_notification"),f.m);else if("gem_transfer"==e[r].page)f.s>0?(_a(),Lt(f.m),ra()):bn($("#gem_options_notification"),f.m);else if("item_rename"==e[r].page||"item_own"==e[r].page||"gem_own"==e[r].page||"gem_socket_to_item"==e[r].page||"gem_unsocket_from_item"==e[r].page)f.p&&Ua(f.p),f.s>0?(D.html(f.html),da($(".inventoryLoad.active").attr("data-itemtype"))):bn($("#item_options_notification,#gem_options_notification"),f.m);else if("username_change"==e[r].page)bn($("#premium_shop_notification"),f.m),$("#username").text(f.u),Ua(f.p),f.s&&$("#username_change").empty();else if("gender_change"==e[r].page)bn($("#premium_shop_notification"),f.m),Ua(f.p);else if("profile_edit"==e[r].page)bn($("#viewed_profile_notification"),f.m),f.s&&($("#profile_description").prop("readonly",!0),$("#profile_edit_cancel,#profile_edit_save").hide(),$("#profile_edit_edit").show(),$("#profile_description").height(0).height($("#profile_description")[0].scrollHeight),$("#profile_description").val().split("\n").length>5&&$("#profile_description").height("inherit").attr("rows",5));else if("game_stats"==e[r].page)va({title:"Game Stats"}),$("#game_stats_notification").text("Game stats will update again in "+f.info.next+"."),$("#gameStatsWrapper").show(),$.each(f.info,function(e,t){$("#gameStats"+e).text(ui(t))});else if("verification_resend"==e[r].page)f.s?$("#general_notification").text(f.m):$.alert(f.m);else if("event_participants"==e[r].page)va({title:"Event Realm"}),$("#bossModalWrapper").show(),$(".eventShopWrapper").hide(),f.pl&&Ra(f);else if("mod_bans"==e[r].page){var Ee=$("#banList").dataTable();Ee.fnClearTable(),f.result.length&&Ee.fnAddData(f.result)}else if("mod_duplicate_ips"==e[r].page){var Oe=$("#multiList").dataTable();Oe.fnClearTable(),f.result.length&&Oe.fnAddData(f.result)}else if("mod_post_note"==e[r].page)f.s?Ka("username",$(".mod_post_note").attr("data-value")):bn($("#mod_tool_notification"),f.m);else if("mod_lookup"==e[r].page)$(".mod_tool_section").hide(),$(".mod_tool_section[data-type=lookup]").show(),$(".mod_lookup_section,#mod_add_note_textarea").hide(),$("#mod_lookup_"+f.result.search_type).show(),"ip"==f.result.search_type?f.result.error?($("#mod_lookup_no_ip").show(),$("#mod_lookup_ip_exists").hide()):($("#mod_lookup_no_ip").hide(),$("#mod_lookup_ip_exists").show(),$("#mod_lookup_ip_value").text(f.result.ip),$("#mod_lookup_ip_info").empty(),f.result.users.length?$.each(f.result.users,function(e,t){$("#mod_lookup_ip_info").append('<div><a class="lookup" data-type="username" data-value="'+t.username+'">'+t.username+"</a> ("+t.last_used+" ago)</div>")}):$("#mod_lookup_ip_info").text("No users were found on this IP.")):"username"==f.result.search_type&&(f.result.error?($("#mod_lookup_no_user").show(),$("#mod_lookup_user_exists").hide()):($("#mod_lookup_no_user").hide(),$("#mod_lookup_user_exists").show(),$("#mod_lookup_user").html('<a class="profileLink">'+f.result.user_info.username+"</a>"),$("#mod_lookup_activity_view").attr("data-value",f.result.user_info.username),$("#mod_lookup_last_active").text(f.result.user_info.last_active),$("#mod_lookup_mute_count").text(f.result.user_info.mute_count),$("#mod_lookup_next_mute_timer").text(f.result.user_info.next_mute_timer),$("#mod_lookup_ignoring").html(f.result.user_info.ignoring),$("#mod_lookup_ignored_by").html(f.result.user_info.ignored_by),$("#mod_lookup_channels").text(f.result.user_info.channels),$("#mod_lookup_past_usernames").empty(),$.each(f.result.past_usernames,function(e,t){$("#mod_lookup_past_usernames").append('<div class="row"><div class="col-md-6">'+t.username+'</div><div class="col-md-6">'+t.last_used+"</div></div>")}),$("#mod_lookup_effects").empty(),$.each(f.result.user_info.effects,function(e,t){$("#mod_lookup_effects").append("<li>"+t.name+" - "+t.ends+"</li>")}),$("#mod_lookup_staff_note_holder").empty(),$.each(f.result.mod_notes,function(e,t){$("#mod_lookup_staff_note_holder").append('<div class="row"><div class="col-md-12">'+t.note+'</div><div class="col-md-12 right">'+t.date+" - "+t.poster+"</div></div>")}),$("#mod_lookup_ip_count").text(f.result.past_ip_count),$("#mod_lookup_past_ips").empty(),$("#mod_lookup_past_ips").append('<div class="row"><div class="col-md-4">IP</div><div class="col-md-4">IP Sharers</div><div class="col-md-4">Last Used</div></div>'),$.each(f.result.past_ips,function(e,t){$("#mod_lookup_past_ips").append('<div class="row"><div class="col-md-4">'+t.ip+'</div><div class="col-md-4">'+t.sharers+'</div><div class="col-md-4">'+t.last_used+"</div></div>")})));else if("stripe_ipn"==e[r].page)$("#premiumShopDollarAmount").val("").keyup(),$("#premiumShopGiftFor").val("").keyup(),bn($("#premium_shop_notification"),f.m),Ua(f.p),$("#premiumShopCurrentNobility").text(ui(f.n)),$("#premiumShopGiftAnonCheckbox,#premiumShopGiftCheckbox").prop("checked",!1);else if("event_calendar"==e[r].page)$("#eventCalendarWrapper").html(di(f.month,f.year,f.events,f.is_admin)),va({title:"Event Calendar"}),$("#eventCalendarWrapper").show();else if("event_view"==e[r].page){p="";f.event?(p='<div><h2 class="center nobg">'+f.event.name+(f.is_admin?' (<a id="event_calendar_delete" data-id="'+f.event.eventid+'">delete</a>)':"")+"</h2></div>",p+='<div class="mt10">'+f.event.event+"</div>"):p='<div><h2 class="center nobg">No such event</h2></div>',ga({title:"Event Info",content:p})}else if("event_calendar_save"==e[r].page||"event_calendar_delete"==e[r].page)$.alert(f.m),f.events&&($("#eventCalendarWrapper").html(di(f.month,f.year,f.events,f.is_admin)),va({title:"Event Calendar"}),$("#eventCalendarWrapper").show());else if("promotion_quest_milestones"==e[r].page)if(f.info.s){var He='<table id="promotionQuestProgressTable"><tbody><tr class="hidden-xs hidden-sm"><th>Quest Type</th><th>Progress</th><th>Reward</th></tr>';$.each(f.info.milestones,function(e,t){He+='<tr><td colspan="2"><div class="milestoneBarWrapper"><div class="milestoneBarName">'+t.name+'</div><div class="milestoneBarProgressText">'+t.current+" / "+t.next+" ("+ui(t.percent,2)+'%)</div><div class="milestoneBarFillComplete" style="width: '+t.percent+'%"></div><div class="milestoneBarFillIncomplete"></div><div style="clear: both;"></div></td><td>'+t.reward+"</td></tr>"}),He+="</table>",ga({title:f.info.quest_name+" Quests",content:He})}else $.alert("There is no active promotion quest.");else if("action_graph"==e[r].page){ga({title:"Action Graph",content:'<div id="div_graph_labels" style="padding:0px 20px 20px 20px;"></div><div id="div_graph" style="display:inline-block"></div>'});new Dygraph(document.getElementById("div_graph"),f.data.map(function(e){return[new Date(1e3*e[1]),e[0]]}),{labels:["Time","Actions"],labelsKMB:!0,labelsDiv:document.getElementById("div_graph_labels"),legend:"always",legendFormatter:Ge});function Ge(e){if(console.log(e),null==e.x){var t=e.dygraph.rawData_;return e.dygraph.dateWindow_&&(t=t.filter(function(t){return t[0]>=e.dygraph.dateWindow_[0]&&t[0]<=e.dygraph.dateWindow_[1]})),"<br>"+ui(t[t.length-1][1]-t[0][1])+" Actions completed between "+moment(t[0][0]).format("MMM DD YYYY, HH:mm:ss")+" and "+moment(t[t.length-1][0]).format("MMM DD YYYY, HH:mm:ss")}var a=this.getLabels()[0]+": "+e.xHTML;return e.series.forEach(function(t){if(t.isVisible){var n=e.dygraph.rawData_.findIndex(function(t){return t[0]==e.x}),i=t.labelHTML+": "+t.yHTML;n>0&&(i+=" (+"+ui(t.y-e.dygraph.rawData_[n-1][1])+")"),t.isHighlighted&&(i="<b>"+i+"</b>"),a+="<br>"+t.dashHTML+" "+i}}),a}}}else if("notification"==e[r].type)Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">'+e[r].m+"</span></li>");else if("harvestron_complete"==e[r].type)$("#harvestronNotifier").show(),Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">'+e[r].m+"</span></li>"),Ua(e[r].p);else if("captcha_required"==e[r].type)gt(e[r],e[r].a_t,e[r].extra,e[r].v,1);else if("stop_actions"==e[r].type)Ye=!0;else if("battle"==e[r].type)Ye=!1,Ba(),Pa(e[r].results);else if("harvest"==e[r].type)Ye=!1,Na(),qa(e[r]);else if("craft"==e[r].type)Ye=!1,Fa(),Ea(e[r].results);else if("carve"==e[r].type)Ye=!1,Oa(),Ha(e[r].results);else if("event_action"==e[r].type)Ye=!1,Sa(),Aa(e[r].results);else if("play_sound"==e[r].type)m.play();else if("event_update"==e[r].type)$(".battleBossText").prepend('<li style="color:red;">In the past 10 seconds, <span title="'+e[r].harvesters+'">'+ui(e[r].harvester_count)+" adventurer"+(1==e[r].harvester_count?"</span> has":"s</span> have")+' harvested <span class="emerald">'+ui(e[r].resource_count)+'</span> resources and <span title="'+e[r].attackers+'">'+ui(e[r].attacker_count)+" adventurer"+(1==e[r].attacker_count?"</span> has":"s</span> have")+' attacked, dealing <span class="opal">'+ui(e[r].damage_count)+"</span> damage!"),$(".battleBossText").children()&&$(".battleBossText").children().length>50&&$(".battleBossText li:last-child").remove();else if("event_start"==e[r].type)ut=Date.now()+1e3*e[r].time_left,e[r].sound&&m.play();else if("event_end"==e[r].type)ut=null;else if("fillmsg"==e[r].type)W.html(e[r].m);else if("nsfwchan"==e[r].type)$.confirm({title:"Channel Join Confirmation",message:"The "+e[r].c_id+" channel is intended for users aged 18 years or older.  By joining this channel, you confirm that you are at least 18 years of age.<br /><br />Join the channel?",buttons:{Yes:{class:"green",action:function(){a.send(JSON.stringify({type:"join",channel:"Limbo",password:"IAm18OrOlder"}))}},No:{class:"red",action:function(){}}}});else if("warn"==e[r].type)$.alert("You received a warning from a moderator.  Please respond to them in chat.");else if("force_alert"==e[r].type)$.alert(e[r].m);else if("vdaygift"==e[r].type)$.vdayalert(e[r].m,e[r].t);else if("update_pinfo"==e[r].type)Ua(e[r].p);else if("layout_add"==e[r].type)$("body").hasClass("halloween")||$("body").css("background","#013B39").animate({"background-color":"#FFF",opacity:0},2e3,function(){$("body").removeClass("workmode stripped").addClass("halloween").animate({opacity:1},2e3).css("background","")});else if("post_event_resume"==e[r].type){var Qe;"battle"==e[r].a?Qe="The event has ended.  You began battling again automatically.":"harvest"==e[r].a?Qe="The event has ended.  You began "+e[r].t+" again automatically.":"craft"==e[r].a?Qe="The event has ended.  You began crafting "+e[r].i+" again automatically.":"carve"==e[r].a&&(Qe="The event has ended.  You began carving "+e[r].i+" again automatically."),$.alert(Qe,"Event Complete")}else if("layout_remove"==e[r].type)($("body").hasClass("workmode")||$("body").hasClass("halloween")||$("body").hasClass("veesy")||$("body").hasClass("stripped")||$("body").hasClass("vday")||$("body").hasClass("novday"))&&$("body").animate({opacity:0},2e3,function(){$("body").css("background","#FFF").removeClass("workmode halloween veesy stripped vday novday").animate({"background-color":"#013B39"},2e3,function(){$("body").css("background","").animate({opacity:1})})});else if("motd"==e[r].type)Xn("<li>"+i+e[r].mts+o+' <span class="chat_announcement">Message of the Day: '+e[r].m+"</span></li>");else if("cmotd"==e[r].type)Xn("<li>"+i+e[r].ts+o+' <span style="font-weight: bold;color: '+e[r].chancolor+';">Clan Message of the Day: '+e[r].m+"</span></li>");else if("timestamp"==e[r].type){var Ue=new Date,je=Ue.getHours(),Je=Ue.getMinutes(),Ve=Ue.getSeconds(),ze=li(je,2)+":"+li(Je,2)+":"+li(Ve,2);Xn("<li>"+i+e[r].m+o+' <span class="chat_notification">The current server time is '+e[r].m+".  Your local time is "+ze+".</span></li>")}else if("bonustime"==e[r].type);else if("announcement"==e[r].type)Xn("<li>"+i+e[r].ts+o+' <span class="chat_announcement">Announcement: '+e[r].m+"</span></li>");else if("clanannouncement"==e[r].type)Xn("<li>"+i+e[r].ts+o+" "+i+'<span style="font-weight: bold; color:'+e[r].chancolor+'">CLAN</span>'+o+' <span style="font-weight: bold; color:'+e[r].chancolor+'">Announcement: '+e[r].m+"</span></li>");else if("gamestats"==e[r].type)X.text(ui(e[r].c_o)+" Adventurer"+(1==e[r].c_o?"":"s")+" Online"),K.text(fn(e[r].m_s)).attr("title",ui(e[r].m_s)),Z.text(fn(e[r].h_a)).attr("title",ui(e[r].h_a)),ee.text(fn(e[r].ct_a)).attr("title",ui(e[r].ct_a)),te.text(fn(e[r].cv_a)).attr("title",ui(e[r].cv_a));else if("gametip"==e[r].type)Xn("<li>"+i+e[r].ts+o+" "+i+'<span class="game_tip">Gameplay Tip</span>'+o+' <span class="game_tip">'+e[r].tip+"</span></li>");else if("syslog"==e[r].type)e[r].u?Xn("<li>"+i+e[r].ts+o+' <span style="color:green;">[ <a class="profileLink">'+e[r].u+"</a> [ "+e[r].i+" ] "+e[r].m+" ]</span></li>"):Xn("<li>"+i+e[r].ts+o+' <span style="color:green;">[ '+e[r].m+" ]</span></li>");else if("onlinecount"==e[r].type)$("#onlineCount").text(e[r].count);else if("nicknamelist"==e[r].type){var Xe='<table id="nicknameTable"><tr><th>User</th><th>Nickname</th>';$.each(e[r].nicknames,function(e,t){Xe+='<tr><td><a class="profileLink">'+e+"</a></td><td>"+t+"</td></tr>"}),ga({title:"Your Nickname List",content:Xe+="</table>"})}else if("mychans"==e[r].type){$("#chatChannel option:selected").attr("id");var Ke=e[r].channels,Ze=1,et=e[r].d;$("#chatChannel,#channelList").empty();for(R=0;R<Ke.length;R++)Ke[R].blocked||$("#chatChannel").append('<option id="channel'+Ke[R].name+'"'+(Ke[R].id==et?' selected="selected"':"")+' value="'+Ke[R].id+'">'+Ke[R].name+"</option>"),$("#channelList").append('<li class="channelLI"><button type="button" title="Click to turn '+(Ke[R].on?"off":"on")+'" class="chatChannel'+(Ke[R].private?" privateChannel":"")+'" style="background-color:'+(Ke[R].on?Ke[R].color:"black")+';" data-id="'+Ke[R].name+'" data-on="'+Ke[R].on+'"></button> '+Ke[R].name+(Ke[R].private?" (/"+Ze+")":"")+"</li> "),Ke[R].private&&Ze++;$(".chatChannel").on("click",function(e){e.preventDefault(),"true"==$(this).attr("data-on")?a.send(JSON.stringify({type:"leave",channel:$(this).attr("data-id")})):a.send(JSON.stringify({type:"join",channel:$(this).attr("data-id")}))})}else if("profile"==e[r].type&&e[r].target)Vt(e[r].target);else if("modlist"==e[r].type)if(e[r].list.length){var nt=[];$.each(e[r].list,function(e,t){nt.push('<a class="profileLink">'+t.n+"</a>"+(t.a?" (AFK)":"")+(t.q?" (QUIET)":""))}),Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">The following moderators are currently available: '+nt.join(", ")+"</span></li>")}else Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">No moderators are marked as available.</span>');else if("userlist"==e[r].type){var it='<table style="width: 80%;margin:0 auto;">';$.each(e[r].list,function(e,t){it+='<tr><td><a class="profileLink">'+t.n+"</a></td><td>"+t.i+"</td></tr>"}),ga({title:"Users in Chat",content:it+="</table>"})}else if("colorlist"==e[r].type){it='<div style="display: flex;flex-direction:row;flex-wrap:wrap;">';$.each(e[r].list,function(e,t){it+='<span style="color:'+t+';flex-basis:20%;">'+t+"</span>"}),ga({title:"Named Colors",content:it+="</div>"})}else if("you_are_afk"==e[r].type)$("#iAmAFKReason").html(e[r].r),$("#iAmAFK").show();else if("you_are_not_afk"==e[r].type)$("#iAmAFK").hide();else if("all_channels"==e[r].type){it='<table border="1" style="margin: 0 auto;"><tr><th>Channel</th><th>Owner</th></tr>';$.each(e[r].list,function(e,t){it+='<tr><td style="color: '+t.c+'">'+t.n+'</td><td><a class="profileLink">'+t.o+"</a></td></tr>"}),ga({title:"Custom Chat Channels",content:it+='<tr><td class="center" colspan="2">Viewing page '+e[r].cp+" of "+e[r].tp+" ("+e[r].c+" results)</td></tr>"})}else if("chanlist"==e[r].type)if(e[r].list.length){nt=[];$.each(e[r].list,function(e,t){nt.push('<a class="profileLink">'+t.n+"</a>"+(t.a?" (AFK)":"")+(t.q?" (QUIET)":""))}),Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">The following users are '+(e[r].f?"subscribed to":"currently on")+" this channel: "+nt.join(", ")+"</span></li>")}else Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">No'+(C.f?"":" online")+" users are tuned into this channel.</span>");else if("chanlist2"==e[r].type)e[r].list.length?Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">The following users are '+(e[r].f?"subscribed to":"currently on")+' this channel: <a class="profileLink">'+e[r].list.join('</a>, <a class="profileLink">')+"</a></span></li>"):Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">No'+(C.f?"":" online")+" users are tuned into this channel.</span>");else if("clanless"==e[r].type)e[r].list.length?Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">The following online users are clanless: '+e[r].list.join(", ")+"</span></li>"):Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">No online users are clanless.</span>');else if("mutelist"==e[r].type)e[r].list.length?Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">The following users are muted: <a class="profileLink">'+e[r].list.join('</a>, <a class="profileLink">')+"</a></span></li>"):Xn("<li>"+i+e[r].ts+o+' <span class="chat_notification">No online users are muted.</span>');else if("delete"==e[r].type)$("#message-"+e[r].mid).remove();else if("transaction"==e[r].type)Xn("<li>"+i+e[r].ts+o+" "+i+'<span style="color: '+e[r].chancolor+';">Market</span>'+o+' <span style="color: '+e[r].chancolor+';"><a class="profileLink">'+e[r].u+"</a> "+e[r].m+"</span></li>"),$("#gold").text(fn(e[r].gold,1e8));else if("pm"==e[r].type)Xn("<li>"+i+e[r].ts+o+' <span style="color: #FF3;">Whisper from '+(e[r].from_staff>0?'<span style="color: red;">STAFF</span> ':"")+'<a class="profileLink">'+e[r].u+"</a>: "+e[r].m+"</span></li>");else if("pmto"==e[r].type)Xn("<li>"+i+e[r].ts+o+' <span style="color: #DE3937;">Whisper to <a class="profileLink">'+e[r].u+"</a>: "+e[r].m+"</span></li>");else if("join"==e[r].type){e[r].c_id%1==0||(c='<span style="color:'+e[r].chancolor+'">'+e[r].c_id+"</span>");var ot="";e[r].aka&&(ot=" ("+e[r].aka+")"),Xn("<li>"+i+e[r].ts+o+" "+i+c+o+' <span style="font-style: italic;color:'+e[r].chancolor+'"><a class="profileLink">'+e[r].u+"</a>"+ot+" has joined the channel.</span></li>")}else if("leave"==e[r].type){e[r].c_id%1==0||(c='<span style="color:'+e[r].chancolor+'">'+e[r].c_id+"</span>");ot="";e[r].aka&&(ot=" ("+e[r].aka+")"),Xn("<li>"+i+e[r].ts+o+" "+i+c+o+' <span style="font-style: italic;color:'+e[r].chancolor+'"><a class="profileLink">'+e[r].u+"</a>"+ot+" left the channel.</span></li>")}else if("ckick"==e[r].type){e[r].c_id%1==0||(c='<span style="color:'+e[r].chancolor+'">'+e[r].c_id+"</span>");ot="";e[r].aka&&(ot=" ("+e[r].aka+")"),Xn("<li>"+i+e[r].ts+o+" "+i+c+o+' <span style="font-style: italic;color:'+e[r].chancolor+'"><a class="profileLink">'+e[r].u+"</a>"+ot+" was kicked from the channel.</span></li>")}else if("cban"==e[r].type){e[r].c_id%1==0||(c='<span style="color:'+e[r].chancolor+'">'+e[r].c_id+"</span>");ot="";e[r].aka&&(ot=" ("+e[r].aka+")"),Xn("<li>"+i+e[r].ts+o+" "+i+c+o+' <span style="font-style: italic;color:'+e[r].chancolor+'"><a class="profileLink">'+e[r].u+"</a>"+ot+" was banned from the channel.</span></li>")}else if("cunban"==e[r].type){e[r].c_id%1==0||(c='<span style="color:'+e[r].chancolor+'">'+e[r].c_id+"</span>");ot="";e[r].aka&&(ot=" ("+e[r].aka+")"),Xn("<li>"+i+e[r].ts+o+" "+i+c+o+' <span style="font-style: italic;color:'+e[r].chancolor+'"><a class="profileLink">'+e[r].u+"</a>"+ot+" was unbanned from the channel.</span></li>")}else if("pmhistory"==e[r].type){var rt=e[r].ml,st="";for(R=0;R<rt.length;R++)if("pm"==rt[R].type){ot="";rt[R].aka&&(ot=" ("+rt[R].aka+")"),st+="<li>"+i+rt[R].ts+o+' <span style="color: #FF3;">Whisper from <a class="profileLink">'+rt[R].u+"</a>"+ot+": "+rt[R].m+"</span></li>"}else"pmto"==rt[R].type&&(st+="<li>"+i+rt[R].ts+o+' <span style="color: #FF3;">Whisper to <a class="profileLink">'+rt[R].u+"</a>: "+rt[R].m+"</span></li>");$("#chatMessageHistory").html(st),va({title:"Last 100 private messages"}),$("#chatMessageHistoryWrapper").show()}else if("global"==e[r].type){c='<span style="color: '+(dt=e[r].chancolor?e[r].chancolor:at[1])+';">'+tt[1]+"</span>",Xn("<li>"+i+e[r].ts+o+" "+i+c+o+' <span style="color: '+dt+'">'+e[r].m+"</span></li>")}else if("event"==e[r].type){c='<span style="color: '+(dt=e[r].chancolor?e[r].chancolor:at[9])+';">'+tt[9]+"</span>",Xn("<li>"+i+e[r].ts+o+" "+i+c+o+' <span style="color: '+dt+'">'+e[r].m+"</span></li>")}else if("force_update"==e[r].type)location.reload();else if("history"==e[r].type){var lt;at[e[r].c_id]?("AREA"==(lt=tt[e[r].c_id])&&(lt=e[r].ml[0].chantag),dt=e[r].ml[0].chancolor?e[r].ml[0].chancolor:at[e[r].c_id]):(lt=e[r].ml[0].chantag,dt=e[r].ml[0].chancolor);var ct="";st="",Me=e[r].s;"Main"!=lt&&(ct=i+'<span style="color: '+dt+'">'+lt);for(rt=e[r].ml,R=0;R<rt.length;R++){ot="";s="",rt[R].modtag&&(s=rt[R].modtag),rt[R].aka&&(ot=" ("+rt[R].aka+")"),1==rt[R].e?st+='<li data-channel="'+e[r].c_id+'" id="message-'+rt[R].m_id+'">'+(Me?'<a class="chatDelete">[X] </a>':"")+i+rt[R].ts+o+" * "+ct+("Main"!=lt?"</span>"+o:"")+(rt[R].title?" "+("CLAN"==lt?'<span style="color: '+dt+';">'+rt[R].title+"</span>":rt[R].title):"")+" "+s+' <span style="font-style: italic; color: '+dt+'">'+(rt[R].u?'<a class="profileLink">'+rt[R].u+"</a>"+ot:"")+" "+rt[R].m+"</span></li>":st+='<li data-channel="'+e[r].c_id+'" id="message-'+rt[R].m_id+'">'+(Me?'<a class="chatDelete">[X] </a>':"")+i+rt[R].ts+o+" "+ct+("Main"!=lt?"</span>"+o:"")+(rt[R].title?" "+("CLAN"==lt?'<span style="color: '+dt+';">'+rt[R].title+"</span>":rt[R].title):"")+" "+s+(rt[R].u?' <a class="profileLink">'+rt[R].u+"</a>"+ot+(1==e[r].c_id?"":": "):"")+'<span style="color: '+dt+'">'+rt[R].m+"</span></li>"}$("#chatMessageHistory").html(st),va({title:"Last 100 messages on the "+lt+" channel"}),$("#chatMessageHistoryWrapper").show()}else{var dt;ot="";dt=e[r].chancolor,e[r].aka&&(ot=" ("+e[r].aka+")");var pt=0;new RegExp("@"+$("#username").text(),"gi").test(e[r].m)&&e[r].u!="@"+$("#username").text()&&(pt=1),e[r].c_id%1==0||(c=i+" "+e[r].c_id+" "+o),1==e[r].e||"diceroll"==e[r].type?Xn('<li data-channel="'+e[r].c_id+'" id="message-'+e[r].m_id+'"'+(pt?' class="chat_invert"':"")+">"+(e[r].s?'<a class="chatDelete">[X] </a>':"")+i+e[r].ts+o+" "+c+s+' <span style="font-style: italic; color: '+dt+'">'+l+ot+" "+e[r].m+"</span></li>"):Xn('<li data-channel="'+e[r].c_id+'" id="message-'+e[r].m_id+'"'+(pt?' class="chat_invert"':"")+">"+(e[r].s?'<a class="chatDelete">[X] </a>':"")+i+e[r].ts+o+" "+c+" "+s+" "+l+ot+(1==e[r].c_id?"":": ")+'<span style="color: '+dt+'">'+e[r].m+"</span></li>")}}T&&T.children().length>250&&("up"==$t?$("#chatMessageList li:last-child").remove():$("#chatMessageList li:first-child").remove())}function ai(e){Xn('<li id="websocket_attempting_connection"><span class="chat_notification">Attempting to connect to the websocket server...</span></li>');clearTimeout(l);var t="wss://"+document.domain;t+="/websocket/",(a=new WebSocket(t)).onopen=function(e){$("#websocket_attempting_connection").remove()},a.onmessage=function(e){ti(JSON.parse(e.data))},a.onerror=function(e){},a.onclose=function(e,t){$("#iAmAFK").hide(),Xn('<li id="websocket_reconnect_line"><span style="color: red">Connection to chat closed.  Reconnecting in <span id="websocket_reconnect_time">5 seconds</span>...</span></li>'),$("#websocket_attempting_connection").remove(),a=null,ct=5,ni()}}function ni(){clearTimeout(l),l=setTimeout(function(){--ct>0?($("#websocket_reconnect_time").text(ct+" second"+(1==ct?"":"s")),ni()):($("#websocket_reconnect_line").remove(),ai())},1e3)}function ii(e){return e.charAt(0).toUpperCase()+e.slice(1)}function oi(e){return e.charAt(0).toLowerCase()+e.slice(1)}function ri(e){if(e.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var a=window.getSelection();a.removeAllRanges(),a.addRange(t)}else if(void 0!==document.body.createTextRange){var n=document.body.createTextRange();n.moveToElementText(e),n.collapse(!1),n.select()}}function si(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function li(e,t,a){return a=a||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(a)+e}function ci(e){var t="";if(e>3600){var a=Math.floor(e/3600);t+=a+"h",e-=3600*a}if(e>60){var n=Math.floor(e/60);t+=li(n,2)+"m",e-=60*n}return e>0&&(t+=li(Math.floor(e),2)+"s"),t}function di(e,t,a,n){e=Number(e),t=Number(t);var i='<div class="center row"><div class="col-xs-2"><a class="calendar_view_set" data-month="'+(0==e?11:e-1)+'" data-year="'+(0==e?t-1:t)+'">&larr;</a></div><div class="col-xs-8 center"><h2 class="nobg">'+["January","February","March","April","May","June","July","August","September","October","November","December"][e]+" "+t+'</h2></div><div class="col-xs-2"><a class="calendar_view_set" data-month="'+(11==e?0:e+1)+'" data-year="'+(11==e?t+1:t)+'">&rarr;</a></div></div>';n&&(i+='<div class="mt10 center"><a id="calendar_add_event">Add Event</a></div>'),i+='<div class="mt10"><table cellpadding="0" cellspacing="0" class="calendar" style="margin: 0 auto;">';i+='<tr class="calendar-row"><td class="calendar-day-head">'+["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].join('</td><td class="calendar-day-head">')+"</td></tr>";var o=new Date(t,e,1).getDay(),r=new Date(t,e+1,0).getDate(),s=1,l=0;i+='<tr class="calendar-row">';for(var c=0;c<o;c++)i+='<td class="calendar-day-np"> </td>',s++;for(var d=1;d<=r;d++){i+='<td class="calendar-day">',i+='<div class="day-number">'+d+"</div>";var p=a.filter(function(e){return e.day==d});p.length?p.forEach(function(e){i+='<p><a class="event_view" data-id="'+e.eventid+'">'+e.name+"</a></p>"}):i+="<p> </p><p> </p>",i+="</td>",6==o&&(i+="</tr>",l+1!=r&&(i+='<tr class="calendar-row">'),o=-1,s=0),s++,o++,l++}if(s<8)for(c=1;c<=8-s;c++)i+='<td class="calendar-day-np"> </td>';return i+="</tr>",i+="</table></div>"}function pi(e,t,a,n){var i=0,o=0,r=!1;void 0!==t&&null!==t||(t=2),e=(e=e||"").toString(),!1!==n&&(e=e.replace(/&/g,"&amp;")),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");var s={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===t&&(r=!0),"number"!=typeof t){for(t=[].concat(t),o=0;o<t.length;o++)0===s[t[o]]?r=!0:s[t[o]]&&(i|=s[t[o]]);t=i}return t&s.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/'/g,"&#039;")),r||(e=e.replace(/"/g,"&quot;")),e}function ui(e,t,a,n){return isNaN(e)?n?e:a?0:"NaN":Number(e).format(t,3)}He&&(e=JSON.parse(sessionStorage.getItem("AvaburRecentLoot"))||{}),$(document).ready(function(){var n=StripeCheckout.configure({key:"pk_live_yFmNhFbyNPTsXFEZf1VFdaJy",image:"equipment/breastplate.png",locale:"auto",bitcoin:!1,token:function(e){bn($("#premium_shop_notification"),"Attempting to process payment..."),yt("stripe_ipn",{stripeToken:e.id,amount:100*$("#premiumShopDollarAmount").val().replace(/,/g,""),payment_type:e.object,email:e.email,target:$("#premiumShopGiftCheckbox").is(":checked")?$("#premiumShopGiftFor").val():$("#username").text(),anon:$("#premiumShopGiftAnonCheckbox").is(":checked")?1:0})}});if(C=$("#areaContent"),x=$("#loadimg,#loadimg2,#loadimg4"),Ae=$("#areaWrapper"),Be=$(".main-content-element"),Pe=$(".minor-content-element"),Ne=$("#battleWrapper"),qe=$("#tradeskillWrapper"),Fe=$("#craftingWrapper"),Ee=$("#carvingWrapper"),Oe=$("#bossWrapper"),T=$("#chatMessageList"),W=$("#chatMessage"),L=$("#modalContent"),R=$("#modalWrapper"),M=$("#modalBackground"),D=$("#modal2Content"),I=$("#profileOptionTooltip"),S=$("#gainsKills"),A=$("#gainsDeaths"),B=$("#gainsXP"),E=$("#gainsAttempts"),O=$("#gainsResources"),H=$("#gainsClanResources"),P=$("#gainsGold"),q=$("#gainsClanGold"),N=$("#gainsClanXP"),F=$("#gainsRatio"),G=$("#gainsCraftingAttempts"),Q=$("#gainsCraftingMatsUsed"),Y=$("#gainsCraftingXP"),U=$("#gainsCraftingBonuses"),j=$("#gainsCarvingAttempts"),J=$("#gainsFragmentsUsed"),V=$("#gainsCarvingXP"),z=$("#gainsCarvingGems"),X=$("#shortCurrentlyOnline"),K=$("#shortMonstersSlain"),Z=$("#shortHarvestingAttempts"),ee=$("#shortCraftingAttempts"),te=$("#shortCarvingAttempts"),ae=$(".actionTimer"),ne=$(".battleTextWrapper"),ie=$(".battleText"),oe=$("#battleQuestAvailable"),re=$("#battleQuestObtained"),se=$("#bq_info"),le=$("#bq_info2"),$("#bq_header"),ce=$("#bq_flasher"),de=$("#battleQuestRemaining"),pe=$("#battleQuestComplete"),ue=$("#battleQuestIncomplete"),me=$("#battleQuestVerb"),he=$("#tradeskillQuestAvailable"),fe=$("#tradeskillQuestObtained"),$e=$("#tq_info"),ve=$("#tq_info2"),$("#tq_header"),ge=$("#tq_flasher"),_e=$("#tradeskillQuestRemaining"),ye=$("#tradeskillQuestTimes"),be=$("#tradeskillQuestVerb"),ke=$("#tradeskillQuestComplete"),we=$("#tradeskillQuestIncomplete"),Ce=$("#professionQuestAvailable"),xe=$("#professionQuestObtained"),Te=$("#pq_info"),We=$("#pq_info2"),$("#pq_header"),Le=$("#pq_flasher"),De=$("#professionQuestRemaining"),Re=$("#professionQuestTimes"),Me=$("#professionQuestVerb"),Ie=$("#professionQuestComplete"),Se=$("#professionQuestIncomplete"),$("#shortActivityLog,#preferenceListings,#accountReferralTableHolder,#houseRoomBuildingWrapper,#houseRoomsBuiltWrapper,#houseViewedRoomWrapper,#houseViewedRoomItemWrapper,#rulesWrapper,#helpWrapper,#itemWrapper,#updateWrapper,#chatMessageListWrapper,#chatMessageHistoryWrapper,#lootGainWrapper,#channelLIWrapper,#onlineListWrapper,#accountTitleHolder,#viewedClanMemberWrapper,#myClanDonationWrapper,#equipmentModWrapper,#milestoneTableWrapper,.battleTextWrapper,.battleBossTextWrapper,#areaContent,#tradeGainWrapper,#craftingGainWrapper,#tradeBossGainWrapper,#modToolInfo").on("mousemove",function(e){var t=$(this).offset().left+$(this).width()+Number($(this).css("padding-left").replace("px",""))+Number($(this).css("padding-right").replace("px",""));e.pageX>=t-12&&e.pageX<=t?$(this).addClass("scrollbarhover"):$(this).removeClass("scrollbarhover")}).on("mouseleave",function(e){$(this).removeClass("scrollbarhover")}),ai(),oa(),jQuery.fn.outerHTML=function(e){return e?this.before(e).remove():jQuery("<p>").append(this.eq(0).clone()).html()},R.draggable({handle:"#modalTitle",containment:"document"}),$("#modal2Wrapper").draggable({handle:"#modal2Title",containment:"document"}),He)for(var o in e){e[o].forEach(function(e){Ja(e.m,e.c,e.co,!0)})}function r(e){yt("craft_cancel",{cid:e})}function s(e){yt("craft_finalize",{cid:e})}function l(e,t,a,n,i,o,r){yt("craft_item",{level:e,quality:t,subtype:a,vetoes:n,insta:i,position:o,fill:r})}function c(e){yt("carve_cancel",{cid:e})}function d(e,t,a,n){yt("carve_gem",{tier:e,subtype:t,insta:a,position:n})}$("#showGameStats").on("click",function(e){e.preventDefault(),yt("game_stats",{})}),$("#inventory").on("click",function(e){e.preventDefault(),_t()}),$("#gemInventoryFilter").on("keyup",function(e){var t=$(this).val().toLowerCase();$.each($("#inventoryTable .gemWithTooltip"),function(e,a){t?-1!==JSON.parse($(a).attr("data-json")).n.toLowerCase().indexOf(t)?$(a).parent().parent().show():$(a).parent().parent().hide():$(a).parent().parent().show()})}),$("#eq_info,#currentPromotions").on("click",".promotionQuestDetails",function(e){e.preventDefault(),yt("promotion_quest_milestones",{})}),$(".unequipLink").on("click",function(e){e.preventDefault();var t,a=$(this).closest("div").find(".itemWithTooltip");a[0]&&(t=JSON.parse($(a).attr("data-json")).i),Rt(t,1)}),$(".unequipAccessoryLink").on("click",function(e){e.preventDefault();var t,a=$(this).closest("div").find(".accessoryWithTooltip");a[0]&&(t=JSON.parse($(a).attr("data-json")).i),Mt(t,1)}),$(".inventoryLoad").on("click",function(e){e.preventDefault(),It(),$(this).addClass("active"),"ingredient"==$(this).attr("data-itemtype")?($("#massButtonHolder").hide(),yt("inventory_ingredients",{})):"consumable"==$(this).attr("data-itemtype")?($("#massButtonHolder").hide(),yt("inventory_consumables",{})):"gem"==$(this).attr("data-itemtype")?ra():"accessory"==$(this).attr("data-itemtype")?($("#massButtonHolder").hide(),yt("inventory_accessories",{})):da($(this).attr("data-itemtype"))}),$("#leftTradeWrapper").on("click",".openToolUpgrade",function(e){e.preventDefault(),va({title:"Inventory"});$("#equipmentModWrapper");$("#inventoryWrapper").show(),$("#equipmentMods").empty(),It(),$("#loadTools").click()}),$("#accountActivityPagingLinks").on("click",".pageLink",function(e){e.preventDefault();var t=$("#accountActivityUsername>.profileLink").text();An($(this).attr("data-page"),t)}),$("#accountActivityPagingLinks").on("click",".page_next a",function(e){e.preventDefault();var t=$("#accountActivityUsername>.profileLink").text(),a=$("#accountActivityPagingLinks .page_cur>.pageLink").attr("data-page");An(parseInt(a)+1,t)}),$("#accountActivityPagingLinks").on("click",".page_prev a",function(e){e.preventDefault();var t=$("#accountActivityUsername>.profileLink").text(),a=$("#accountActivityPagingLinks .page_cur>.pageLink").attr("data-page");An(parseInt(a)-1,t)}),$("#accountActivityPagingLinks").on("click",".page_first a",function(e){e.preventDefault();var t=$("#accountActivityUsername>.profileLink").text();An($(this).attr("data-page"),t)}),$("#accountActivityPagingLinks").on("click",".page_last a",function(e){e.preventDefault();var t=$("#accountActivityUsername>.profileLink").text();An($(this).attr("data-page"),t)}),$("#clanActivityPagingLinks").on("click",".pageLink",function(e){e.preventDefault(),Bn($(this).attr("data-page"))}),$("#clanActivityPagingLinks").on("click",".page_next a",function(e){e.preventDefault();var t=$("#clanActivityPagingLinks .page_cur>.pageLink").attr("data-page");Bn(parseInt(t)+1)}),$("#clanActivityPagingLinks").on("click",".page_prev a",function(e){e.preventDefault();var t=$("#clanActivityPagingLinks .page_cur>.pageLink").attr("data-page");Bn(parseInt(t)-1)}),$("#clanActivityPagingLinks").on("click",".page_first a,.page_last a",function(e){e.preventDefault(),Bn($(this).attr("data-page"))}),$("#clanPagingLinks").on("click",".pageLink",function(e){e.preventDefault(),yn($(this).attr("data-page"))}),$("#clanPagingLinks").on("click",".page_next a",function(e){e.preventDefault();var t=parseInt($("#clanPagingLinks .page_cur>.pageLink").attr("data-page"));yn(parseInt(t)+1)}),$("#clanPagingLinks").on("click",".page_prev a",function(e){e.preventDefault();var t=parseInt($("#clanPagingLinks .page_cur>.pageLink").attr("data-page"));yn(parseInt(t)-1)}),$("#clanPagingLinks").on("click",".page_first a",function(e){e.preventDefault(),yn($(this).attr("data-page"))}),$("#clanPagingLinks").on("click",".page_last a",function(e){e.preventDefault(),yn($(this).attr("data-page"))}),$("#clan_invites").on("click",".acceptInvite",function(e){e.preventDefault(),yt("clan_accept",{clanid:$(this).attr("data-clanid")})}),$("#clan_invites").on("click",".declineInvite",function(e){e.preventDefault(),yt("clan_decline",{clanid:$(this).attr("data-clanid")})}),$("#modal2Content").on("input",".boost_slider_allocation",function(e){e.preventDefault(),$(this).parent().parent().find(".boost_count_allocation").val($(this).val()).keyup()}),$("#modal2Content").on("input","#auto_slider_allocation",function(e){e.preventDefault(),$("#autos_to_allocate").val($(this).val()).keyup()}),$("#modal2Content").on("click",".max_button_allocation",function(e){e.preventDefault();var t,a=$(this).parent().parent().parent().parent(),n=a.find(".statWithTooltip").attr("statname"),i=parseInt($("#"+n+"_allocation").attr("cost")),o=$("#"+n+"_allocation").attr("data-b"),r=$("#"+n+"_allocation").attr("data-i"),s=$("#"+n+"_allocation").attr("data-n"),l=parseInt($("#"+n+"_max_allocation").text().replace(/,/g,"")),c=parseInt($("#boostReallocationCrystals").text().replace(/,/g,""));c+=Gt(0,$("#"+n+"_allocation_value").val(),o,r,s),t=isNaN(0)||isNaN(l)?a.find(".boost_slider_allocation").attr("max"):i?Math.min(l-0,jt(i,c)):Math.min(l-0,Jt(0,c,o,r,s)),a.find(".boost_count_allocation").val(t).keyup()}),$("#modal2Content").on("keyup",".boost_count_allocation",function(e){var t=$(this).parent().parent().parent().parent(),a=t.find(".statWithTooltip").attr("statname"),n=parseInt($("#"+a+"_allocation").attr("cost")),i=$("#"+a+"_allocation").attr("data-b"),o=$("#"+a+"_allocation").attr("data-i"),r=$("#"+a+"_allocation").attr("data-n"),s=parseInt($("#"+a+"_max_allocation").text().replace(/,/g,""))-0,l=parseInt(t.find(".total_cost_allocation").text().replace(/,/g,"")),c=parseInt($("#boostReallocationCrystals").text().replace(/,/g,""));isNaN(l)||(c+=l),$(this).val()>s&&$(this).val(s),($(this).val()<0||isNaN($(this).val()))&&$(this).val(0),i?t.find(".total_cost_allocation").text(ui(Gt(0,$(this).val()?$(this).val():0,i,o,r))):t.find(".total_cost_allocation").text(ui(Ht(n,$(this).val()))),l=parseInt(t.find(".total_cost_allocation").text().replace(/,/g,"")),$("#boostReallocationCrystals").text(ui(c-(isNaN(l)?0:l))),t.find(".boost_slider_allocation").val($(this).val())}),$("#modal2Content").on("click","#max_button_autos_allocation",function(e){e.preventDefault();var t=parseInt($("#boostReallocationCrystals").text().replace(/,/g,""));t+=parseInt(Yt(Ge,$("#autos_to_allocate").val())),$("#autos_to_allocate").val(Ut(Ge,t)).keyup()}),$("#modal2Content").on("keyup","#autos_to_allocate",function(e){e.preventDefault();var t=parseInt($("#boostReallocationCrystals").text().replace(/,/g,"")),a=parseInt($("#total_auto_cost_allocation").text().replace(/,/g,""));isNaN(a)||(t+=a),$("#total_auto_cost_allocation").text(ui(Yt(Ge,$(this).val()))),a=parseInt($("#total_auto_cost_allocation").text().replace(/,/g,"")),$("#boostReallocationCrystals").text(ui(t-(isNaN(a)?0:a))),$("#auto_slider").val($(this).val())}),$("#modal2Content").on("click","#boostReallocationButton",function(e){e.preventDefault(),yt("boost_allocation",{})}),$("#turkey_fight").on("click",function(e){e.preventDefault(),Da(),$(".bossNotHere,.eventShopWrapper,.bossParticipantWrapper,#bossStatWrapper,#bossBattleWrapper,#bossHarvestWrapper").hide(),$(".bossPrepareWrapper,#bossWrapper").show(),do_The_Turkey_Event(null)}),$("#event_start").on("click",function(e){e.preventDefault(),Ma()}),$("#modal2Content").on("click",".advent_calendar_collect",function(e){e.preventDefault(),$.post("advent_calendar_collect.php",{}).done(function(e){$.alert(e.m,"Advent Calendar Reward")}).error(function(e){$.alert("A server error occurred.  Please try again.")})}),$("#settingsAccountTitlesWrapper").on("click",".setTitleButton",function(e){e.preventDefault(),yt("titles_set",{id:$(this).attr("data-id")})}),$("#settingsAccountTitlesWrapper").on("click",".titleChangeColor",function(e){e.preventDefault();var t=$(this).attr("data-id");yt("title_edit",{id:t})}),$("#modal2Content").on("click",".christmas_gift_option",function(e){e.preventDefault(),$.confirm({title:"Christmas Gift",message:'Would you like to <span style="color:gold;">share</span> your gift, providing everyone with 5 minutes of double, or <span style="color: gold;">keep</span> your gift and receive 15 minutes of personal double?',buttons:{Share:{class:"green",action:function(){$("#confirmOverlay").remove(),$.post("christmas_gift_use.php",{option:"share"}).done(function(e){$.alert(e.m,"Christmas Gift")}).error(function(e){$.alert("A server error occurred.  Please try again.")})}},Keep:{class:"green",action:function(){$("#confirmOverlay").remove(),$.post("christmas_gift_use.php",{option:"keep"}).done(function(e){$.alert(e.m,"Christmas Gift")}).error(function(e){$.alert("A server error occurred.  Please try again.")})}},Cancel:{class:"red",action:function(){}}}})}),$(".bossFight").on("click",function(e){e.preventDefault(),_a(),a.send(JSON.stringify({type:"action",action:"event_battle"})),Sa()}),$(".bossHarvest").on("click",function(e){e.preventDefault();var t=$(this).attr("data-res");_a(),a.send(JSON.stringify({type:"action",action:"event_harvest",resource:t})),Sa()}),$(".eventShop").on("click",function(e){e.preventDefault(),$(".bossNotHere,.bossParticipantWrapper,#bossStatWrapper,#bossBattleWrapper,#bossHarvestWrapper").hide(),$(".eventShopWrapper").show(),yt("event_shop",{})}),$("#marketWrapper").on("click","#marketPagingLinks .pageLink",function(e){e.preventDefault(),$n($(this).attr("data-t"),$(this).attr("data-page"),$(this).attr("data-q"),$(this).attr("data-ll"),$(this).attr("data-hl"),$(this).attr("data-st"),$(this).attr("data-effect"),$(this).attr("data-ev"),$(this).attr("data-gemmed"))}),$("#marketWrapper").on("click","#marketPagingLinks .page_next a",function(e){e.preventDefault(),$n($(this).attr("data-t"),$(this).attr("data-s"),$(this).attr("data-q"),$(this).attr("data-ll"),$(this).attr("data-hl"),$(this).attr("data-st"),$(this).attr("data-effect"),$(this).attr("data-ev"),$(this).attr("data-gemmed"))}),$("#marketWrapper").on("click","#marketPagingLinks .page_prev a",function(e){e.preventDefault(),$n($(this).attr("data-t"),$(this).attr("data-s"),$(this).attr("data-q"),$(this).attr("data-ll"),$(this).attr("data-hl"),$(this).attr("data-st"),$(this).attr("data-effect"),$(this).attr("data-ev"),$(this).attr("data-gemmed"))}),$("#marketWrapper").on("click","#marketPagingLinks .page_first a",function(e){e.preventDefault(),$n($(this).attr("data-t"),$(this).attr("data-page"),$(this).attr("data-q"),$(this).attr("data-ll"),$(this).attr("data-hl"),$(this).attr("data-st"),$(this).attr("data-effect"),$(this).attr("data-ev"),$(this).attr("data-gemmed"))}),$("#marketWrapper").on("click","#marketPagingLinks .page_last a",function(e){e.preventDefault(),$n($(this).attr("data-t"),$(this).attr("data-page"),$(this).attr("data-q"),$(this).attr("data-ll"),$(this).attr("data-hl"),$(this).attr("data-st"),$(this).attr("data-effect"),$(this).attr("data-ev"),$(this).attr("data-gemmed"))}),$("#loadTools").on("click",function(e){e.preventDefault(),It(),$(this).addClass("active"),$("#massButtonHolder").hide(),yt("inventory_tools",{})}),$("#inventoryTable").on("click",".chatGemLink",function(e){e.preventDefault(),ia(JSON.parse($(this).closest("tr").find(".gemWithTooltip").first().attr("data-json"))),_a()}),$("#inventoryTable").on("click",".moreGemOptions",function(e){e.preventDefault(),yt("gem_options",{gem:JSON.parse($(this).closest("tr").find(".gemWithTooltip").attr("data-json")).i})}),$("#inventoryTable").on("click",".marketGemLink",function(e){e.preventDefault();var t=JSON.parse($(this).closest("tr").find(".gemWithTooltip").attr("data-json"));t.i;b=t.i;var a=t.s,n=parseInt(t.l);y=$(this).closest("tr").children()[0].outerHTML,yt("market",{market_type:"gem",st:a,ll:n-10,hl:n+10,page_num:0,q:0,gem_popup:!0})}),$("#inventoryTable").on("click",".deconstructLink",function(e){e.preventDefault();var t=$(this).closest("tr"),a=JSON.parse(t.find(".gemWithTooltip").attr("data-json")),n=a.i,i=25*(Math.floor(a.l/10)+1);$.confirm({title:"Gem Destruction Confirmation",message:"You will receive "+ui(i)+" gem fragment"+(1==i?"":"s")+" if you deconstruct "+a.n+".  Do you wish to continue?",buttons:{Yes:{class:"green",action:function(){yt("gem_deconstruct",{gem:n})}},No:{class:"red",action:function(){}}}})}),$("#inventoryTable").on("click",".wireIngredientLink",function(e){e.preventDefault();var t=$(this).attr("data-id"),a=$(this).attr("data-amount");ga({title:"Send Ingredients",content:'<h3 id="ingredientMarketName" class="full center nobg">'+$(this).closest("tr").children().first().text()+'</h3><div class="center">You have '+ui(a)+' available.</div><div class="center mt10">Send <input id="wireIngredientAmount" type="text" placeholder="amount" size="6"> to <input id="wireIngredientRecipient" class="can_autocomplete" type="text" placeholder="recipient" size="6"> <input type="button" id="wireIngredientConfirm" value="Send"></div>'}),$("#wireIngredientConfirm").on("click",function(e){e.preventDefault(),yt("ingredient_wire",{iid:t,target:$("#wireIngredientRecipient").val(),amount:$("#wireIngredientAmount").val()})})}),$("#inventoryTable").on("click",".marketIngredientLink",function(e){e.preventDefault();var t=$(this).attr("data-id"),a=$(this).attr("data-amount");y=$(this).closest("tr").children().first().text(),k=a,b=t,yt("market",{market_type:"ingredient",st:t,ingredient_popup:!0})}),$("#inventoryTable").on("click",".toolUpgrade",function(e){e.preventDefault(),yt("harvest_level_increase_check",{skill:$(this).attr("data-type")})}),$("#inventoryTable").on("click",".toolUpgradeMax",function(e){e.preventDefault(),yt("harvest_level_max_check",{skill:$(this).attr("data-type")})}),$("#inventoryTable").on("click",".consumableConsume",function(e){e.preventDefault(),yt("consumable_consume",{iid:$(this).attr("data-id")})}),$("#inventoryTable").on("click",".consumableShare",function(e){e.preventDefault();var t=$(this).attr("data-id");ga({title:"Consumable Sharing",content:'<div class="center">With whom would you like to share your '+$(this).parent().parent().children().first().html()+'?</div><div class="mt10 center"><input id="consumableShareTarget" class="can_autocomplete" type="text" /> <input id="consumableShareConfirm" data-id="'+t+'" value="Share!" type="button" style="padding:6.5px!important;" />'})}),$("#inventoryTable").on("click",".consumableTransfer",function(e){e.preventDefault();var t=$(this).attr("data-id");ga({title:"Consumable Gifting",content:'<div class="center">To whom would you like to gift your '+$(this).parent().parent().children().first().html()+'?</div><div class="mt10 center"><input id="consumableTransferTarget" class="can_autocomplete" type="text" /> <input id="consumableTransferConfirm" data-id="'+t+'" value="Gift!" type="button" style="padding:6.5px!important;" />'})}),$("#modal2Content").on("click","#consumableShareConfirm",function(e){yt("consumable_consume",{iid:$(this).attr("data-id"),target:$("#consumableShareTarget").val()})}),$("#modal2Content").on("click","#consumableTransferConfirm",function(e){yt("consumable_consume",{iid:$(this).attr("data-id"),target:$("#consumableTransferTarget").val()})}),$("#inventoryTable").on("click",".equipLink",function(e){e.preventDefault(),Rt(JSON.parse($(this).closest("tr").find(".itemWithTooltip").attr("data-json")).i,0)}),$("#inventoryTable").on("click",".marketLink",function(e){e.preventDefault();var t=JSON.parse($(this).closest("tr").find(".itemWithTooltip").attr("data-json")),a=(t.i,t.sev,Xe[t.s]),n=t.q,i=parseInt(t.l);y=$(this).closest("tr").children()[0].outerHTML,b=t.i,yt("market",{market_type:"item",st:a,page_num:0,ll:i-2,hl:i+2,q:n-1,item_popup:!0})}),$("#modal2Content").on("click","#marketItemSell",function(e){e.preventDefault(),yt("market_item",{item:b,price:$("#marketPrice").val().replace(/,/g,"")})}),$("#modal2Content").on("click","#marketGemSell",function(e){e.preventDefault(),yt("market_gem",{gem:b,price:$("#marketPrice").val().replace(/,/g,"")})}),$("#modal2Content").on("click","#marketIngredientSell",function(e){e.preventDefault(),yt("market_ingredient",{market_type:"ingredient",subtype:b,amount:$("#marketIngredientAmount").val().replace(/,/g,""),price:$("#marketPrice").val().replace(/,/g,"")})}),$("#inventoryTable").on("click",".chatItemLink",function(e){e.preventDefault(),na(JSON.parse($(this).closest("tr").find(".itemWithTooltip").first().attr("data-json"))),_a()}),$("#inventoryTable").on("click",".moreItemOptions",function(e){e.preventDefault(),yt("item_options",{item:JSON.parse($(this).closest("tr").find(".itemWithTooltip").attr("data-json")).i})}),$("#currentlyEquipped").on("click",".moreItemOptions2",function(e){e.preventDefault();var t,a=$(this).closest("div").find(".itemWithTooltip");a[0]&&(t=JSON.parse($(a).attr("data-json")).i),yt("item_options",{item:t})}),$("#modal2Content").on("click",".backToItemOptions",function(e){e.preventDefault(),yt("item_options",{item:$(this).attr("data-itemid")})}),$("#inventoryTable").on("click",".scrapLink",function(e){e.preventDefault();var t=$(this).closest("tr"),a=JSON.parse(t.find(".itemWithTooltip").attr("data-json")),n=a.i,i=a.scv;$.confirm({title:"Item Scrapping Confirmation",message:"You will receive "+ui(i)+" crafting material"+(1==i?"":"s")+" if you scrap "+a.n+".  If this item has gems socketed into it, you will not get them back.  They will be gone forever.  Do you wish to continue?",buttons:{Yes:{class:"green",action:function(){yt("scrap",{item:n})}},No:{class:"red",action:function(){}}}})}),$("#inventoryTable").on("click",".itemClanDonateLink",function(e){e.preventDefault();var t=$(this).closest("tr"),a=JSON.parse(t.find(".itemWithTooltip").attr("data-json")).i;$.confirm({title:"Item Donation to Clan Confirmation",message:"Are you sure you want to donate "+t.children()[0].outerHTML+" to your clan?",buttons:{Yes:{class:"green",action:function(){yt("item_donate_to_clan",{item:a})}},No:{class:"red",action:function(){}}}})}),$("#clanInventoryTable").on("click",".itemClanReturnLink",function(e){e.preventDefault();var t=$(this).closest("tr"),a=JSON.parse(t.find(".itemWithTooltip").attr("data-json")).i;yt("item_return_to_clan",{item:a})}),$("#clanInventoryTable").on("click",".itemReceiveFromClanLink",function(e){e.preventDefault();var t,a=$(this).closest("tr"),n=JSON.parse(a.find(".itemWithTooltip").attr("data-json")).i;yt("item_receive_from_clan",{item:n,sendTo:t})}),$("#clanInventoryTable").on("click",".itemBorrowFromClanLink",function(e){e.preventDefault();var t=$(this).closest("tr");Dt(JSON.parse(t.find(".itemWithTooltip").attr("data-json")).i)}),$("#clanInventoryTable").on("click",".itemSendFromClanLink",function(e){e.preventDefault();var t=$(this).closest("tr");JSON.parse(t.find(".itemWithTooltip").attr("data-json")).i;ga({title:"Send Item From Armory",content:'<h3 class="full center nobg">'+t.children()[0].outerHTML+'</h3><div class="mt10 center">Send to <input id="itemSendFromClanTo" type="text"> <input id="itemSendFromClanConfirm" type="button" style="padding: 6.5px;" value="Send!" /></div>'})}),$("#clanInventoryTable").on("click",".itemRevokeFromClanLink",function(e){e.preventDefault();var t=$(this).closest("tr"),a=JSON.parse(t.find(".itemWithTooltip").attr("data-json")).i;yt("item_revoke_from_clan",{item:a})}),$("#modal2Content").on("click","#itemSendFromClanConfirm",function(e){e.preventDefault(),Dt(JSON.parse($("#modal2Content").find(".itemWithTooltip").attr("data-json")).i,$("#itemSendFromClanTo").val())}),$("#resetSkills").on("click",function(e){e.preventDefault(),$.post("reset_skills_cost.php",{}).done(function(e){confirm(e.m)&&$.post("reset_skills.php",{confirm:1}).done(function(e){Ua(e.p),At(e.skills),bn($("#train_notification"),e.m)}).error(function(e){bn($("#train_notification"),"An error occurred while attempting to reset skills.")})}).error(function(e){$.alert("An error occurred while attempting to reset skills.")})}),$("#modal2Content").on("click",".moreGemOptions2",function(e){e.preventDefault(),yt("gem_options",{gem:$(this).attr("data-gemid"),from_item:$(this).attr("data-itemid")})}),$("#resetBoosts").on("click",function(e){e.preventDefault(),$.post("reset_boosts.php",{}).done(function(e){Ua(e.p),Ot(e.boosts),bn($("#premium_shop_notification"),e.m)}).error(function(e){bn($("#premium_shop_notification"),"An error occurred while attempting to reset your boosts.  Please try again.")})}),$(".trainSkill").on("click",function(e){e.preventDefault();var t,a,n=$(this).parent().parent().parent().parent(),i=n.find(".statWithTooltip"),o=i.text(),r=parseInt(n.find(".train_count").val().replace(/,/g,""));n.find(".total_cost").text();r>0?(t=i.attr("data-statname"),a=r,$("#"+t).parent().parent().find(".train_count").val(0).keyup(),yt("train_skill",{skill:t,times:a})):bn($("#train_notification"),"How many times would you like to increase your "+o+"?")}),$(".max_button").on("click",function(e){e.preventDefault();var t=$(this).parent().parent().parent().parent(),a=t.find(".skillHolder").first(),n=a.find(".statWithTooltip").attr("data-statname");"base_damage"==n||"base_armor"==n?t.find(".train_count").val(t.find(".train_slider").attr("max")).keyup():parseInt(a.attr("rv"))<parseInt(a.attr("max"))&&t.find(".train_count").val(Bt(a.attr("rv"),$(".platinum").first().attr("title").replace(/,/g,""))).keyup()}),w=$("#clanInventoryTable").DataTable({deferRender:!0,order:[[2,"desc"]],orderFixed:{pre:[6,"asc"]},createdRow:function(e,t,a){$(e).find("td:eq(0)").attr("data-th","Item"),$(e).find("td:eq(1)").attr("data-th","Level"),$(e).find("td:eq(2)").attr("data-th","Power"),$(e).find("td:eq(3)").attr("data-th","Gems"),$(e).find("td:eq(4)").attr("data-th","Actions"),$(e).find("td:eq(5)").attr("data-th","Holder")},drawCallback:function(){var e=this.api(),t=e.settings()[0].aiDisplay,a=e.rows(t).nodes();$.each($(a),function(e,t){var a=$(t).children().last().text();vt.includes(a)?$(t).addClass("hidden"):$(t).removeClass("hidden")})},rowGroup:{startRender:function(e,t){var a=vt.includes(t),n=$("<tr/>").append('<th colspan="6" class="invTypeHeader" data-th="'+t+'"><strong>'+(a?"[+] ":"[-] ")+t+"</strong> ("+e.count()+")</th>");return a?n.removeClass("collapsed"):n.addClass("collapsed"),n},dataSrc:"group_name"},columnDefs:[{targets:0,data:null,render:function(e,t,a,n){return"display"===t?Ct(a):a.n}},{targets:1,data:null,render:function(e,t,a,n){return"display"===t?"<span"+(parseInt($("#level").text().replace(/,/g,""))<a.l?' class="failure"':"")+">"+a.l+"</span>":a.p}},{targets:2,data:null,render:function(e,t,a,n){if("display"===t){var i=JSON.parse($("#"+Ke[a.s]).attr("data-json")).p;return(a.p>i?'<span class="higherPower">':"<span>")+a.p+"</span>"}return a.p}},{targets:3,data:null,render:function(e,t,a,n){return"display"===t?(a.hog?'<span class="higherPower">':"")+(a.gs-a.gsr)+"/"+a.gs+(a.hog?"</span>":""):a.gs-a.gsr}},{targets:4,data:null,render:function(e,t,a,n){if("display"===t)return(a.borrow?'<a class="itemBorrowFromClanLink">[Borrow]</a> ':"")+(a.return?'<a class="itemClanReturnLink">[Return</a> ':"")+(a.take?'<a class="itemReceiveFromClanLink">[Take]</a> <a class="itemSendFromClanLink">[Lend]</a> ':"")+(a.revoke?'<a class="itemRevokeFromClanLink">[Revoke]</a>':"");var i=a.b.match(/(.*?)=([a-zA-Z0-9\.]*)/g).map(function(e){return e.split("=")}).map(function(e){return e[0].replace(",")}),o=a.g.map(function(e){return e.n});return Array.prototype.push.apply(i,o),i.join(",")}},{targets:5,data:null,render:function(e,t,a,n){return"display"===t?a.held_by?'<a class="profileLink">'+a.held_by+"</a>":"None":a.held_by?a.held_by:"None"}},{targets:6,className:"hidden",data:null,render:function(e,t,a,n){return a.group_name}}]}),$("#clanInventoryTable").on("click","tr.group",function(){var e=$(this.children[0]).text().split("] ")[1].split(" (")[0];vt.includes(e)?vt=vt.filter(function(t){return t!==e}):vt.push(e),w.draw()}),$("#clan_list").DataTable({deferRender:!0,createdRow:function(e,t,a){t.mine&&$(e).addClass("myClan")},order:[[1,"desc"]],columns:[{data:"name"},{data:"level"},{data:"members"},{data:"buildings"},{data:"owner"}],columnDefs:[{targets:0,data:null,render:function(e,t,a,n){return"display"===t?'<a class="viewClan">'+a.name+"</a>":a.name}},{targets:1,className:"clan_list_level",data:null,render:function(e,t,a,n){return"display"===t?ui(a.level):a.level}},{targets:2,className:"clan_list_members",data:null,render:function(e,t,a,n){return"display"===t?a.members+" / "+a.maxmembers:a.members}},{targets:3,className:"clan_list_buildings",data:null,render:function(e,t,a,n){return"display"===t?a.buildings+" / "+a.maxbuildings:a.buildings}},{targets:4,className:"clan_list_owner",data:null,render:function(e,t,a,n){return"display"===t?'<a class="profileLink">'+a.owner+"</a>":a.owner}}]}),$("#house_list").DataTable({deferRender:!0,order:[[1,"desc"]],columns:[{data:"house"},{data:"level"},{data:"rooms"},{data:"items"},{data:"ilevels"}],columnDefs:[{targets:0,data:null,render:function(e,t,a,n){return"display"===t?'<a class="viewHouse" data-owner="'+a.on+'">'+a.name+"</a>":a.name}},{targets:1,className:"house_list_rooms",data:null,render:function(e,t,a,n){return"display"===t?ui(a.level):a.level}},{targets:2,className:"house_list_items",data:null,render:function(e,t,a,n){return a.rooms}},{targets:3,className:"house_list_items",data:null,render:function(e,t,a,n){return a.items}},{targets:4,className:"house_list_item_levels",data:null,render:function(e,t,a,n){return"display"===t?ui(a.ilevels):a.ilevels}}]}),$("#multiList").DataTable({deferRender:!0,order:[[2,"desc"]],columns:[{data:"ip"},{data:"users"},{data:"last_used"}],columnDefs:[{targets:0,data:null,render:function(e,t,a,n){return"display"===t?'<a class="lookup" data-type="ip" data-value="'+a.ip+'">'+a.ip+"</a>":a.ip}},{targets:1,data:null,render:function(e,t,a,n){return a.users}},{targets:2,data:null,render:function(e,t,a,n){return"display"===t?a.last_used_display:a.last_used}}],createdRow:function(e,t,a){$(e).find("td:eq(2)").attr("data-order",t.last_used)}}),$("#banList").DataTable({deferRender:!0,order:[[0,"desc"]],columns:[{data:"banid"},{data:"banned"},{data:"type"},{data:"reason"},{data:"ends"},{data:"banner"}],columnDefs:[{targets:0,className:"hidden",data:null,render:function(e,t,a,n){return a.banid}},{targets:1,data:null,render:function(e,t,a,n){return a.banned}},{targets:2,data:null,render:function(e,t,a,n){return a.type}},{targets:3,data:null,render:function(e,t,a,n){return a.reason}},{targets:4,data:null,render:function(e,t,a,n){return a.ends}},{targets:5,data:null,render:function(e,t,a,n){return a.banner}}]}),$("#accountReferralTable").DataTable({deferRender:!0,order:[[4,"desc"]],columns:[{data:"name"},{data:"nobility"},{data:"fame"},{data:"total_actions"},{data:"last_active"}],columnDefs:[{targets:0,data:null,render:function(e,t,a,n){return a.name}},{targets:1,data:null,render:function(e,t,a,n){return"display"===t?fn(a.nobility,1e5):a.nobility}},{targets:2,data:null,render:function(e,t,a,n){return"display"===t?fn(a.fame,1e5):a.fame}},{targets:3,data:null,render:function(e,t,a,n){return"display"===t?fn(a.total_actions,1e5):a.total_actions}},{targets:3,data:null,render:function(e,t,a,n){return"display"===t?fn(a.total_actions,1e5):a.total_actions}},{targets:4,data:null,render:function(e,t,a,n){return"display"===t?a.last_active+("Now"==a.last_active?"":" ago"):a.last_active_time}}],createdRow:function(e,t,a){$(e).find("td:eq(0)").attr("data-th","Adventurer"),$(e).find("td:eq(1)").attr("data-th","Nobility"),$(e).find("td:eq(2)").attr("data-th","Fame"),$(e).find("td:eq(3)").attr("data-th","Total Actions"),$(e).find("td:eq(4)").attr("data-th","Last Active")}}),$("#onlineStaff").DataTable({deferRender:!0,order:[[0,"desc"]],columns:[{data:"level"},{data:"adventurer"},{data:"status"},{data:"activity"}],columnDefs:[{targets:0,data:null,render:function(e,t,a,n){return"display"===t?li(a.l||0,4,"&nbsp;"):a.ul}},{targets:1,data:null,render:function(e,t,a,n){return"display"===t?(a.ul>=105?'<span style="color: #00AEFF;">'+a.pt+"</span>":'<span style="color: #7782FF;">'+a.pt+"</span>")+" "+a.t+'  <a class="profileLink">'+a.n+"</a>":a.n}},{targets:2,data:null,render:function(e,t,a,n){return"display"===t?['<span style="color:red">FATIGUED</span>','<span style="color:white">IDLE</span>','<span style="color:#00FF00">ACTIVE</span>'][a.f]||"":["FATIGUED","IDLE","ACTIVE"][a.f]||a.f}},{targets:3,data:null,render:function(e,t,a,n){return"display"===t?(a.afk?'<span style="color: red;">AFK</span> ':"")+a.ac:a.afk+" "+a.ac}}]}),$("#onlinePlayers").DataTable({deferRender:!0,order:[[0,"desc"]],columns:[{data:"level"},{data:"adventurer"},{data:"status"},{data:"activity"}],columnDefs:[{targets:0,data:null,render:function(e,t,a,n){return"display"===t?li(a.l||0,4,"&nbsp;"):a.l}},{targets:1,data:null,render:function(e,t,a,n){return"display"===t?a.t+' <a class="profileLink">'+a.n+"</a>":a.n}},{targets:2,data:null,render:function(e,t,a,n){return"display"===t?['<span style="color:red">FATIGUED</span>','<span style="color:white">IDLE</span>','<span style="color:#00FF00">ACTIVE</span>'][a.f]||"":["FATIGUED","IDLE","ACTIVE"][a.f]||a.f}},{targets:3,data:null,render:function(e,t,a,n){return"display"===t?(a.afk?'<span style="color: red;">AFK</span> ':"")+a.ac:a.afk+" "+a.ac}}]}),$("#clanMemberList").on("click","#confirmClanMemberChanges",function(e){e.preventDefault(),function(){var e=$('#clanMemberList input[type="radio"]:checked'),t={rank_changes:{},kick:[],accept:[],leadership:""};if(e.length){for(var a=0;a<e.length;a++)"changerank"==e[a].value?t.rank_changes[e[a].id.replace("change-rank-","")]=$('select[name="'+e[a].name.replace("action","rank")+'"]').val():"kick"==e[a].value?t.kick.push(e[a].id.replace("clan-kick-","").replace("revoke-invitation-","")):"acceptapp"==e[a].value?t.accept.push(e[a].id.replace("accept-application-","")):"transferleadership"==e[a].value&&(t.leadership=e[a].id.replace("transfer-leadership-",""));yt("clan_members_manage",t)}}()}),$("#myClanDonationTable").tablesorter({sortInitialOrder:"desc",textExtraction:function(e){return e.title?e.title.replace(/,/g,""):e.textContent}}),$(".bossParticipantList").DataTable({deferRender:!0,order:[[4,"desc"]],columns:[{data:"adventurer"},{data:"hp"},{data:"max hp"},{data:"hits"},{data:"damage"},{data:"harvests"},{data:"resources"}],columnDefs:[{targets:0,orderSequence:["asc","desc"],data:null,render:function(e,t,a,n){return"display"===t?'<a class="profileLink">'+a.u+"</a>":a.u}},{targets:1,orderSequence:["desc","asc"],data:null,render:function(e,t,a,n){return"display"===t?'<span title="'+ui(a.chp)+'">'+fn(a.chp,1e6)+"</span>":a.chp}},{targets:2,orderSequence:["desc","asc"],data:null,render:function(e,t,a,n){return"display"===t?'<span title="'+ui(a.mhp)+'">'+fn(a.mhp,1e6)+"</span>":a.mhp}},{targets:3,orderSequence:["desc","asc"],data:null,render:function(e,t,a,n){return a.hits}},{targets:4,orderSequence:["desc","asc"],data:null,render:function(e,t,a,n){return"display"===t?'<span title="'+ui(a.damage)+'">'+fn(a.damage,1e6)+"</span>":a.damage}},{targets:5,orderSequence:["desc","asc"],data:null,render:function(e,t,a,n){return a.harvests}},{targets:6,orderSequence:["desc","asc"],data:null,render:function(e,t,a,n){return"display"===t?'<span title="'+ui(a.res)+'">'+fn(a.res,1e3)+"</span>":a.res}}]}),$(".donationInput").on("keyup",function(e){var t=$(this).attr("data-currency"),a=$("#myPersonalCurrent"+t),n=$("#myClanCurrent"+t),i=0;if("!"==$(this).val()[$(this).val().length-1]){var o=parseInt($(this).val().substr(0,$(this).val().length-1)),r=parseInt(n.attr("realvalue"));if(o<r)i=1,bn($("#viewed_clan_notification"),"Your clan already has more "+t+" than that!");else{var s=o-r;$(this).val(s)}}else if("%"==$(this).val()[$(this).val().length-1]){var l=parseInt($(this).val().substr(0,$(this).val().length-1)),c=Math.floor(parseInt(a.attr("realvalue"))*(l/100));$(this).val(c)}var d=$(this).val().replace(/,/g,"");if(isNaN(d)&&i<1)bn($("#viewed_clan_notification"),"You must choose positive, numeric donation values.");else if(d&&d>0){var p=parseInt(a.attr("realvalue"))-parseInt($(this).val()),u=parseInt(n.attr("realvalue"))+parseInt($(this).val());a.text(ui(p)).addClass("clanFundModified"),n.text(ui(u)).addClass("clanFundModified"),$("#viewed_clan_notification").empty()}else a.text(ui(parseInt(a.attr("realvalue")))).removeClass("clanFundModified"),n.text(ui(parseInt(n.attr("realvalue")))).removeClass("clanFundModified"),$("#viewed_clan_notification").empty()}),$(".train_count").on("keyup",function(e){var t,a,n,i,o,r,s,l,c,d,p,u,m,h=$(this).parent().parent().parent().parent(),f=h.find(".statWithTooltip").attr("data-statname"),v=$("#"+f),g=v.parent().attr("max")-v.parent().attr("rv");"base_damage"==f||"base_armor"==f?(g=1,$(this).val()<0&&$(this).val(0),h.find(".total_cost").text(ui(function(e,t){if(isNaN(t)||0==t)return 0;var a=parseFloat(e)+parseFloat(t),n=Pt(0,e),i=Pt(0,a),o=Math.ceil((i-n)*(1-$("#training_cost_total").text().replace(/,/g,"")/100));return isNaN(o)?0:o}(v.parent().attr("rv"),Math.max(1,$(this).val())))),h.find(".total_increase").text(ui((n=f,i=v.parent().attr("rv"),o=Math.max(1,$(this).val()),p=parseFloat(i)+parseFloat(o),u=parseFloat(i),m=parseFloat($("#level").text())+u,"base_damage"==n?JSON.parse($("#weapon").attr("data-json")).i?(r=parseFloat(St(0,1)),l=parseFloat(St(u,1)),c=Math.floor((l-r)/1.5),s=St(p,1),d=Math.floor((s-r)/1.5)-c):(r=2+14*m+Math.pow(m,1.73),s=2+14*(m+parseFloat(o))+Math.pow(m+parseFloat(o),1.73),d=Math.floor((s-r)/1.5)):d=Gt(0,p,1,1,5)-Gt(0,u,1,1,5),isNaN(d)?0:d)))):($(this).val()>g&&$(this).val(g),$(this).val()<0&&$(this).val(0),h.find(".total_cost").text(ui((t=v.parent().attr("rv"),(a=Math.max(1,$(this).val()))||(a=0),Math.ceil(Gt(t,a,2,4,1)*(1-$("#training_cost_total").text().replace(/,/g,"")/100))))),h.find(".total_increase").text(ui(Math.max(1,$(this).val())*v.parent().attr("increase"),2))),h.find(".train_slider").val($(this).val()?$(this).val():0),$(this).val()<=0?h.find(".trainSkill").addClass("inactiveBoostPurchase"):h.find(".trainSkill").removeClass("inactiveBoostPurchase"),g<=0?(h.find(".max_button").hide(),h.find(".trainSkill").hide(),h.find(".skill_unmaxed").hide(),h.find(".skill_maxed").show()):(h.find(".max_button").show(),h.find(".trainSkill").show(),h.find(".skill_unmaxed").show(),h.find(".skill_maxed").hide())}),$(".increaseBoost").on("click",function(e){e.preventDefault();var t,a,n=$(this).parent().parent().parent().parent(),i=n.find(".boost_count").val();i>0?(t=n.find(".statWithTooltip").attr("data-statname"),a=i,$("#"+t+"_boost").parent().parent().find(".boost_count").val(0).keyup(),yt("boost_purchase",{boost:t,times:a})):bn($("#premium_shop_notification"),"Choose an amount to purchase.")}),$(".train_slider").on("input",function(e){e.preventDefault(),$(this).parent().parent().find(".train_count").val($(this).val()).keyup()}),$(".boost_slider").on("input",function(e){e.preventDefault(),$(this).parent().parent().find(".boost_count").val($(this).val()).keyup()}),$("#auto_slider").on("input",function(e){e.preventDefault(),$("#autos_to_buy").val($(this).val()).keyup()}),$(".max_button_boost").on("click",function(e){e.preventDefault();var t,a=$(this).parent().parent().parent().parent(),n=a.find(".statWithTooltip").attr("data-statname"),i=parseInt($("#"+n+"_boost").attr("data-cost")),o=parseInt($("#"+n+"_boost").text().replace(/,/g,"")),r=$("#"+n+"_boost").attr("data-b"),s=$("#"+n+"_boost").attr("data-i"),l=$("#"+n+"_boost").attr("data-n"),c=parseInt($("#"+n+"_boost").text().replace(/,/g,"")),d=parseInt($("#"+n+"_max").text().replace(/,/g,""));t=isNaN(c)||isNaN(d)?a.find(".boost_slider").attr("max"):i?Math.min(d-c,jt(i,$(".mypremium").first().text().replace(/,/g,""))):Math.min(d-c,Jt(o,$(".mypremium").first().text().replace(/,/g,""),r,s,l)),a.find(".boost_count").val(t).keyup()}),$(".boost_count").on("keyup",function(e){var t=$(this).parent().parent().parent(),a=t.find(".statWithTooltip").attr("data-statname"),n=parseInt($("#"+a+"_boost").text()),i=parseInt($("#"+a+"_boost").attr("data-cost")),o=$("#"+a+"_boost").attr("data-b"),r=$("#"+a+"_boost").attr("data-i"),s=$("#"+a+"_boost").attr("data-n"),l=parseInt($("#"+a+"_max").text())-n;$(this).val()>l&&$(this).val(l),($(this).val()<0||isNaN($(this).val()))&&$(this).val(0),o?t.find(".total_cost").text(ui(Gt(n,$(this).val()?Math.max(1,$(this).val()):1,o,r,s))):t.find(".total_cost").text(ui(Ht(i,Math.max(1,$(this).val())))),t.find(".boost_slider").val($(this).val()),$(this).val()<=0?t.parent().find(".increaseBoost").addClass("inactiveBoostPurchase"):t.parent().find(".increaseBoost").removeClass("inactiveBoostPurchase"),l<=0?(t.parent().find(".max_button_boost").hide(),t.parent().find(".increaseBoost").hide(),t.parent().find(".boost_unmaxed").hide(),t.parent().find(".boost_maxed").show()):(t.parent().find(".max_button_boost").show(),t.parent().find(".increaseBoost").show(),t.parent().find(".boost_unmaxed").show(),t.parent().find(".boost_maxed").hide())}),$("#increaseAutos").on("click",function(e){e.preventDefault();var t,a=$("#autos_to_buy").val();a>0?(t=a,$("#autos_to_buy").val(0).keyup(),yt("boost_purchase_stamina",{times:t})):bn($("#premium_shop_notification"),"How many autos do you want to buy?")}),$("#max_button_autos").on("click",function(e){e.preventDefault(),$("#autos_to_buy").val(Ut($("#auto_count_boost").text().replace(/,/g,""),$(".mypremium").first().text().replace(/,/g,""))).keyup()}),$("#autos_to_buy").on("keyup",function(e){$("#total_auto_cost").text(ui(Yt($("#auto_count_boost").text().replace(/,/g,""),Math.max(1,$(this).val())))),$("#total_auto_increase").text(ui($(this).val())),$("#auto_slider").val($(this).val()),$(this).val()<=0?$("#increaseAutos").addClass("inactiveBoostPurchase"):$("#increaseAutos").removeClass("inactiveBoostPurchase")}),$("#premiumShopDollarAmount").on("keyup",function(e){var t=$(this).val().replace(/,/g,"");isNaN(t)&&(t=0);var a,n=10*t,i=0;a=t>=20?10*Math.pow(t,1.0415):n,i=0==n?0:100*(a/n-1);var o=(a=Math.floor(a))-n;$("#premiumShopBaseValue").text(ui(n)),$("#premiumShopBonusRate").text(ui(i,2)+"%"),$("#premiumShopBonusValue").text(ui(o)),$("#premiumShopTotalValue").text(ui(a)),$("#premium_shop_notification").empty(),$("#premium_purchase_item_name").val("Relics of Avabur: "+a+" Crystals")}),$("#premiumShopGiftFor").on("keyup",function(e){var t=$("#username").text(),a=$("#premiumShopGiftCheckbox").is(":checked")?$("#premiumShopGiftFor").val():t,n=$("#premiumShopGiftAnonCheckbox").is(":checked")?1:0;$("#premium_purchase_custom").val("buyer="+t+"&recipient="+a+"&anon="+n)}),$("#premiumShopGiftAnonCheckbox").on("change",function(e){var t=$("#username").text(),a=$("#premiumShopGiftCheckbox").is(":checked")?$("#premiumShopGiftFor").val():t,n=$("#premiumShopGiftAnonCheckbox").is(":checked")?1:0;$("#premium_purchase_custom").val("buyer="+t+"&recipient="+a+"&anon="+n)}),$("#premiumShopGiftCheckbox").on("change",function(e){e.preventDefault(),$(this).is(":checked")?$("#premiumShopGiftWrapper").slideDown():$("#premiumShopGiftWrapper").slideUp()}),$("#premium_purchase_gold_count").on("keyup",function(e){e.preventDefault();var t=$("#premium_purchased_today").text(),a=$(this).val();$("#premium_purchase_gold_cost").text(fn(Gt(t,a,2e6,1e6,1),1e8))}),$("#viewPremiumPurchase").on("click",function(e){qt(),$(this).addClass("active"),Ft(),$("#premiumPurchaseWrapper").show()}),$("#viewPermanentBoosts").on("click",function(e){qt(),$(this).addClass("active"),Et(),$("#permanentBoostWrapper").show()}),$("#viewTemporaryBoosts").on("click",function(e){qt(),$(this).addClass("active"),Et(),$("#temporaryBoostWrapper").find(".boost_count").keyup(),$("#temporaryBoostWrapper").show()}),$("#viewMiscellaneousBoosts").on("click",function(e){qt(),$(this).addClass("active"),$("#username_change").empty(),$("#miscellaneousBoostWrapper").show()}),$("#clan_name_submit_change").on("click",function(e){var t=$("#clan_name_change").val();t.length?yt("clan_name_change",{name:t}):bn($("#viewed_clan_notification"),"You must enter a new name.")}),$("#clan_mass_tax_change_submit").on("click",function(e){yt("clan_mass_tax_change",{exp:$("#clan_all_exp_tax").val(),gold:$("#clan_all_gold_tax").val(),res:$("#clan_all_res_tax").val(),drop:$("#clan_all_drop_tax").val()})}),$("#clan_banned_members").on("click",".clan_unban_name",function(e){yt("clan_unban",{name:$(this).closest("tr").children().first().text()})}),$("#clan_ban_name_submit").on("click",function(e){yt("clan_ban",{name:$("#clan_ban_name").val()})}),$("#clan_application_change_submit").on("click",function(e){yt("clan_application_status",{value:$("#clan_application_accepting_change>option:selected").attr("id")})}),$("#submit_username_change").on("click",function(e){var t=$("#username_change").val();t.length?kn(t,"premium"):bn($("#premium_shop_notification"),"You must enter a new username.")}),$("#submit_username_change_fame").on("click",function(e){var t=$("#username_change").val();t.length?kn(t,"fame"):bn($("#premium_shop_notification"),"You must enter a new username.")}),$("#profileWrapper").on("click","#profile_overview_button",function(e){e.preventDefault(),$("#profile_battle_statistics,#profile_harvest_statistics,#profile_profession_statistics,#profile_quest_statistics,#profile_stat_statistics").hide(),$("#profile_overview").show()}),$("#profileWrapper").on("click","#profile_battle_statistics_button",function(e){e.preventDefault(),$("#profile_overview,#profile_harvest_statistics,#profile_profession_statistics,#profile_quest_statistics,#profile_stat_statistics").hide(),$("#profile_battle_statistics").show()}),$("#profileWrapper").on("click","#profile_harvest_statistics_button",function(e){e.preventDefault(),$("#profile_overview,#profile_battle_statistics,#profile_profession_statistics,#profile_quest_statistics,#profile_stat_statistics").hide(),$("#profile_harvest_statistics").show()}),$("#profileWrapper").on("click","#profile_profession_statistics_button",function(e){e.preventDefault(),$("#profile_overview,#profile_battle_statistics,#profile_harvest_statistics,#profile_quest_statistics,#profile_stat_statistics").hide(),$("#profile_profession_statistics").show()}),$("#profileWrapper").on("click","#profile_quest_statistics_button",function(e){e.preventDefault(),$("#profile_overview,#profile_harvest_statistics,#profile_profession_statistics,#profile_battle_statistics,#profile_stat_statistics").hide(),$("#profile_quest_statistics").show()}),$("#profileWrapper").on("click","#profile_stat_statistics_button",function(e){e.preventDefault(),$("#profile_overview,#profile_harvest_statistics,#profile_profession_statistics,#profile_battle_statistics,#profile_quest_statistics").hide(),$("#profile_stat_statistics").show()}),$("#submit_gender_change").on("click",function(e){wn($("#gender_change option:selected").attr("id"),"premium")}),$("#submit_gender_change_fame").on("click",function(e){wn($("#gender_change option:selected").attr("id"),"fame")}),$("#submit_spending_limit_change").on("click",function(e){e.preventDefault();var t=$("#spending_limit_change").val();yt("boosts_set_spending_limit",{amount:t})}),$("#marketTypeSelector a,#marketTypeSelector>button").on("click",function(e){e.preventDefault(),$(this).addClass("active"),$n($(this).attr("data-type"),0,null,null,null,$(this).attr("data-subtype"),$(this).attr("data-effect"),$(this).attr("data-ev"),$(this).attr("data-gemmed"))}),$(".marketListings,#modal2Content").on("click",".buyMarketListing",function(e){e.preventDefault();var t=$(this).closest("tr"),a=$("#marketTypeSelector").find(".active").text(),n=t.attr("id").split("market-listing-")[1],i=t.children().eq(0).text().split(" ")[0].replace(/,/g,""),o=t.children().eq(1).text().split(" ")[0].replace(/,/g,"");if(n){var r=$("#marketTypeSelector").find(".active").attr("data-type"),s=$("#marketTypeSelector").find(".active").attr("data-subtype");"weapon"!=s&&"armor"!=s&&"gem"!=r?(ga({title:"Buy from Market",content:'<div class="dib full"><h3 class="center nobg">Purchase '+a+'</h3><div class="dib center" style="width: 30%;"><h4 class="center nobg">SELLER</h4></div><div class="dib center" style="width: 30%; margin-left: 5%;"><h4 class="nobg">AVAILABLE</h4></div><div class="dib center" style="margin-left: 5%; width: 30%;"><h4 class="nobg">PER UNIT</h4></div><div class="dib center" style="width: 30%;">'+t.children().eq(3).text()+'</div><div class="center dib" style="margin-left: 5%; width: 30%;">'+ui(i)+'</div><div class="dib center" style="margin-left: 5%; width: 30%;">'+ui(o)+' Gold</div><div class="dib full center" style="margin-top: 20px;"><h5 class="nobg">AMOUNT TO PURCHASE</h5></div><div class="dib full center"><input type="text" id="marketBuyCount" size="12" placeholder="Enter Quantity"></input> &middot; <input type="button" id="marketBuyMax" value="Max"></input></div><div class="dib center full" style="margin-top: 20px;"><h4 class="nobg">TOTAL COST</h4></div><div class="dib full center"><span id="marketCostTotal">0</span> Gold</div><div class="dib full center" style="margin-top: 10px;"><input type="button" id="makeMarketPurchase" value="Purchase"></input></div></div>'}),$("#marketBuyCount").on("keyup",function(){$(this).val()&&!isNaN($(this).val().replace(/,/g,""))&&($(this).val(Math.max(0,Math.min(i,parseInt($(this).val().replace(/,/g,""))))),$("#marketCostTotal").text(ui($(this).val().replace(/,/g,"")*o)))}),$("#marketBuyMax").on("click",function(e){e.preventDefault();var t=Math.min(i,Math.floor($("#marketUsableGold").attr("data-personal").replace(/,/g,"")/o));$("#marketBuyCount").val(t).keyup()}),$("#makeMarketPurchase").on("click",function(e){e.preventDefault(),gn(n,$("#marketBuyCount").val().replace(/,/g,""))})):gn(n,1)}}),$(".marketListings,#modal2Content").on("click",".removeListing",function(e){e.preventDefault();var t=$(this).closest("tr");$(".marketListings").find("tr").first().children().first().text();yt("market_remove",{id:t.attr("id").split("market-listing-")[1]})}),$("#trainingTypeHolder button").on("click",function(e){e.preventDefault(),$("#trainingTypeHolder button").removeClass("active"),$(this).addClass("active"),"natural"==$(this).attr("data-type")?$("#trainingBattleSkills").fadeOut(400,function(){$("#trainingHarvestingSkills").fadeOut(400,function(){$("#trainingNaturalSkills").fadeIn(400),$("#trainingGoldRow").show(),$("#trainingPlatinumRow").hide()})}):"battle"==$(this).attr("data-type")?$("#trainingNaturalSkills").fadeOut(400,function(){$("#trainingHarvestingSkills").fadeOut(400,function(){$("#trainingBattleSkills").fadeIn(400),$("#trainingGoldRow").hide(),$("#trainingPlatinumRow").show()})}):$("#trainingNaturalSkills").fadeOut(400,function(){$("#trainingBattleSkills").fadeOut(400,function(){$("#trainingHarvestingSkills").fadeIn(400),$("#trainingGoldRow").hide(),$("#trainingPlatinumRow").show()})})}),$("#refreshItemMarket").on("click",function(e){e.preventDefault(),$n($("#marketTypeSelector *.active").attr("data-type"),0,$("#minQuality option:selected").attr("id"),$("#minItemLevel").val(),$("#maxItemLevel").val(),$("#marketItemFilter option:selected").attr("data-type"),$("#marketBonusFilter option:selected").attr("data-type"),$("#minEffectValue").val(),$("#marketGemmedItems").is(":checked"))}),$("#refreshGemMarket").on("click",function(e){e.preventDefault(),$n($("#marketTypeSelector *.active").attr("data-type"),0,0,$("#minGemLevel").val(),$("#maxGemLevel").val(),$("#marketGemFilter option:selected").attr("data-type"))}),$("#refreshIngredientMarket").on("click",function(e){e.preventDefault(),$n($("#marketTypeSelector *.active").attr("data-type"),0,0,0,0,$("#marketIngredientFilter option:selected").attr("data-type"))}),$("#marketSell").on("click",function(e){e.preventDefault(),yt("market_currency",{market_type:$("#marketTypeSelector *.active").attr("data-type"),subtype:$("#marketTypeSelector *.active").attr("data-subtype"),amount:$("#amountToSell").val().replace(/,/g,""),price:$("#sellingPrice").val().replace(/,/g,"")})}),$("#marketQuickBuyConfirm").on("click",function(e){e.preventDefault(),yt("market_quick_buy",{market_type:$("#quickBuyType").attr("data-type"),st:$("#quickBuyType").attr("data-st"),amount:$("#quickBuyAmount").val().replace(/,/g,""),price:$("#quickBuyMaxPrice").val().replace(/,/g,"")})}),$("#yourClanName").on("click",function(e){e.preventDefault(),yt("clan_view",{mine:1})}),$("#modalWrapper,#modalWrapper2,#chatMessageList,#latestLoot,#allThemTables").on("click",".viewClan",function(e){e.preventDefault(),Cn($(this).text())}),$("#modalWrapper,#modalWrapper2,#chatMessageList,#profileWrapper,#latestLoot,#allThemTables").on("click",".viewHouse",function(e){e.preventDefault(),ya(),Za(0,$(this).attr("data-owner"))}),$("#backToClanList").on("click",function(e){e.preventDefault(),$("#myClanRankEditWrapper").is(":visible")?Ln():(yn(0),$("#viewedClanWrapper").fadeOut(1e3,function(){$("#clanWrapper").fadeIn(500)}))}),$(".backToHouseList").on("click",function(e){e.preventDefault(),Nn()}),$("#backToTitleList").on("click",function(e){e.preventDefault(),$("#titleBackArrow").hide(),$("#settingsAccountTitleCreateWrapper,#settingsAccountTitleEditWrapper,#accountTitleTable").fadeOut(0,function(){$("#accountTitleTable,#settingsAccountTitlesWrapper").fadeIn(500)})}),$("#viewMyClanFunds").on("click",function(e){e.preventDefault(),Pn(),xn(),$("#viewedClanProfileWrapper,#viewedClanMemberWrapper,#myClanBuildingsWrapper,#myClanActivityWrapper,#myClanDonationWrapper,#myClanRankWrapper,#myClanRankEditWrapper,#myClanAdminWrapper").hide(),$("#viewMyClanFunds").addClass("active"),yt("clan_treasury",{clan:$("#myClanLinks").attr("data-id")})}),$("#viewMyClanArmory").on("click",function(e){e.preventDefault(),Pn(),$("#viewedClanProfileWrapper,#viewedClanMemberWrapper,#myClanBuildingsWrapper,#myClanActivityWrapper,#myClanDonationWrapper,#myClanRankWrapper,#myClanRankEditWrapper,#myClanAdminWrapper").hide(),$("#viewMyClanArmory").addClass("active"),yt("clan_armory",{clan:$("#myClanLinks").attr("data-id")})}),$("#inventoryTable").on("click",".equipAccessoryLink",function(e){e.preventDefault(),Mt($(this).attr("data-id"),0)}),$("#inventoryTable").on("click",".upgradeAccessoryLink",function(e){e.preventDefault();var t=$(this).attr("data-id");yt("accessory_upgrade_check",{accessory:t})}),$("#viewMyClanInfo").on("click",function(e){e.preventDefault(),Cn($("#myClanLinks").attr("data-id"))}),$("#viewMyClanActivity").on("click",function(e){e.preventDefault(),Pn(),$("#viewedClanProfileWrapper,#viewedClanMemberWrapper,#myClanBuildingsWrapper,#myClanFundsWrapper,#myClanDonationWrapper,#myClanRankWrapper,#myClanRankEditWrapper,#myClanAdminWrapper").hide(),$("#myClanActivityWrapper").fadeIn(500),$("#viewMyClanActivity").addClass("active"),Bn(0)}),$("#viewMyClanDonations").on("click",function(e){e.preventDefault(),Pn(),$("#viewedClanProfileWrapper,#viewedClanMemberWrapper,#myClanBuildingsWrapper,#myClanActivityWrapper,#myClanFundsWrapper,#myClanRankWrapper,#myClanRankEditWrapper,#myClanAdminWrapper").hide(),$("#viewMyClanDonations").addClass("active"),yt("clan_donations",{})}),$("#viewMyClanBuildings").on("click",function(e){e.preventDefault(),Pn(),$(".clanBuildingCosts").hide(),$("#viewedClanProfileWrapper,#myClanRankEditWrapper,#viewedClanMemberWrapper,#myClanBuildingsWrapper,#myClanFundsWrapper,#myClanDonationWrapper,#myClanActivityWrapper,#myClanRankWrapper,#myClanAdminWrapper").hide(),Mn(),$("#myClanBuildingsWrapper").fadeIn(500),$("#viewMyClanBuildings").addClass("active")}),$("#viewMyClanAdminPanel").on("click",function(e){e.preventDefault(),Pn(),$("#viewedClanProfileWrapper,#myClanRankEditWrapper,#viewedClanMemberWrapper,#myClanBuildingsWrapper,#myClanFundsWrapper,#myClanDonationWrapper,#myClanActivityWrapper,#myClanRankWrapper,#myClanBuildingsWrapper").hide(),yt("clan_bans",{})}),$(".clanBuilding").on("click",function(e){e.preventDefault(),$("#"+$(this).attr("data-id")+"Costs").fadeToggle()}),$(".upgradeClanBuildingButton").on("click",function(e){var t;e.preventDefault(),t=$(this).attr("data-id"),yt("clan_building_upgrade",{clan:$("#myClanLinks").attr("data-id"),building:t})}),$(".downgradeClanBuildingButton").on("click",function(e){e.preventDefault();var t=$(this).attr("data-id");$.confirm({title:"Clan Building Downgrade Confirmation",message:"WARNING: You will only be refunded 25% of the building upgrade's original cost when downgrading a building.<br /><br />Are you sure you want to downgrade this building?",buttons:{Yes:{class:"green",action:function(){var e;e=t,yt("clan_building_downgrade",{clan:$("#myClanLinks").attr("data-id"),building:e})}},No:{class:"red",action:function(){}}}})}),$(".clanBuildingMarkButton").on("click",function(e){var t;e.preventDefault(),t=$(this).attr("data-id"),yt("clan_building_mark",{clan:$("#myClanLinks").attr("data-id"),building:t})}),$("#viewMyClanRanks").on("click",function(e){e.preventDefault(),Ln()}),$("#myClanCreateRank").on("click",function(e){e.preventDefault(),Rn()}),$("#cancelEditDescription").on("click",function(e){e.preventDefault(),$("#viewedClanDescription").prop("readonly",!0),$("#viewedClanDescription").val($("#viewedClanDescription").attr("data-original")).height(0).height($("#viewedClanDescription")[0].scrollHeight),$("#viewedClanDescription").attr("data-original",""),$("#cancelEditDescription,#saveEditDescription").hide(),$("#editEditDescription").show()}),$("#editEditDescription").on("click",function(e){e.preventDefault(),$("#viewedClanDescription").prop("readonly",!1),$("#viewedClanDescription").attr("data-original",$("#viewedClanDescription").val()),$("#cancelEditDescription,#saveEditDescription").show(),$("#editEditDescription").hide(),$("#viewedClanDescription").focus()}),$("#saveEditDescription").on("click",function(e){e.preventDefault(),$("#viewedClanDescription").val()==$("#viewedClanDescription").attr("data-original")?(bn($("#viewed_clan_notification"),"Your clan description has not been changed."),$("#viewedClanDescription").prop("readonly",!0),$("#cancelEditDescription,#saveEditDescription").hide(),$("#editEditDescription").show()):yt("clan_edit_description",{desc:$("#viewedClanDescription").val()})}),$("#questWrapper").on("click",".completeQuest",function(e){e.preventDefault(),yt("quest_complete",{qtype:$(this).attr("data-questtype"),ans:$(this).parent().parent().parent().find(".quest_crystal_guess").val()})}),$("#questWrapper").on("click",".questButton",function(e){e.preventDefault(),$(this).parent().find(".questButton").removeClass("active"),$(this).addClass("active")}),$("#questWrapper").on("click",".questRequest",function(e){e.preventDefault();var t,a=$(this).attr("data-questtype");"kill"==a?t=$(this).closest("div").parent().find("select").find("option:selected").val():t=$(this).parent().parent().find(".questButton.active").first().val();yt("quest_request",{qtype:a,val:t})}),$("#questWrapper").on("click",".forfeitQuest",function(e){e.preventDefault();var t=$(this).attr("data-questtype");yt("quest_forfeit_check",{qtype:t})}),$("#profileWrapper").on("click","#profile_edit_cancel",function(e){e.preventDefault(),$("#profile_description").prop("readonly",!0),$("#profile_description").val($("#profile_description").attr("data-original")).height(0).height($("#profile_description")[0].scrollHeight),$("#profile_description").attr("data-original",""),$("#profile_description").val().split("\n").length>5&&$("#profile_description").height("inherit").attr("rows",5),$("#profile_edit_cancel,#profile_edit_save").hide(),$("#profile_edit_edit").show()}),$("#profileWrapper").on("click","#profile_edit_edit",function(e){e.preventDefault(),$("#profile_description").prop("readonly",!1),$("#profile_description").attr("data-original",$("#profile_description").val()),$("#profile_edit_cancel,#profile_edit_save").show(),$("#profile_edit_edit").hide(),$("#profile_description").focus()}),$("#profileWrapper").on("click","#profile_edit_save",function(e){e.preventDefault(),$("#profile_description").val()==$("#profile_description").attr("data-original")?(bn($("#viewed_profile_notification"),"Your description has not been changed."),$("#profile_edit_cancel,#profile_edit_save").hide(),$("#profile_edit_edit").show(),$("#profile_description").prop("readonly",!0)):yt("profile_edit",{desc:$("#profile_description").val(),userid:$("#profile_link").text()})}),$("#profileWrapper").on("click","#profile_edit_disable",function(e){e.preventDefault(),yt("profile_edit",{status:1,userid:$("#profile_link").text()})}),$("#profileWrapper").on("click","#profile_edit_enable",function(e){e.preventDefault(),yt("profile_edit",{status:0,userid:$("#profile_link").text()})}),$("#viewMyClanMembers").on("click",function(e){e.preventDefault(),Pn(),$("#viewedClanProfileWrapper,#myClanActivityWrapper,#myClanBuildingsWrapper,#myClanFundsWrapper,#myClanDonationWrapper,#myClanRankWrapper,#myClanRankEditWrapper,#myClanAdminWrapper").hide(),$("#viewMyClanMembers").addClass("active"),Wn($("#myClanLinks").attr("data-id"))}),$(".disbandYourClan").on("click",function(e){e.preventDefault(),$.confirm({title:"Clan Disband Confirmation",message:"This action is irreversible and you will not be refunded any of the resources invested into the clan, so consider transferring the leadership to someone else instead.<br /><br />Are you sure you want to delete your clan?",buttons:{Yes:{class:"green",action:function(){yt("clan_disband",{confirm:!0})}},No:{class:"red",action:function(){}}}})}),$("#donateToClanButton").on("click",function(e){e.preventDefault(),yt("clan_donate",{crystals:$("#donateCrystals").val().replace(/,/g,""),platinum:$("#donatePlatinum").val().replace(/,/g,""),gold:$("#donateGold").val().replace(/,/g,""),food:$("#donateFood").val().replace(/,/g,""),wood:$("#donateWood").val().replace(/,/g,""),iron:$("#donateIron").val().replace(/,/g,""),stone:$("#donateStone").val().replace(/,/g,"")})}),$("#clanless_create_clan").on("click",function(e){e.preventDefault();ga({title:"Create a Clan",content:'<div id="clanCreationWrapper" class="row"><div class="center" id="clan_create_notification"></div><h3 class="center nobg">Create a Clan</h3><div style="margin-top: 10px;" class="col-md-8"><div><div class="col-md-4 center">Name</div><div class="col-md-8"><input id="create_clan_name" type="text" maxlength="40" size="40"></div><div class="col-md-4 center">Description</div><div class="col-md-8"><textarea id="create_clan_description" rows="5" cols="40"></textarea></div><div class="col-md-8 col-md-offset-4"><input type="checkbox" id="create_clan_announce"> Announce the creation of this clan globally</div><div class="col-md-12 right"><input id="create_clan" value="Create!" type="button"></div></div></div><div class="col-md-4" style="margin-top: 10px;">Creating a clan requires:<ul><li><span class="gold">10,000,000 Gold</span></li><li><span class="platinum">10,000 Platinum</span></li></ul></div></div>'}),$("#create_clan").on("click",function(e){e.preventDefault(),yt("clan_create",{name:$("#create_clan_name").val(),desc:$("#create_clan_description").val(),announce:$("#create_clan_announce").is(":checked")})})}),$("#onlineList").on("click",function(e){e.preventDefault(),yt("online_list",{}),va({title:"Online Adventurers"}),$("#onlineListWrapper").show()}),$("#settingsSavePreferenceChanges").on("click",function(e){e.preventDefault(),function(){var e=$("#settingsAccountPreferencesWrapper input"),t={};if(e.length)for(var a=0;a<e.length;a++){var n=$(e[a]).attr("data-preference-id");n&&("checkbox"==$(e[a]).attr("type")?(t.hasOwnProperty(n)||(t[n]=0),$(e[a]).is(":checked")&&(t[n]=(t[n]||0)|e.eq(a).val())):"radio"==$(e[a]).attr("type")?$(e[a]).is(":checked")&&(t[n]=e.eq(a).attr("id").split("choice-")[1]):t[n]=e.eq(a).val())}yt("settings_preferences_change",{new:t})}()}),$("#settingsSaveClanPreferenceChanges").on("click",function(e){e.preventDefault(),yt("settings_clan_taxes",{exp_tax:$("#settingsClanExpPreference").val(),gold_tax:$("#settingsClanGoldPreference").val(),res_tax:$("#settingsClanResourcePreference").val(),drop_tax:$("#settingsClanDropPreference").val()})}),$("#loadRegistration").on("click",function(e){e.preventDefault(),qn()}),$(".autoSoundTest").on("click",function(e){e.preventDefault(),m.play()}),$("#settingsAccountDetails").on("click",function(e){e.preventDefault(),En(),$(this).addClass("active"),$("#settingsAccountDetailsWrapper").show(),$("#email_change_result,#pw_change_result").empty(),$("#captchaHolderDetailChange").html('<div class="g-recaptcha center" style="margin-top: 10px;"></div>'),recaptchaOnloadCallback()}),$("#massScrap").on("click",function(e){e.preventDefault();var t=$(this).attr("data-type");ga({title:"Mass Scrap",content:'<div class="full center">Scrap all '+t+' of <select id="massOption">'+$("#minQuality").html()+'</select> or worse quality</div><div class="center" style="margin-top: 10px;"><input id="confirm_mass_scrap" type="button" value="Mass scrap"></input></div><div id="mass_scrap_notification" class="center" style="margin-top: 10px;"></div>'}),$("#confirm_mass_scrap").on("click",function(e){var a,n;e.preventDefault(),a=t,n=$("#massOption option:selected").attr("id"),yt("scrap_all_check",{item_type:a,quality:n})})}),$("#massDeconstruct").on("click",function(e){e.preventDefault();var t=$("#inventoryTable .gemWithTooltip:visible"),a='<div class="center"><a id="selectAllMassDeconstruct" class="center" style="text-decoration: none;">Select all</a></div><table id="massDeconstructTable" style="margin:0 auto">';$.each(t,function(e,t){var n=$(t),i=JSON.parse(n.attr("data-json")).i;a+='<tr><td><label for="mass-deconstruct-'+i+'"><input type="checkbox" id="mass-deconstruct-'+i+'" name="massdeconstruct[]" value="'+i+'"> '+n.outerHTML()+"</label></td></tr>"}),ga({title:"Mass Deconstruct",content:a+='<tr><td><input id="confirm_mass_deconstruct" type="button" value="Deconstruct!" /></td></tr></table>'}),$("#confirm_mass_deconstruct").on("click",function(e){var t;e.preventDefault(),(t=$('#massDeconstructTable input[name="massdeconstruct[]"]:checked').map(function(){return this.value}).get()).length?yt("deconstruct_all_check",{list:t.join(",")}):$.alert("No gems were selected for deconstruction!")})}),$("#modal2Content").on("click","#selectAllMassDeconstruct",function(e){e.preventDefault(),$("#massDeconstructTable input").prop("checked",!0)}),$("#purchaseTitle").on("click",function(e){e.preventDefault(),Vn()}),$("#titleEditColorOptions").on("change",function(){$(this).css("color",$("#titleEditColorOptions option:selected").val()),$("#titleEditDisplay").html('<span style="color: '+$("#titleEditColorOptions option:selected")[0].style.color+' !important;">'+$("#titleEditTitle").text()+"</span>")}),$("#titleCreateColorOptions").on("change",function(){$(this).css("color",$("#titleCreateColorOptions option:selected").val()),zn()}),$("#titleCreateFreecolor").on("change",function(){$(this).prop("checked")?($("#titleCreatePremiumPurchase").val("Purchase for 200 crystals"),$("#titleCreateFamePurchase").val("Purchase for "+ui(600)+" fame points")):($("#titleCreatePremiumPurchase").val("Purchase for 100 crystals"),$("#titleCreateFamePurchase").val("Purchase for "+ui(300)+" fame points"))}),$("#titleEditColor").on("click",function(e){e.preventDefault(),yt("title_edit",{id:$("#titleEditColor").attr("data-id"),colorid:$("#titleEditColorOptions option:selected").attr("name")})}),$("#titleEditMakeFreecolor").on("click",function(e){e.preventDefault(),yt("title_edit",{id:$("#titleEditColor").attr("data-id"),make_freecolor:!0})}),$("#titleCreateFamePurchase").on("click",function(e){e.preventDefault(),Jn("fame")}),$("#titleCreatePremiumPurchase").on("click",function(e){e.preventDefault(),Jn("premium")}),$("#titleCreateColorOptions").on("change",function(){zn()}),$("#titleCreateTitle").on("keyup",function(){zn()}),$("#settingsAccountTitles").on("click",function(e){e.preventDefault(),En(),$(this).addClass("active"),$("#settingsAccountTitlesWrapper").show(),$("#accountTitleTable").is(":empty")?$(".titleButton").first().click():$(".titleButton.active").click()}),$("#header_title").on("click",function(e){e.preventDefault(),va({title:"Account Management"}),En(),$("#registrationConfirmationWrapper,#registrationLinkEmailWrapper").hide(function(){$("#accountSettingsWrapper").show(function(){$("#accountManagementWrapper,#settingsAccountTitlesWrapper").show(function(){$("#settingsAccountTitles").addClass("active"),$("#accountTitleTable").is(":empty")?$(".titleButton").first().click():$(".titleButton.active").click()})})})}),$(".dungeon_move").on("click",function(e){if(e.preventDefault(),!$(this).hasClass("disabled")&&!$(this).hasClass("paused")){var t=$(this).attr("data-direction");$.post("dungeon_move.php",{dir:t}).done(function(e){e.s?(Ua(e.p),Ta(e.data),bn($("#dungeon_notification"),e.m),Ya(),$(".dungeon_fight").addClass("disabled"),$(".dungeon_move").addClass("paused"),clearInterval(window.currentinterval),window.currentinterval=setInterval(function(){Qa(),ae.first().html()<=0&&(clearInterval(window.currentinterval),$(".dungeon_fight").removeClass("disabled"),$(".dungeon_move").removeClass("paused"))},500)):bn($("#dungeon_notification"),e.m)}).error(function(e){$.alert("An error occurred while attempting to move.")})}}),$("#dungeonSearch").on("click",function(e){e.preventDefault(),$(this).hasClass("disabled")||$.post("dungeon_search.php",{}).done(function(e){Ua(e.p),Ta(e.data),bn($("#dungeon_notification"),e.m),e.f&&(1==e.f?Ja(e.m,"loot_drops"):Ja(e.f,"loot_drops")),Ya(),$(".dungeon_fight").addClass("disabled"),$(".dungeon_move").addClass("paused"),clearInterval(window.currentinterval),window.currentinterval=setInterval(function(){Qa(),ae.first().html()<=0&&(clearInterval(window.currentinterval),$(".dungeon_fight").removeClass("disabled"),$(".dungeon_move").removeClass("paused"))},500)}).error(function(e){bn($("#dungeon_notification"),"An error occurred while searching the room.")})}),$("#dungeonLeave").on("click",function(e){e.preventDefault(),$.confirm({title:"Dungeon Exit Confirmation",message:"Are you sure you want to leave the dungeon?  There will be a five minute cooldown before you can return to the dungeon.",buttons:{Yes:{class:"green",action:function(){$.post("dungeon_leave.php",{confirm:1}).done(function(e){$("#eternalDungeon").click(),bn($("#dungeon_notification"),e.m)}).error(function(e){bn($("#dungeon_notification"),"An error occurred while leaving the Eternal Dungeon.")})}},No:{class:"red",action:function(){}}}})}),$("#enterDungeonStairway").on("click",function(e){e.preventDefault(),$.post("dungeon_make.php",{}).done(function(e){e.s?($("#dungeonPrepareWrapper,#dungeonSelectionWrapper,#dungeonShopWrapper").hide(),Ua(e.p),Ta(e.data),bn($("#dungeon_notification"),e.m),Ya(),$(".dungeon_fight").addClass("disabled"),$(".dungeon_move").addClass("paused"),clearInterval(window.currentinterval),window.currentinterval=setInterval(function(){Qa(),ae.first().html()<=0&&(clearInterval(window.currentinterval),$(".dungeon_fight").removeClass("disabled"),$(".dungeon_move").addClass("paused"))},500)):$.alert(e.m)}).error(function(e){$.alert("An error occurred while attempting to enter the Eternal Dungeon.")})}),$("#enterDungeonShop").on("click",function(e){e.preventDefault(),$.post("dungeon_shop.php",{tier:"low"}).done(function(e){$("#dungeonPrepareWrapper,#dungeonSelectionWrapper,#dungeon_shop_notification").hide(),$("#dungeonShopWrapper").show(),e.s?($("#dungeonShopTable,#dungeonCurrencyWrapper,#dungeonCurrencyTable").show(),$("#dungeonShopTable tbody").html(""),$("#dungeonCurrencyTable").html(""),$.each(e.sl,function(e,t){var a="";$.each(t.c,function(e,t){a+=t.n+": "+ui(t.v)+"<br />"}),t.a?$("#dungeonShopTable").append("<tr><td>"+Tt(t.a)+"</td><td>"+a+'</td><td><a class="dungeonShopPurchase" data-id="'+t.id+'">Purchase</a></td></tr>'):t.i?$("#dungeonShopTable").append("<tr><td>"+Ct(t.i)+"</td><td>"+a+'</td><td><a class="dungeonShopPurchase" data-id="'+t.id.i+'">Purchase</a></td></tr>'):t.c&&$("#dungeonShopTable").append("<tr><td>"+t.c+"</td><td>"+a+'</td><td><a class="dungeonShopPurchase" data-id="'+t.id.i+'">Purchase</a></td></tr>')}),$.each(e.rc,function(e,t){$("#dungeonCurrencyTable").append('<div class="row"><div class="col-xs-12 col-md-6">'+t.n+':</div><div class="col-xs-12 col-md-6">'+ui(t.v)+"</div></div>")})):($("#dungeonShopTable,#dungeonCurrencyWrapper,#dungeonCurrencyTable").hide(),bn($("#dungeon_shop_notification"),e.m))}).error(function(e){$.alert("An error occurred while attempting to load the Dungeon Shop.")})}),$(".dungeonShopButton").on("click",function(e){e.preventDefault(),$.post("dungeon_shop.php",{tier:$(this).attr("data-type")}).done(function(e){$("#dungeonPrepareWrapper,#dungeonSelectionWrapper,#dungeon_shop_notification").hide(),$("#dungeonShopWrapper").show(),e.s?($("#dungeonShopTable,#dungeonCurrencyWrapper,#dungeonCurrencyTable").show(),$("#dungeonShopTable tbody").html(""),$("#dungeonCurrencyTable").html(""),$.each(e.sl,function(e,t){var a="";$.each(t.c,function(e,t){a+=t.n+": "+ui(t.v)+"<br />"}),t.a?$("#dungeonShopTable").append("<tr><td>"+Tt(t.a)+"</td><td>"+a+'</td><td><a class="dungeonShopPurchase" data-id="'+t.id+'">Purchase</a></td></tr>'):t.i?$("#dungeonShopTable").append("<tr><td>"+Ct(t.i)+"</td><td>"+a+'</td><td><a class="dungeonShopPurchase" data-id="'+t.id.i+'">Purchase</a></td></tr>'):t.cons&&$("#dungeonShopTable").append("<tr><td>"+t.cons+"</td><td>"+a+'</td><td><a class="dungeonShopPurchase" data-id="'+t.id.i+'">Purchase</a></td></tr>')}),$.each(e.rc,function(e,t){$("#dungeonCurrencyTable").append('<div class="row"><div class="col-xs-12 col-md-6">'+t.n+':</div><div class="col-xs-12 col-md-6">'+ui(t.v)+"</div></div>")})):($("#dungeonShopTable,#dungeonCurrencyWrapper,#dungeonCurrencyTable").hide(),bn($("#dungeon_shop_notification"),e.m))}).error(function(e){$.alert("An error occurred while attempting to load the Dungeon Shop.")})}),$("#modal2Content").on("click","#dungeonElevatorGoGoGo",function(e){e.preventDefault(),$.post("dungeon_elevator.php",{floor:$("#dungeonElevatorInput").val()}).done(function(e){_a(),e.s?($("#dungeonPrepareWrapper,#dungeonSelectionWrapper").hide(),Ua(e.p),Ta(e.data),bn($("#dungeon_notification"),e.m),Ya(),$(".dungeon_fight").addClass("disabled"),$(".dungeon_move").addClass("paused"),clearInterval(window.currentinterval),window.currentinterval=setInterval(function(){Qa(),ae.first().html()<=0&&(clearInterval(window.currentinterval),$(".dungeon_fight").removeClass("disabled"),$(".dungeon_move").addClass("paused"))},500)):$.alert(e.m)}).error(function(e){$.alert("An error occurred while attempting to enter the Eternal Dungeon.")})}),$("#enterDungeonElevator").on("click",function(e){e.preventDefault(),ga({title:"Eternal Dungeon Elevator",content:'<div style="text-indent: 3%;">Cramped and dirty, the elevator takes great pleasure in delivering adventurers to their doom within the depths of the Eternal Dungeon.  A touchpad sits on the wall, ready to activate the elevator once a floor number is punched in.</div><div class="mt10 center">Your maximum floor is: '+$(this).attr("data-floor")+'</div><div class="mt10 center">Input the floor you\'d like to visit: <input id="dungeonElevatorInput" type="text" /> <input id="dungeonElevatorGoGoGo" type="button" style="padding: 6.5px!important;" value="Go!" /></div>'})}),$("#fame_shop").on("click",function(e){e.preventDefault(),va({title:"Milestones"}),On(),$("#fameShopPurchaseTable").is(":empty")?$(".fameShopButton").first().click():$(".fameShopButton.active").first().click(),$("#registrationConfirmationWrapper,#registrationLinkEmailWrapper,#accountSettingsWrapper").hide(function(){$("#accountManagementWrapper,#milestonesWrapper").show(function(){$("#milestoneTableWrapper").hide(),$("#fameShopWrapper").show()})})}),$("#settingsAccountReferrals").on("click",function(e){e.preventDefault(),En(),$(this).addClass("active"),$("#settingsAccountReferralsWrapper").show(),yt("referrals_load",{})}),$("#milestones").on("click",function(e){e.preventDefault(),$("#fameShopWrapper").hide(),$("#milestoneTable").is(":empty")?$(".milestoneButton").first().click():$(".milestoneButton.active").click(),va({title:"Milestones"}),$("#milestonesWrapper").show()}),$(".eventShopWrapper").on("click","a",function(e){if(!$(this).hasClass("disabled")){$(".eventShopPurchaseTable a").addClass("disabled");var t=$(this).parent().parent().children().first().html(),a=$(this).html(),n=$(this).attr("data-id");$.confirm({title:"Event Shop Purchase Confirmation",message:"Are you sure you want to purchase "+t+" for "+a+"?",buttons:{Yes:{class:"green",action:function(){yt("event_shop_purchase",{item:n})}},No:{class:"red",action:function(){$(".eventShopPurchaseTable a").removeClass("disabled")}}}})}}),$("#dungeonShopTable").on("click",".dungeonShopPurchase",function(e){if(!$(this).hasClass("disabled")){$(".dungeonShopPurchase").addClass("disabled");var t=$(this).parent().parent().children().first().html(),a=$(this).parent().parent().children().eq(1).html(),n=$(this).attr("data-id");$.confirm({title:"Dungeon Shop Purchase Confirmation",message:"Are you sure you want to purchase "+t+" for "+a+"?",buttons:{Yes:{class:"green",action:function(){$.post("dungeon_shop_purchase.php",{type:n}).done(function(e){bn($("#dungeon_shop_notification"),e.m),e.p&&Ua(e.p),$(".dungeonShopPurchase").removeClass("disabled")}).error(function(e){$(".dungeonShopPurchase").removeClass("disabled"),bn($("#dungeon_shop_notification"),"An error occurred while making your purchase.  Please try again.")})}},No:{class:"red",action:function(){$(".dungeonShopPurchase").removeClass("disabled")}}}})}}),$("#fameShopPurchaseTable").on("click","a",function(e){if(!$(this).hasClass("disabled"))if("TITLE"==$(this).attr("data-type"))$("#milestonesWrapper").fadeOut(function(){En(),$("#settingsAccountTitles").addClass("active"),$("#accountManagementWrapper,#accountSettingsWrapper").fadeIn(function(){$("#settingsLinksWrapper").show(),$("#modalTitle").text("Account Management"),Vn()})});else if("NAME_CHANGE"==$(this).attr("data-type")||"GENDER_CHANGE"==$(this).attr("data-type"))$("#milestonesWrapper").fadeOut(function(){$("#premiumShop").click(),$("#viewMiscellaneousBoosts").click()});else if("HOUSE_PLOT"==$(this).attr("data-type"))$("#milestonesWrapper").fadeOut(function(){$("#housing").click()});else{$("#fameShopPurchaseTable a").addClass("disabled"),yt("fame_shop_purchase",{reward_type:$(this).attr("data-type")})}}),$("#fameShopButton").on("click",function(e){On(),$("#fameShopPurchaseTable").is(":empty")?$(".fameShopButton").first().click():$(".fameShopButton.active").first().click(),$("#milestoneTableWrapper").hide(),$("#fameShopWrapper").show()}),$("#playerTutorial").on("click",function(e){va({title:"Help Files"}),$("#helpWrapper").show(),$(".helpButton").first().click()}),$("#forumLink").on("click",function(e){window.open($(this).children().first().attr("href"),"_blank")}),$("#forumLink").on("mouseup",function(e){2==e.which&&(window.open($(this).children().first().attr("href"),"_blank"),e.preventDefault())}),$("#gameRules").on("click",function(e){va({title:"Rules of Avabur"}),$("#rulesWrapper").show(),$(".rulesButton").first().click()}),$("#helpButtonWrapper").on("click",".helpButton",function(e){$(".helpButton").removeClass("active"),$(this).addClass("active");var t=$(this).attr("data-type");$(".helpSubtopicHolder").hide(),$('.helpSubtopicHolder[data-type="'+t+'"]').show(),"GAME"==t?($("#gameHelpWrapper").show(),$("#chatHelpWrapper,#communityHelpWrapper").hide()):"CHAT"==t?($("#gameHelpWrapper,#communityHelpWrapper").hide(),$("#chatHelpWrapper").show()):"COMMUNITY"==t&&($("#gameHelpWrapper,#chatHelpWrapper").hide(),$("#communityHelpWrapper").show()),$(".helpSubtopicButton:visible").first().click()}),$("#rulesButtonWrapper").on("click",".rulesButton",function(e){$(".rulesButton").removeClass("active"),$(this).addClass("active");var t=$(this).attr("data-type");"GAME"==t?($("#gameRulesWrapper").show(),$("#chatRulesWrapper").hide()):"CHAT"==t&&($("#gameRulesWrapper").hide(),$("#chatRulesWrapper").show())}),$("#rankings").on("click",function(e){e.preventDefault(),$("#rankingTable").is(":empty")?$(".rankingButton").first().click():$(".rankingButton.active").click(),va({title:"Rankings"}),$("#rankingsWrapper").show()}),$(".titleButton").on("click",function(e){e.preventDefault(),$(".titleButton").removeClass("active"),$("#accountTitleTable").empty(),$(this).addClass("active"),yt("titles_view",{title_type:$(this).attr("data-type")})}),$(".rankingButton").on("click",function(e){e.preventDefault(),$(".rankingButton").removeClass("active"),$("#ranking_notification,#rankingTable").empty(),$(this).addClass("active"),Qn($(this).attr("data-type"),0)}),$("#ranking_clan_only,#ranking_active_only,#ranking_clan_sort").on("click",function(e){$(".rankingButton.active").first().click()}),$(".fameShopButton").on("click",function(e){e.preventDefault(),$(".fameShopButton").removeClass("active"),$(this).addClass("active"),yt("fame_shop",{reward_type:$(this).attr("data-type")})}),$("#clan_members_level_manage_toggle").on("click",function(e){e.preventDefault(),"manage"==$(this).attr("data-type")?($(this).attr("data-type","levels"),$("#clanMemberList tr>th:nth-child(4),#clanMemberList tr>th:nth-child(5),#clanMemberList tr>th:nth-child(6),#clanMemberList tr>th:nth-child(7),#clanMemberList tr>th:nth-child(8),#clanMemberList tr>th:nth-child(9),#clanMemberList tr>th:nth-child(10),#clanMemberList tr>td:nth-child(4),#clanMemberList tr>td:nth-child(5),#clanMemberList tr>td:nth-child(6),#clanMemberList tr>td:nth-child(7),#clanMemberList tr>td:nth-child(8),#clanMemberList tr>td:nth-child(9),#clanMemberList tr>td:nth-child(10)").show(),$("#clanMemberList tr>th:nth-child(11),#clanMemberList tr>th:nth-child(12),#clanMemberList tr>th:nth-child(13),#clanMemberList tr>th:nth-child(14),#clanMemberList tr>td:nth-child(11),#clanMemberList tr>td:nth-child(12),#clanMemberList tr>td:nth-child(13),#confirmClanMemberChanges").hide()):($(this).attr("data-type","manage"),$("#clanMemberList tr>th:nth-child(4),#clanMemberList tr>th:nth-child(5),#clanMemberList tr>th:nth-child(6),#clanMemberList tr>th:nth-child(7),#clanMemberList tr>th:nth-child(8),#clanMemberList tr>th:nth-child(9),#clanMemberList tr>th:nth-child(10),#clanMemberList tr>td:nth-child(4),#clanMemberList tr>td:nth-child(5),#clanMemberList tr>td:nth-child(6),#clanMemberList tr>td:nth-child(7),#clanMemberList tr>td:nth-child(8),#clanMemberList tr>td:nth-child(9),#clanMemberList tr>td:nth-child(10)").hide(),$("#clanMemberList tr>th:nth-child(11),#clanMemberList tr>th:nth-child(12),#clanMemberList tr>th:nth-child(13),#clanMemberList tr>th:nth-child(14),#clanMemberList tr>td:nth-child(11),#clanMemberList tr>td:nth-child(12),#clanMemberList tr>td:nth-child(13),#confirmClanMemberChanges").show())}),$(".milestoneButton").on("click",function(e){var t;e.preventDefault(),On(),$(this).addClass("active"),t=$(this).attr("data-type"),$("#milestoneTableWrapper").show(),$("#fameShopWrapper").hide(),yt("settings_milestones",{milestone_type:t})}),$("#settingsTaxes").on("click",function(e){e.preventDefault(),En(),$(this).addClass("active"),$("#settingsClanPreferencesWrapper").show(),Yn()}),$("#settingsAccountPreferences").on("click",function(e){e.preventDefault(),En(),Hn(),$(this).addClass("active"),$("#settingsAccountPreferencesWrapper").show(),Yn(),$(".preferenceButton").first().click()}),$(".preferenceButton").on("click",function(e){var t;e.preventDefault(),Hn(),$(this).addClass("active"),t=$(this).attr("data-type"),$(".preferenceGroup").hide(),$('.preferenceGroup[data-preference-id="'+t+'"]').show()}),$(".helpSubtopicButton").on("click",function(e){e.preventDefault(),$(".helpSubtopicButton").removeClass("active"),$(this).addClass("active"),$(".helpContent").hide(),$('.helpContent[data-type="'+$(this).val()+'"]').show()}),$("#activityWrapper :checkbox").on("change",function(){$("."+$(this).attr("data-class")).toggle()}),$("#loadActivityLog").on("click",function(e){e.preventDefault(),va({title:"Activity Log"}),$("#accountActivityWrapper").show(),An(0)}),$("#shortActivityLink").on("click",function(e){e.preventDefault(),va({title:"Recent Activity"}),$("#shortActivityWrapper").show()}),$("#selectAllAccountActivity").on("click",function(e){e.preventDefault(),"Select All"==$(this).val()?($('#accountActivityCheckboxes input[type="checkbox"]').prop("checked",!0),$(this).val("Unselect All")):($('#accountActivityCheckboxes input[type="checkbox"]').prop("checked",!1),$(this).val("Select All"))}),$("#filterAccountActivity").on("click",function(e){e.preventDefault(),An(0,$("#accountActivityUsername").text())}),$("#filterClanActivity").on("click",function(e){e.preventDefault(),Bn(0)}),$("#selectAllClanActivity").on("click",function(e){e.preventDefault(),"Select All"==$(this).val()?($('#clanActivityCheckboxes input[type="checkbox"]').prop("checked",!0),$(this).val("Unselect All")):($('#clanActivityCheckboxes input[type="checkbox"]').prop("checked",!1),$(this).val("Select All"))}),$("#toggleActivityIP").on("click",function(e){$("#accountActivityTable > .row > div:nth-child(3)").toggle()}),$("#loadSettings").on("click",function(e){e.preventDefault(),yt("settings_check",{})}),$("#close_general_notification").on("click",function(e){e.preventDefault(),$("#general_notification").fadeOut()}),$("#registerform").submit(function(e){e.preventDefault(),yt("register",{acctname:$("#reg_acctname").val(),username:$("#reg_username").val(),password:$("#password").val(),password_confirm:$("#password_confirm").val(),gender:$("#gender").val(),acceptrules:$("#acceptrules").is(":checked"),email:$("#email").val()})}),$("#passwordchangeform").submit(function(e){e.preventDefault();$("#captchaHolderDetailChange #recaptcha_response_field").val();var t=$("#captchaHolderDetailChange .g-recaptcha-response").val();yt("password_change",{current_password:$("#current_password").val(),new_password:$("#new_password").val(),new_password_confirm:$("#new_password_confirm").val(),g:t})}),$("#chatMessageList").on("click",".defaultLayout",function(e){e.preventDefault(),$("body").removeClass("halloween")}),$("#emailchangeform").submit(function(e){e.preventDefault();$("#captchaHolderDetailChange #recaptcha_response_field").val();var t=$("#captchaHolderDetailChange .g-recaptcha-response").val();yt("email_change",{current_password:$("#current_password_ef").val(),new_email:$("#new_email").val(),new_email_confirm:$("#new_email_confirm").val(),g:t})}),$("#chatMessageList,#chatMessageHistory").on("mouseover",".chatDelete",function(){$(this).parent().css("background-color","#808080")}),$("#chatMessageList,#chatMessageHistory").on("mouseout",".chatDelete",function(){$(this).parent().css("background-color","inherit")}),$("#username").on("click",function(e){e.preventDefault(),Vt($(this).text())}),$("#chatMessageList,#modalWrapper,#modal2Wrapper,#latestLoot").on("click",".profileLink",function(e){if(e.preventDefault(),clearTimeout(i),e.ctrlKey)Vt($(this).text());else if(e.shiftKey)I.hide(),_a(),W.html("/w "+$(this).text()+"&nbsp; "),ri(document.getElementById("chatMessage"));else if(mt<1){mt++,$("#profileOptionUsername").text($(this).text()),I.attr("data-username",$(this).text());var t=I,a=($(document).height(),window.innerWidth),n=0,o=0,r="top";(o=$(this).offset().top-$(this).height()-t.height()-10)<0&&(o=$(this).offset().top+$(this).height()+10,r="bottom"),(n=$(this).offset().left-t.width()/2)+t.width()>a&&(n=0),t.css("left",n).css("top",o).removeClass("tooltip_top tooltip_bottom tooltip_left tooltip_right").addClass("tooltip_"+r),t.fadeIn(),i=setTimeout(function(){mt=0},400)}}),$("#chatMessageList,#modalWrapper,#modal2Wrapper,#latestLoot").on("dblclick",".profileLink",function(e){e.preventDefault(),clearTimeout(i),mt=0,I.hide(),_a(),W.html("/w "+$(this).text()+"&nbsp; "),ri(document.getElementById("chatMessage"))}),$("#chatMessageList,#modalWrapper,#modal2Wrapper,#latestLoot").on("mouseout",".profileLink",function(){clearTimeout(i),i=setTimeout(function(){mt=0,I.fadeOut()},400)}),$("#chatMessageList,#modalWrapper,#modal2Wrapper,#latestLoot").on("contextmenu",".profileLink",function(e){e.preventDefault(),$("#profileOptionUsername").text($(this).text()),I.attr("data-username",$(this).text()),I.css("top",$(this).offset().top-I.height()-20),I.css("left",$(this).offset().left+$(this).width()+6),I.fadeIn(),i=setTimeout(function(){mt=0},400)}),I.on("mouseout",function(){clearTimeout(i),i=setTimeout(function(){mt=0,I.fadeOut()},400)}),I.on("mouseover",function(){mt=0,clearTimeout(i)}),$("#profileOptionWhisper").on("click",function(e){e.preventDefault(),I.hide(),_a(),W.html("/w "+I.attr("data-username")+"&nbsp; "),ri(document.getElementById("chatMessage")),mt=0}),$("#profileOptionIgnore").on("click",function(e){e.preventDefault(),I.hide(),_a(),W.html("/ignore "+I.attr("data-username")+"&nbsp; "),ri(document.getElementById("chatMessage"))}),$("#profileOptionWire").on("click",function(e){e.preventDefault(),I.hide(),_a(),W.html("/wire "+I.attr("data-username")+"&nbsp; "),ri(document.getElementById("chatMessage"))}),$("#profileOptionProfile").on("click",function(e){e.preventDefault(),I.hide(),Vt(I.attr("data-username")),mt=0}),$("#basePage").on("click",function(e){e.preventDefault(),Wa()}),$("#eternalDungeon").on("click",function(e){e.preventDefault(),Da(),$.post("dungeon_info.php",{}).done(function(e){$("#battleInfo,#tradeskillInfo,#craftingInfo,#carvingInfo").hide(),$("#dungeonWrapper,#dungeonInfo").show(),e.s?Ta(e.data):($("#areaName").html("Eternal Dungeon"),$("#roomName").html("Outside the Dungeon"),$("#enterDungeonElevator").attr("data-floor",e.mf),$("#dungeonPrepareWrapper,#dungeonSelectionWrapper").show()),ae.text(ui(Math.max(0,e.p.next_action/1e3),1)),$(".dungeon_fight").addClass("disabled"),$(".dungeon_move").addClass("paused"),clearInterval(window.currentinterval),window.currentinterval=setInterval(function(){Qa(),ae.first().html()<=0&&(clearInterval(window.currentinterval),$(".dungeon_fight").removeClass("disabled"),$(".dungeon_move").removeClass("paused"))},500)}).error(function(){$.alert("An error occurred while loading your dungeon.")})}),$("#dungeonEnemyList").on("click",".dungeon_fight",function(e){var t;(e.preventDefault(),$(this).hasClass("disabled"))||(t=$(this).attr("data-id"),Qa(),$.post("dungeon_battle.php",{enemy:t}).done(function(e){C.show(),$("#dungeonPrepareWrapper,#dungeonSelectionWrapper,#dungeonRoomWrapper").hide(),$("#dungeonBattleWrapper").show(),e.captcha?($("#dungeonBattleWrapper").hide(),$("#dungeonRoomWrapper").show(),ga({title:"Replenish Stamina",content:""}),gt(0,"dungeon",0,e.v,1)):"Failed"===e.status?(consecutiveFails+=1,(!e.at||consecutiveFails>=3)&&(Va(e.message),dunno=-1),e.at&&(Qe=Date.now()+Math.max(500,e.at)),e.st&&(dunno=e.st),h(dunno)):($(".dungeon_fight").addClass("disabled"),$(".dungeon_move").addClass("paused"),$("#dungeon_notification").html(""),$("#battlePrepareWrapper").hide(),$(".hpContainer,#battleStatusButtons,.battleTextContainer,.battleTextWrapper").show(),$("#actionTimeWrapper").css("width",""),Ya(),un(e),clearInterval(window.currentinterval),window.currentinterval=setInterval(function(){Qa(),ae.first().html()<=0&&(clearInterval(window.currentinterval),$("#eternalDungeon").click(),$(".dungeon_fight").removeClass("disabled"),$(".dungeon_move").removeClass("paused"))},500))}).error(function(){$(".battleResult").text("An error occurred during battle."),C.show(),$(".battleRewards,.battleClanRewards,#battleIngredientResult,.battleLevelResult,#battleQuestResult,.battleStatResult,#battleDropResult").hide(),Qe=Date.now()+4500}))}),$("#bq_header,#tq_header,#pq_header").on("click",function(e){e.preventDefault(),Zt()}),$("#trainPage").on("click",function(e){e.preventDefault(),va({title:"Training Center"}),$("#trainingWrapper").show(),yt("training",{})}),$("#premiumShop,#promoActive").on("click",function(e){e.preventDefault(),Et(),Ft()}),$("#clanHall").on("click",function(e){e.preventDefault(),$("#clan_notification").empty(),yn(0,1)}),$("#clanMemberList").on("click",'input[type="radio"]',function(e){"true"==$(this).attr("previousValue")?($(this).prop("checked",!1),$(this).attr("previousValue","false")):$(this).attr("previousValue",!0)}),$("#inviteClanMember").on("click",function(e){e.preventDefault(),Tn()}),$("#inviteClanMemberName").on("keypress",function(e){13==e.which&&(e.preventDefault(),Tn())}),$(document).on("focus",".can_autocomplete:not(.ui-autocomplete-input)",function(e){$(this).autocomplete({source:"autocomplete",minLength:3,select:function(e,t){}})}),$(".leaveYourClan").on("click",function(e){e.preventDefault(),$.confirm({title:"Clan Leave Confirmation",message:"Are you sure you want to leave your clan?",buttons:{Yes:{class:"green",action:function(){yt("clan_leave",{})}},No:{class:"red",action:function(){}}}})}),$(".applyToClan").on("click",function(e){e.preventDefault(),yt("clan_apply",{id:$(this).attr("data-id")})}),$("#clearLootGains").on("click",function(e){e.preventDefault(),$("#latestLoot").html("")}),$("#clearBattleStats").on("click",function(){yt("reset_session_stats",{stat:"battle"})}),$("#clearTradeskillStats").on("click",function(){yt("reset_session_stats",{stat:"harvest"})}),$("#clearCraftingStats").on("click",function(){yt("reset_session_stats",{stat:"crafting"})}),$("#clearCarvingStats").on("click",function(){yt("reset_session_stats",{stat:"carving"})}),$("#eventCalendarLink").on("click",function(e){e.preventDefault(),yt("event_calendar",{year:(new Date).getFullYear(),month:(new Date).getMonth()})}),$("#eventCalendarWrapper").on("click","#calendar_add_event",function(e){e.preventDefault();var t='<div class="center"><div>Event Name: <input id="event_calendar_add_name" type="text" /></div><div class="mt10">Month: <select id="event_calendar_add_month"><option id="0">January</option><option id="1">February</option><option id="2">March</option><option id="3">April</option><option id="4">May</option><option id="5">June</option><option id="6">July</option><option id="7">August</option><option id="8">September</option><option id="9">October</option><option id="10">November</option><option id="11">December</option></select></div>';t+='<div class="mt10">Day: <select id="event_calendar_add_day">';for(var a=1;a<=31;a++)t+='<option id="'+a+'">'+a+"</option>";ga({title:"Add Calendar Event",content:t+='</select></div><div class="mt10">Year: <input id="event_calendar_add_year" type="text"></div><div class="mt10">Event description (use HTML): <textarea id="event_calendar_add_desc" cols="50" rows="10"></textarea></div><div class="mt10"><input id="event_calendar_add_save" type="button" style="padding:6.5px!important;" value="Save Event"></div>'})}),$("#eventCalendarWrapper").on("click",".calendar_view_set",function(e){e.preventDefault(),yt("event_calendar",{month:$(this).attr("data-month"),year:$(this).attr("data-year")})}),$("#modal2Content").on("click","#event_calendar_add_save",function(e){e.preventDefault(),yt("event_calendar_save",{month:$("#event_calendar_add_month option:selected").attr("id"),day:$("#event_calendar_add_day option:selected").attr("id"),year:$("#event_calendar_add_year").val(),name:$("#event_calendar_add_name").val(),desc:$("#event_calendar_add_desc").val()})}),$("#modal2Content").on("click","#event_calendar_delete",function(e){e.preventDefault(),yt("event_calendar_delete",{id:$("#event_calendar_delete").attr("data-id")})}),$("#eventCalendarWrapper").on("click",".event_view",function(e){e.preventDefault(),yt("event_view",{eventid:$(this).attr("data-id")})}),$("#recentUpdates").on("click",function(e){e.preventDefault(),yt("updates",{count:4})}),$("#updateList").on("click","#loadAllUpdates",function(e){e.preventDefault(),yt("updates",{}),va({title:"Recent News"}),$("#updateWrapper").show(),$("#updateCount").val(0).hide()}),$("#updateWrapper").on("click",".edit_patch_name",function(e){e.preventDefault();var t=$(this).attr("data-id"),a=prompt("Select a new name",$(this).parent().text().split(" (edit)")[0]);null!==a&&""!=a&&yt("update_edit_name",{patch_id:t,new_name:a})}),$("#updateWrapper").on("click",".edit_patch_detail",function(e){e.preventDefault();var t=$(this).attr("data-patch-id"),a=$(this).attr("data-id"),n=prompt("Insert new details",$(this).parent().parent().children().eq(1).html());null!==n&&""!=n&&yt("update_edit_details",{patch_id:t,update_id:a,details:n})}),$(".closeModal, #modalBackground").on("click",function(e){e.preventDefault(),_a()}),W.on("click",function(e){e.preventDefault(),$(this).blur(),$(this).focus()}),W.on("keypress",function(e){var t,a=$(this).html().match(/^\/(\d+)/),n=$(this).html().split(" ")[0].toLowerCase().replace("&nbsp;","");if(a)t=$(".privateChannel").eq(a[1]-1).css("background-color");else if("/m"==n)t=$('.channelLI>button[data-id="Main"]').css("background-color");else if("/c"==n)t=$('.channelLI>button[data-id="Clan"]').css("background-color");else if("/h"==n)t=$('.channelLI>button[data-id="Help"]').css("background-color");else if("/t"==n)t=$('.channelLI>button[data-id="Trade"]').css("background-color");else if("/a"==n)t=$('.channelLI>button[data-id="Area"]').css("background-color");else{var i=$("#chatChannel>option:selected").attr("id").split("channel")[1];t=$('.channelLI>button[data-id="'+i+'"]').css("background-color")}"black"!=t&&"#000"!=t&&"rgb(0, 0, 0)"!=t||(t="white"),$(this).css("color",t)}),$("#chatSendMessage").on("click",function(e){e.preventDefault(),ei()}),$("#viewMarket").on("click",function(e){e.preventDefault(),Kn()}),$("#logout").on("click",function(e){e.preventDefault(),a.close(),$.post("logout",{confirm:1}).done(function(e){document.location.reload()}).error(function(e){$.alert("A server error prevented you from logging out.  Try again.  This isn't a joke saying it's impossible to log out, I swear.  If you're sure that you're connected to the internet, the game is probably deaded.")})}),$("#general_notification,#modalContent").on("click",".resendVerification",function(e){e.preventDefault(),yt("verification_resend",{confirm:1})}),L.on("click",".nextBuildingCost",function(e){e.preventDefault();var t=$("#myClanCurrent"+$(this).attr("data-currency")).text().replace(/,/g,""),a=$(this).text().replace(/,/g,"")-t;$("#donate"+$(this).attr("data-currency")).val(Math.max(0,a)),$("#donate"+$(this).attr("data-currency")).keyup()}),D.on("click",".confirm_gem_ownership",function(e){e.preventDefault(),yt("gem_own",{gem:$(this).attr("data-gid"),currency:$(this).attr("data-currency")})}),D.on("click",".confirm_gem_socketing",function(e){e.preventDefault(),yt("gem_socket_to_item",{gem:$(this).attr("data-gid"),item:$("#socketableItems option:selected").val()})}),D.on("click","#addItemEnchant",function(e){e.preventDefault(),$.post("item_enchant.php",{item:$(this).attr("data-itemid")}).done(function(e){e.s>0?(Ua(e.p),D.html(e.html),da($(".inventoryLoad.active").attr("data-itemtype"))):bn($("#item_options_notification"),e.m)}).error(function(e){bn($("#item_options_notification"),"A server error occurred while attempting to enchant.")})}),D.on("click",".confirm_item_transfer",function(e){e.preventDefault(),yt("item_transfer",{item:$(this).attr("data-itemid"),recipient:$("#itemOptionSendTo").val()})}),D.on("click",".confirm_item_rename",function(e){e.preventDefault();var t=$(this).attr("data-itemid"),a=$(this).attr("data-currency");yt("item_rename",{item:t,name:$("#itemOptionRename").val(),currency:a})}),D.on("click",".confirm_item_ownership",function(e){e.preventDefault(),yt("item_own",{item:$(this).attr("data-itemid"),currency:$(this).attr("data-currency")})}),D.on("click",".confirm_gem_transfer",function(e){e.preventDefault(),yt("gem_transfer",{gem:$(this).attr("data-gemid"),recipient:$("#gemOptionSendTo").val()})}),D.on("click","#socketThisGem",function(e){e.preventDefault(),yt("gem_socket_to_item",{gem:$("#socketableGems option:selected").val(),item:$(this).attr("data-itemid")})}),D.on("click",".unsocket-gem",function(e){e.preventDefault();var t=parseInt($(this).attr("data-unsocket-cost")),a=$(this).attr("data-gid"),n=$(this).attr("data-itemid");$.confirm({title:"Gem Unsocketing Confirmation",message:"It will cost "+ui(t)+" gold to unsocket that gem.  Do you wish to continue?",buttons:{Yes:{class:"green",action:function(){yt("gem_unsocket_from_item",{gem:a,item:n})}},No:{class:"red",action:function(){}}}})}),D.on("click","#update_add_row",function(e){$("#update_creation_table").append($("#update_creation_table .row").last().clone())}),D.on("click","#update_submit",function(e){var t=$("#update_add"),a=$("#patch_name").val(),n=t.find('select[name="update_type[]"]'),i=t.find('textarea[name="update_text[]"]'),o=[],r=[];$.each(n,function(e,t){o.push($(t).val())}),$.each(i,function(e,t){r.push($(t).val())}),yt("updates_add",{patch_name:a,requires_refresh:$("#patch_requires_refresh").is(":checked")?1:0,update_types:o,update_texts:r})}),W.contentEditable(),$("#chatMessageList,#chatMessageHistory").on("click",".chatDelete",function(e){e.preventDefault();var t=$(this).closest("li"),n=t.attr("id").split("message-")[1],i=t.attr("data-channel");$.confirm({title:"Chat Message Deletion Confirmation",message:"Delete message: <br /><br />"+pi(t.text())+"?",buttons:{Yes:{class:"green",action:function(){a.send(JSON.stringify({type:"delete",channelid:i,messageid:n}))}},No:{class:"red",action:function(){}}}})}),W.on("keypress",function(e){13==e.which&&(e.preventDefault(),W.is(":focus")&&ei())}),$("#chatReload").on("click",function(e){e.preventDefault(),3==a.readyState?ni():a.close()}),$(document).keydown(function(e){e.ctrlKey&&65==e.keyCode&&T.is(":hover")&&!W.is(":focus")&&(!function(e){if(document.selection){var t=document.body.createTextRange();t.moveToElementText(document.getElementById(e)),t.select()}else if(window.getSelection){var t=document.createRange();t.selectNode(document.getElementById(e)),window.getSelection().addRange(t)}}("chatMessageList"),e.preventDefault())}),$("#questInfo,#areaContent").on("click",".questCenter",function(e){e.preventDefault(),Zt()}),$("#accountActivityWrapper").on("click",".removeAccountActivity",function(e){e.preventDefault();var t=$(this).parent().parent(),a=$(this).parent().parent().find("div").eq(3),n=$(this).attr("data-aid");$.confirm({title:"Activity Deletion Confirmation",message:"Are you sure that you wish to remove: <br /><br />"+pi(a.text())+"<br /><br />from your activity log?",buttons:{Yes:{class:"green",action:function(){$.post("account_activity_remove.php",{aid:n}).done(function(e){t.remove(),bn($("#activity_notification"),e.m)}).error(function(){bn($("#activity_notification"),"An error occurred while attempting to remove your activity log.")})}},No:{class:"red",action:function(){}}}})}),$("#battleContinue").on("click",function(){Wa()}),$("#autoEnemy").on("click",function(e){e.preventDefault(),a.send(JSON.stringify({type:"action",action:"battle",enemy:$("#enemyList option:selected").val()})),Ba()}),$(".loadHarvesting").on("click",function(e){e.preventDefault();var t=$(this).attr("data-resource");a.send(JSON.stringify({type:"action",action:"harvest",resource:t})),Na()}),$("#loadMobList,#battleGrounds").on("click",function(e){e.preventDefault(),Da(),$("#roomName").html($(this).html()),zt()}),$(".replenishStamina").on("click",function(){var e=parseInt($(".autosRemaining").first().text().replace(/,/g,"")),t=parseInt($(".autosMaximum").first().text().replace(/,/g,""));if(!($(".staminaBeingReplenished:visible").length>0||e>=t)){var a={};document.hasFocus()||(a.x="true"),yt("stamina_replenish",a)}}),$(".cancelAutos").on("click",function(){Ye=!0,a.send(JSON.stringify({type:"action",action:"stop"})),$(".autoWrapper,.fatigueWrapper,.staminaBeingReplenished,#battleStatusButtons,#harvestStatusButtons").hide(),$(".autosAreCanceled").slideDown(),$(document).attr("title",$(this).attr("data-action-type")+" Canceled - Relics of Avabur")}),$("#loadMarketplace").on("click",function(e){e.preventDefault(),Kn()}),$("#tradeResult").on("click",".loadBlacksmith",function(e){e.preventDefault(),Ca()}),$("#loadBlacksmith").on("click",function(e){e.preventDefault(),Ca()}),$(".item_cost, .tool_cost").on("click",function(e){e.preventDefault();var t=$(this).closest(".row").children().first().text(),a=$(this).text(),n=$(this).attr("data-type"),i=$(this).attr("data-tier");$.confirm({title:"Item Purchase Confirmation",message:"Are you sure you want to buy "+t+" for "+a+"?",buttons:{Yes:{class:"green",action:function(){La(n,i)}},No:{class:"red",action:function(){}}}})}),$("#loadTravel").on("click",function(e){e.preventDefault(),Da(),yt("town_travel",{})}),$("#area_list").on("change",function(){$("#area_preview_name").text($("#area_list option:selected").attr("data-name")),$("#area_preview_description").text($("#area_list option:selected").attr("data-desc")),$("#area_preview_travel_cost").html('Travel Cost: <span class="gold">'+ui($("#area_list option:selected").attr("data-travelcost"))+" Gold</span>")}),$("#travel_confirm").on("click",function(e){yt("travel",{area:$("#area_list option:selected").val()})}),$("#goldCrystalButton").on("click",function(e){e.preventDefault(),$("#crystalPurchaseRealCurrency").fadeOut(function(){$("#crystalPurchaseGold").fadeIn()})}),$("#premium_purchase_other_link").on("click",function(e){$("#crystalPurchaseGold").fadeOut(function(){$("#crystalPurchaseRealCurrency").fadeIn()})}),$("#premium_purchase_gold_button").on("click",function(e){e.preventDefault();var t=$("#premium_purchase_gold_count").val();isNaN(t)||t<1?bn($("#premium_shop_notification"),"You must choose a valid amount to purchase."):yt("purchase_crystals_gold",{amount:t})}),$("#backToHouseViewed").on("click",function(e){$("#houseViewedRoomWrapper").fadeOut(function(){$("#houseRoomBuildingWrapper").fadeIn(),$(".houseViewRoom.active").removeClass("active")})}),$("#backToHouseRoomViewed").on("click",function(e){$("#houseViewedRoomItemWrapper").fadeOut(function(){$("#houseRoomName").text()?$("#houseViewedRoomWrapper").fadeIn():($("#houseRoomBuildingWrapper").fadeIn(),$(".houseViewRoom.active").removeClass("active"))})}),$("#houseRoomItemDescription").on("click","#craft_sort_confirm",function(){var e=new Array;$.each($("#craft_sortable>div"),function(t,a){var n=JSON.parse($(a).find(".itemWithTooltip").attr("data-json")).i;e.push(n)}),yt("craft_queue_rearrange",{new_order:e.join(",")})}),$("#houseRoomItemDescription").on("click","#carve_sort_confirm",function(){var e=new Array;$.each($("#carve_sortable>div"),function(t,a){var n=JSON.parse($(a).find(".gemWithTooltip").attr("data-json")).i;e.push(n)}),yt("carve_queue_rearrange",{new_order:e.join(",")})}),$("#houseRoomsBuilt,#houseQuickBuildList,#modal2Content").on("click",".houseViewRoom",function(e){e.preventDefault();$(this);yt("house_room",{roomtype:$(this).attr("data-type")})}),$("#mod_tools").on("click",function(e){e.preventDefault(),za()}),$("#modToolList a").on("click",function(e){Xa($(this).attr("data-type"))}),$("#modToolInfo").on("click",".mod_lookup_button",function(e){var t=$(this).attr("data-type");Ka(t,$("#user_lookup_"+t).val())}),$("#modToolInfo").on("click",".mod_add_note",function(e){e.preventDefault(),$("#mod_add_note_textarea").show()}),$("#modToolInfo").on("click",".mod_post_note",function(e){e.preventDefault(),yt("mod_post_note",{username:$(this).attr("data-value"),note:$("#mod_add_note_value").val()})}),$("#modalContent").on("click",".lookup",function(e){ya(),$("#modToolWrapper").show(),Ka($(this).attr("data-type"),$(this).attr("data-value"))}),$("#modalContent").on("click",".mod_activity_view",function(e){ya(),va({title:"Activity Log"}),$("#accountActivityWrapper").show(),An(0,$(this).attr("data-value"))}),$("#trick_treat_button").on("click",function(e){$.post("trick_treat.php",{n:$("#trick_treat").attr("data-user")}).done(function(e){$.alert(e.m),e.p&&Ua(e.p)}).error(function(e){$.alert("An error prevented you from trick or treating!  Try again to see if you receive a treat!")})}),$("#housing,#constructionNotifier,#header_house").on("click",function(e){e.preventDefault(),Za()}),$("#mannequinLink").on("click",function(e){e.preventDefault(),ya(),$("#houseName").text()||Za(),yt("house_room_item",{roomtype:1,itemtype:104})}),$("#workshopNotifier").on("click",function(e){e.preventDefault(),$("#houseName").text()||Za(),yt("house_room",{roomtype:22})}),$("#harvestronNotifier").on("click",function(e){e.preventDefault(),$("#houseName").text()||Za(),yt("house_room_item",{roomtype:22,itemtype:42})}),$("#houseRoomsBuilt").on("click",".houseRoomBuildNewItem",function(e){e.preventDefault(),yt("house_room",{roomtype:$(this).parent().parent().attr("data-roomtype")})}),$("#modal2Content").on("click",".houseUnignoreQuickBuild",function(e){yt("house_unignore_build",{itype:$(this).attr("data-type")})}),$("#houseQuickBuildList").on("click",".houseIgnoreQuickBuild",function(e){yt("house_ignore_build",{itype:$(this).attr("data-type")})}),$("#houseRoomItemsBuilt,#houseQuickBuildList,#modal2Content").on("click",".houseViewRoomItem",function(e){e.preventDefault(),yt("house_room_item",{roomtype:$(this).attr("data-roomtype"),itemtype:$(this).attr("data-itemtype")})}),$("#houseBonusList").on("click",".houseBonusValue",function(e){e.preventDefault(),yt("house_bonus_check",{bonus:$(this).attr("data-id")})}),$("#allHouseUpgrades").on("click",function(e){e.preventDefault(),yt("house_all_builds",{})}),$("#houseRoomItemUpgradeTier").on("click",function(e){yt("house_room_item_upgrade_tier",{roomtype:$("#houseRoomItemUpgradeTier").attr("data-roomtype"),itemtype:$("#houseRoomItemUpgradeTier").attr("data-itemtype")})}),$("#houseRoomItemUpgradeLevel").on("click",function(e){yt("house_room_item_upgrade_level",{roomtype:$("#houseRoomItemUpgradeLevel").attr("data-roomtype"),itemtype:$("#houseRoomItemUpgradeLevel").attr("data-itemtype")})}),$("#houseRoomItemDescription").on("click","#houseTrashCompactorSelect",function(e){yt("house_trash_compactor_setting",{quality:$("#houseTrashCompactorToggle option:selected").val(),effects:$("#houseTrashCompactorEffects").val()})}),$("#houseRoomItemDescription").on("click","#houseHarvestingJobStart",function(e){tn($("#houseHarvestingJobSkill").val(),$("#houseHarvestingJobTime").val())}),$("#houseRoomItemDescription").on("click","#houseHarvestingJobCancel",function(e){$.confirm({title:"Harvestron Job Cancellation Confirmation",message:"Are you sure you want to cancel your harvestron job?  You will not receive any resources and will not be refunded any gold.",buttons:{Yes:{class:"green",action:function(){yt("house_harvest_job_cancel",{confirm:!0})}},No:{class:"red",action:function(){}}}})}),$("#houseRoomItemDescription").on("change","#houseHarvestingJobTime,#houseHarvestingJobSkill",function(e){var t=$("#houseHarvestingJobTime").attr("data-item-tier"),a=$("#houseHarvestingJobTime").attr("data-item-level"),n=$("#houseHarvestingJobSkill option:selected").attr("data-level"),i=$("#houseHarvestingJobSkill option:selected").attr("data-upgrades"),o=$("#houseHarvestingJobTime option:selected").val(),r=1;r+=Math.pow(n,1.22)/100*.4,r+=Math.pow(i,1.22)/100*.6,r*=.39+.1*t+.01*a,r*=10*o*{30:80,60:100,120:125,360:150,720:200,1440:250}[o],$("#houseHarvestingJobCost").text(ui(Math.floor(r)))}),$("#houseBuildRoom").on("click",function(e){yt("house_build_room",{roomid:$("#houseRoomPossibilities option:selected").val()})}),$("#houseRoomPossibilities").on("change",function(e){e.preventDefault(),$("#houseRoomBuildingCosts").html($("#houseRoomPossibilities option:selected").attr("data-costs")),$("#houseRoomBuildingTimeCost").text($("#houseRoomPossibilities option:selected").attr("data-time"))}),$("#houseRoomItemPossibilities").on("change",function(e){e.preventDefault(),$("#houseRoomItemBuildingCosts").html($("#houseRoomItemPossibilities option:selected").attr("data-costs")),$("#houseRoomItemBuildingTimeCost").text($("#houseRoomItemPossibilities option:selected").attr("data-time"))}),$("#houseBuildRoomItem").on("click",function(e){yt("house_build_room_item",{roomtype:$("#houseRoomItemPossibilities option:selected").attr("data-roomtype"),itemtype:$("#houseRoomItemPossibilities option:selected").val()})}),$("#houseRoomItemDescription").on("click","#loadoutSave",function(e){e.preventDefault(),yt("loadout_add",{name:$("#loadoutName").val()})}),$("#houseRoomItemDescription").on("click",".loadoutDelete",function(e){e.preventDefault(),yt("loadout_remove",{name:$(this).attr("data-id")})}),$("#mannequinSwap").on("click",function(e){e.preventDefault(),yt("loadout_use",{name:$("#mannequinOptions option:selected").val(),item_type:$(".inventoryLoad.active").attr("data-itemtype")})}),$("#houseRoomItemDescription").on("click",".loadoutUse",function(e){e.preventDefault(),yt("loadout_use",{name:$(this).attr("data-id")})}),$("#houseRoomItemDescription").on("change","#craftingType",function(e){dn()}),$("#houseRoomItemDescription").on("change","#craftingItemLevel, #craftingQuality",function(e){var t=Math.floor(2*$("#craftingItemLevel").val()*[2,3,5,7.5,12.5,20,30,50][$("#craftingQuality").val()]),a=0,n={},i=$("#ms-houseCraftingVetoList>.ms-selectable").find(".ms-optgroup");$.each(i,function(e,t){var a=$(t).children().first().children().first().text(),i=$(t).children().eq(2).attr("data-cost-multiplier"),o=$(t).find(".ms-selected").length;n[a]=Math.pow(i,o)});for(var o in n)a+=n[o]-1;$("#craftingMaterialCost").text(ui(t)),a>0?($("#craftingMaterialVetoCostWrapper").show(),$("#craftingMaterialVetoCost").text(ui(a,2))):$("#craftingMaterialVetoCostWrapper").hide()}),$(".craftingTableLink").on("click",function(e){e.preventDefault(),yt("house_room_item",{roomtype:22,itemtype:100})}),$("#houseRoomItemDescription").on("click","#craftingJobStart",function(e){l($("#craftingItemLevel").val(),$("#craftingQuality").val(),$("#craftingType").val(),$("#houseCraftingVetoList").val(),1,"front",$("#craftingJobFillQueue").prop("checked"))}),$("#houseRoomItemDescription").on("click",".craftingJobStartQueue",function(e){var t=$(this).attr("data-position");l($("#craftingItemLevel").val(),$("#craftingQuality").val(),$("#craftingType").val(),$("#houseCraftingVetoList").val(),0,t,$("#craftingJobFillQueue").prop("checked"))}),$("#houseRoomItemDescription").on("click",".craftingResumeButton",function(e){var t;t=$(this).attr("data-cid"),a.send(JSON.stringify({type:"action",action:"craft",cid:t})),Fa()}),$("#houseRoomItemDescription").on("click",".craftingCompleteButton",function(e){var t=$(this).attr("data-cid");e.ctrlKey?s(t):$.confirm({title:"Crafting Finalization Confirmation",message:"Are you sure you want to finalize that item?  It will be completed as-is and you will not be able to work on it again later.",buttons:{Yes:{class:"green",action:function(){s(t)}},No:{class:"red",action:function(){}}}})}),$("#houseRoomItemDescription").on("click",".craftingCancelButton",function(e){var t=$(this).attr("data-cid");e.ctrlKey?r(t):$.confirm({title:"Crafting Cancel Confirmation",message:"Are you sure you want to remove that item from your crafting queue?  You will not receive the item or any crafting materials as compensation.",buttons:{Yes:{class:"green",action:function(){r(t)}},No:{class:"red",action:function(){}}}})}),$("#houseRoomItemDescription").on("click",".craftingPriorityButton",function(e){yt("craft_queue_raise",{cid:$(this).attr("data-cid")})}),$(".carvingBenchLink").on("click",function(e){e.preventDefault(),yt("house_room_item",{roomtype:22,itemtype:101})}),$("#houseRoomItemDescription").on("click",".loadIngredientMarket",function(e){$("#houseWrapper").hide();var t=$(this).attr("data-st");va({title:"Market"}),$("#market_notification").hide(),$("#marketWrapper").show(),$n("ingredient",0,0,0,0,t)}),$("#houseRoomItemDescription").on("change","#carvingItemLevel, #carvingType",function(e){var t=$("#carvingItemLevel").val(),a=parseInt(t)+1,n=Math.floor(50*Math.pow(a,1.285)),i=JSON.parse($("#carvingType").attr("data-my-ingredients")),o=JSON.parse($("#carvingType option:selected").attr("data-ingredients")),r=ui(n)+" gem fragments";for(var s in o){var l=o[s];r+=void 0===i[s]||i[s]<a?', <span style="text-decoration:line-through"><a style="text-decoration:none;" class="loadIngredientMarket" data-st="'+s+'">('+(i[s]||0)+" / "+a+" "+l+")</a></span>":", <span>"+a+" "+l+"</span>"}var c=$("#carvingType option");$.each(c,function(e,t){var n=JSON.parse($(t).attr("data-ingredients"));for(var o in n){if(void 0===i[o]||i[o]<a){$(t).css("color","gray");break}$(t).css("color","white")}}),$("#carvingMaterialCost").html(r)}),$("#houseRoomItemDescription").on("click","#carvingJobStart",function(e){d($("#carvingItemLevel").val(),$("#carvingType").val(),1,"front")}),$("#houseRoomItemDescription").on("click",".carvingJobStartQueue",function(e){var t=$(this).attr("data-position");d($("#carvingItemLevel").val(),$("#carvingType").val(),0,t)}),$("#houseRoomItemDescription").on("click",".carvingResumeButton",function(e){var t;t=$(this).attr("data-cid"),a.send(JSON.stringify({type:"action",action:"carve",cid:t})),Oa()}),$("#houseRoomItemDescription").on("click",".carvingCancelButton",function(e){var t=$(this).attr("data-cid");e.ctrlKey?c(t):$.confirm({title:"Carving Cancel Confirmation",message:"Are you sure you want to remove that gem from your carving queue?  You will not receive the gem or any gem fragments as compensation.",buttons:{Yes:{class:"green",action:function(){c(t)}},No:{class:"red",action:function(){}}}})}),$("#houseRoomItemDescription").on("click",".carvingPriorityButton",function(e){yt("carve_queue_raise",{cid:$(this).attr("data-cid")})}),$("#houseWrapper").on("click",".purchase_plot",function(e){yt("house_buy",{currency:$(this).attr("data-currency")})}),$(".stripeButton").on("click",function(e){var t=$("#premiumShopDollarAmount").val().replace(/,/g,""),a=Number($("#premiumShopDollarAmount").attr("max"));t<5?bn($("#premium_shop_notification"),"Purchases of less than $5 will not be credited."):t>a?bn($("#premium_shop_notification"),"Value must be less than or equal to "+a+"."):n.open({name:"Relics of Avabur",description:$("#premiumShopTotalValue").text()+" Crystals",amount:100*t}),e.preventDefault()}),$("#paypalButton").on("click",function(e){$("#premiumShopGiftFor").keyup(),$("#premiumShopDollarAmount").val().replace(/,/g,"")<5&&(e.preventDefault(),bn($("#premium_shop_notification"),"Purchases of less than $5 will not be credited."))}),$(window).on("popstate",function(){n.close()}),$("#reallocateBoosts").on("click",function(e){e.preventDefault(),yt("boost_allocation_template",{})}),$(window).scroll(function(e){if(!t){var a=$(".actionButtons:visible");a.length&&(t=a.first().offset().top-parseFloat(a.first().css("margin-top").replace(/auto/,0)))}$(this).scrollTop()>=t?($(".actionButtons:visible").addClass("fixedtop"),$(".autoWrapper:visible").addClass("fixedtop").css("top","60px")):$(".actionButtons:visible,.autoWrapper:visible").removeClass("fixedtop")}),ua(),ha(),pa(),ma(),(m=new Audio).canPlayType("audio/mpeg;")?m.src="sounds/ding.mp3":m.src="sounds/ding.wav"}),$(document).on("ajaxStart",function(){x.show()}).on("ajaxComplete",function(e,t){var a;x.hide(),null!==(a=t.getResponseHeader("HasExpired"))&&void 0!==a&&"true"===a&&(window.location="/?expired=1"),null!==(a=t.getResponseHeader("IsBanned"))&&void 0!==a&&"true"===a&&(window.location="/?banned=1"),null!==(a=t.getResponseHeader("DidMultilog"))&&void 0!==a&&"true"===a&&(window.location="/?multilog=1")}),$(document).on("keydown",function(e){if(16==((e=e||window.event).keyCode||e.which))$("body").addClass("unselectable");else if(e.ctrlKey&&38==e.which){if(W.is(":focus")){e.preventDefault(),st--;var t=Math.max(0,st);rt[st]?(W.html(rt[t]),ri(document.getElementById("chatMessage"))):st++}}else if(e.ctrlKey&&40==e.which){if(W.is(":focus")){e.preventDefault(),st++;t=Math.min(rt.length-1,st);rt[st]?(W.html(rt[t]),ri(document.getElementById("chatMessage"))):st--}}else!$("#dungeonInfo").is(":visible")||W.is(":focus")||$(":focus").first().is("input")||(38==e.which||87==e.which?(e.preventDefault(),$('.dungeon_move[data-direction="north"]').click()):39==e.which||68==e.which?(e.preventDefault(),$('.dungeon_move[data-direction="east"]').click()):40==e.which||83==e.which?(e.preventDefault(),$('.dungeon_move[data-direction="south"]').click()):37==e.which||65==e.which?(e.preventDefault(),$('.dungeon_move[data-direction="west"]').click()):69==e.which?(e.preventDefault(),$("#dungeonSearch").click()):70==e.which&&(e.preventDefault(),$(".dungeon_fight").first().click()))}),$(document).on("keyup",function(e){var t=(e=e||window.event).keyCode||e.which,a=$("#profileOptionTooltip").is(":visible");16==t?$("body").removeClass("unselectable"):87==e.which&&a?$("#profileOptionWhisper").click():86==e.which&&a?$("#profileOptionProfile").click():71==e.which&&a?$("#profileOptionIgnore").click():70==e.which&&a?$("#profileOptionWire").click():t==ft&&(W.is(":focus")||$(":focus").first().is("input")||$(":focus").first().is("textarea")||$(".replenishStamina:visible").first().click())}),$.alert=function(e,t){if($("#confirmOverlay").length)return!1;t||(t="Error");var a=['<div id="confirmOverlay">','<div id="confirmBox">',"<h1>",t,"</h1>","<p>",e,"</p>",'<div id="confirmButtons"><a class="button green">OK<span></span></a>',"</div></div></div>"].join("");$(a).hide().appendTo("body").fadeIn();$("#confirmBox .button").eq(0).click(function(){return $.confirm.hide(),!1})},$.vdayalert=function(e,t){if($("#confirmOverlay").length)return!1;t||(t="Error");var a=['<div id="confirmOverlay">','<div class="heart">','<div class="vdaymessage">','<h1 class="nobg">',t,"</h1>",'<div class="mt10">',e,"</div>",'<div id="confirmButtons" class="mt10"><a class="button pink">&hearts;<span></span></a>',"</div></div></div>"].join("");$(a).hide().appendTo("body").fadeIn();$("#confirmOverlay .button").eq(0).click(function(){return $.confirm.hide(),!1})},$.confirm=function(e){if($("#confirmOverlay").length)return!1;var t="";$.each(e.buttons,function(e,a){t+='<a class="button '+a.class+'">'+e+"<span></span></a>",a.action||(a.action=function(){})});var a=['<div id="confirmOverlay">','<div id="confirmBox">',"<h1>",e.title,"</h1>","<p>",e.message,"</p>",'<div id="confirmButtons">',t,"</div></div></div>"].join("");$(a).hide().appendTo("body").fadeIn();var n=$("#confirmBox .button"),i=0;$.each(e.buttons,function(e,t){n.eq(i++).click(function(){return t.action(),$.confirm.hide(),!1})}),$("#confirmBox").on("mouseover",".accessoryWithTooltip",function(e){var t=$("#accessoryTooltip");clearTimeout(u);var a=JSON.parse($(this).attr("data-json"));if(void 0!==a.s){a.i;ta(a,$(this).css("color"));var n=$(this).offset().left+$(this).width()+t.width(),i=t.width(),o=0;if(n>window.innerWidth)if($(this).offset().left>i+22)t.css("left",$(this).offset().left-t.width()-22);else if(o=1,$(this).offset().left+t.width()+2>window.innerWidth){var r=$(this).offset().left+$(this).width()/2;r-=(t.width()+2)/2,t.css("left",r)}else t.css("left",$(this).offset().left);else t.css("left",$(this).offset().left+$(this).width()+5);var s,l,c=$(this).offset().top+$(this).height();s=t.height(),l=t.height()+20,c+s>$(document).height()?$(this).offset().top>l?t.css("top",$(document).height()-t.height()-20):t.css("top",$(this).offset().top+$(this).height()+t.height()):o<1?t.css("top",$(this).offset().top+$(this).height()):t.css("top",$(this).offset().top+$(this).height()+5),aa()}}),$("#confirmBox").on("mouseout",".accessoryWithTooltip",function(e){clearTimeout(u),u=setTimeout(function(){$("#accessoryTooltip").hide()},400)})},$.confirm.hide=function(){$("#confirmOverlay").fadeOut(function(){$(this).remove()})},$.fn.setEndOfContentEditable=function(e){var t,a;document.createRange?((t=document.createRange()).selectNodeContents(e),t.collapse(!1),(a=window.getSelection()).removeAllRanges(),a.addRange(t)):document.selection&&((t=document.body.createTextRange()).moveToElementText(e),t.collapse(!1),t.select())},Number.prototype.format=function(e,t){var a="\\d(?=(\\d{"+(t||3)+"})+"+(e>0?"\\.":"$")+")";return(Math.floor(1e3*this)/1e3).toFixed(Math.max(0,~~e)).replace(new RegExp(a,"g"),"$&,")}}(),"Microsoft Internet Explorer"==navigator.appName||navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/rv:11/)||void 0!==$.browser&&1==$.browser.msie){var head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href="css-ie.css",link.media="all",head.appendChild(link)}